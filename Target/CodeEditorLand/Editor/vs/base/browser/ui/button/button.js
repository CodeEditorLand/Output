import"../../contextmenu.js";import{addDisposableListener as s,EventHelper as p,EventType as a,isActiveElement as E,reset as d,trackFocus as y}from"../../dom.js";import{sanitize as k}from"../../dompurify/dompurify.js";import{StandardKeyboardEvent as _}from"../../keyboardEvent.js";import{renderMarkdown as I,renderStringAsPlaintext as g}from"../../markdownRenderer.js";import{Gesture as S,EventType as D}from"../../touch.js";import{createInstantHoverDelegate as L,getDefaultHoverDelegate as w}from"../hover/hoverDelegateFactory.js";import"../hover/hoverDelegate.js";import{renderLabelWithIcons as f}from"../iconLabel/iconLabels.js";import{Action as C}from"../../../common/actions.js";import{Codicon as T}from"../../../common/codicons.js";import{Color as v}from"../../../common/color.js";import{Emitter as m}from"../../../common/event.js";import{isMarkdownString as b,markdownStringEqual as A}from"../../../common/htmlContent.js";import{KeyCode as l}from"../../../common/keyCodes.js";import{Disposable as B,DisposableStore as x}from"../../../common/lifecycle.js";import{ThemeIcon as H}from"../../../common/themables.js";import"./button.css";import{localize as M}from"../../../../nls.js";import{getBaseLayerHoverDelegate as F}from"../hover/hoverDelegate2.js";import"../dropdown/dropdown.js";const mt={buttonBackground:"#0E639C",buttonHoverBackground:"#006BB3",buttonSeparator:v.white.toString(),buttonForeground:v.white.toString(),buttonBorder:void 0,buttonSecondaryBackground:void 0,buttonSecondaryForeground:void 0,buttonSecondaryHoverBackground:void 0};class u extends B{options;_element;_label="";_labelElement;_labelShortElement;_hover;_onDidClick=this._register(new m);get onDidClick(){return this._onDidClick.event}_onDidEscape=this._register(new m);get onDidEscape(){return this._onDidEscape.event}focusTracker;constructor(t,e){super(),this.options=e,this._element=document.createElement("a"),this._element.classList.add("monaco-button"),this._element.tabIndex=0,this._element.setAttribute("role","button"),this._element.classList.toggle("secondary",!!e.secondary);const n=e.secondary?e.buttonSecondaryBackground:e.buttonBackground,r=e.secondary?e.buttonSecondaryForeground:e.buttonForeground;this._element.style.color=r||"",this._element.style.backgroundColor=n||"",e.supportShortLabel&&(this._labelShortElement=document.createElement("div"),this._labelShortElement.classList.add("monaco-button-label-short"),this._element.appendChild(this._labelShortElement),this._labelElement=document.createElement("div"),this._labelElement.classList.add("monaco-button-label"),this._element.appendChild(this._labelElement),this._element.classList.add("monaco-text-button-with-short-label")),typeof e.title=="string"&&this.setTitle(e.title),typeof e.ariaLabel=="string"&&this._element.setAttribute("aria-label",e.ariaLabel),t.appendChild(this._element),this._register(S.addTarget(this._element)),[a.CLICK,D.Tap].forEach(i=>{this._register(s(this._element,i,o=>{if(!this.enabled){p.stop(o);return}this._onDidClick.fire(o)}))}),this._register(s(this._element,a.KEY_DOWN,i=>{const o=new _(i);let h=!1;this.enabled&&(o.equals(l.Enter)||o.equals(l.Space))?(this._onDidClick.fire(i),h=!0):o.equals(l.Escape)&&(this._onDidEscape.fire(i),this._element.blur(),h=!0),h&&p.stop(o,!0)})),this._register(s(this._element,a.MOUSE_OVER,i=>{this._element.classList.contains("disabled")||this.updateBackground(!0)})),this._register(s(this._element,a.MOUSE_OUT,i=>{this.updateBackground(!1)})),this.focusTracker=this._register(y(this._element)),this._register(this.focusTracker.onDidFocus(()=>{this.enabled&&this.updateBackground(!0)})),this._register(this.focusTracker.onDidBlur(()=>{this.enabled&&this.updateBackground(!1)}))}dispose(){super.dispose(),this._element.remove()}getContentElements(t){const e=[];for(let n of f(t))if(typeof n=="string"){if(n=n.trim(),n==="")continue;const r=document.createElement("span");r.textContent=n,e.push(r)}else e.push(n);return e}updateBackground(t){let e;this.options.secondary?e=t?this.options.buttonSecondaryHoverBackground:this.options.buttonSecondaryBackground:e=t?this.options.buttonHoverBackground:this.options.buttonBackground,e&&(this._element.style.backgroundColor=e)}get element(){return this._element}set label(t){if(this._label===t||b(this._label)&&b(t)&&A(this._label,t))return;this._element.classList.add("monaco-text-button");const e=this.options.supportShortLabel?this._labelElement:this._element;if(b(t)){const r=I(t,{inline:!0});r.dispose();const i=r.element.querySelector("p")?.innerHTML;if(i){const o=k(i,{ADD_TAGS:["b","i","u","code","span"],ALLOWED_ATTR:["class"],RETURN_TRUSTED_TYPE:!0});e.innerHTML=o}else d(e)}else this.options.supportIcons?d(e,...this.getContentElements(t)):e.textContent=t;let n="";typeof this.options.title=="string"?n=this.options.title:this.options.title&&(n=g(t)),this.setTitle(n),typeof this.options.ariaLabel=="string"?this._element.setAttribute("aria-label",this.options.ariaLabel):this.options.ariaLabel&&this._element.setAttribute("aria-label",n),this._label=t}get label(){return this._label}set labelShort(t){!this.options.supportShortLabel||!this._labelShortElement||(this.options.supportIcons?d(this._labelShortElement,...this.getContentElements(t)):this._labelShortElement.textContent=t)}set icon(t){this._element.classList.add(...H.asClassNameArray(t))}set enabled(t){t?(this._element.classList.remove("disabled"),this._element.setAttribute("aria-disabled",String(!1)),this._element.tabIndex=0):(this._element.classList.add("disabled"),this._element.setAttribute("aria-disabled",String(!0)))}get enabled(){return!this._element.classList.contains("disabled")}set checked(t){t?(this._element.classList.add("checked"),this._element.setAttribute("aria-checked","true")):(this._element.classList.remove("checked"),this._element.setAttribute("aria-checked","false"))}get checked(){return this._element.classList.contains("checked")}setTitle(t){!this._hover&&t!==""?this._hover=this._register(F().setupManagedHover(this.options.hoverDelegate??w("element"),this._element,t)):this._hover&&this._hover.update(t)}focus(){this._element.focus()}hasFocus(){return E(this._element)}}class O extends B{button;action;dropdownButton;separatorContainer;separator;element;_onDidClick=this._register(new m);onDidClick=this._onDidClick.event;constructor(t,e){super(),this.element=document.createElement("div"),this.element.classList.add("monaco-button-dropdown"),t.appendChild(this.element),e.hoverDelegate||(e={...e,hoverDelegate:this._register(L())}),this.button=this._register(new u(this.element,e)),this._register(this.button.onDidClick(i=>this._onDidClick.fire(i))),this.action=this._register(new C("primaryAction",g(this.button.label),void 0,!0,async()=>this._onDidClick.fire(void 0))),this.separatorContainer=document.createElement("div"),this.separatorContainer.classList.add("monaco-button-dropdown-separator"),this.separator=document.createElement("div"),this.separatorContainer.appendChild(this.separator),this.element.appendChild(this.separatorContainer);const n=e.buttonBorder;n&&(this.separatorContainer.style.borderTop="1px solid "+n,this.separatorContainer.style.borderBottom="1px solid "+n);const r=e.secondary?e.buttonSecondaryBackground:e.buttonBackground;this.separatorContainer.style.backgroundColor=r??"",this.separator.style.backgroundColor=e.buttonSeparator??"",this.dropdownButton=this._register(new u(this.element,{...e,title:M("button dropdown more actions","More Actions..."),supportIcons:!0})),this.dropdownButton.element.setAttribute("aria-haspopup","true"),this.dropdownButton.element.setAttribute("aria-expanded","false"),this.dropdownButton.element.classList.add("monaco-dropdown-button"),this.dropdownButton.icon=T.dropDownButton,this._register(this.dropdownButton.onDidClick(i=>{const o=Array.isArray(e.actions)?e.actions:e.actions.getActions();e.contextMenuProvider.showContextMenu({getAnchor:()=>this.dropdownButton.element,getActions:()=>e.addPrimaryActionToDropdown===!1?[...o]:[this.action,...o],actionRunner:e.actionRunner,onHide:()=>this.dropdownButton.element.setAttribute("aria-expanded","false")}),this.dropdownButton.element.setAttribute("aria-expanded","true")}))}dispose(){super.dispose(),this.element.remove()}set label(t){this.button.label=t,this.action.label=t}set icon(t){this.button.icon=t}set enabled(t){this.button.enabled=t,this.dropdownButton.enabled=t,this.element.classList.toggle("disabled",!t)}get enabled(){return this.button.enabled}set checked(t){this.button.checked=t}get checked(){return this.button.checked}focus(){this.button.focus()}hasFocus(){return this.button.hasFocus()||this.dropdownButton.hasFocus()}}class W{constructor(t,e){this.options=e;this._element=document.createElement("div"),this._element.classList.add("monaco-description-button"),this._button=new u(this._element,e),this._descriptionElement=document.createElement("div"),this._descriptionElement.classList.add("monaco-button-description"),this._element.appendChild(this._descriptionElement),t.appendChild(this._element)}_button;_element;_descriptionElement;get onDidClick(){return this._button.onDidClick}get element(){return this._element}set label(t){this._button.label=t}set icon(t){this._button.icon=t}get enabled(){return this._button.enabled}set enabled(t){this._button.enabled=t}set checked(t){this._button.checked=t}get checked(){return this._button.checked}focus(){this._button.focus()}hasFocus(){return this._button.hasFocus()}dispose(){this._button.dispose()}set description(t){this.options.supportIcons?d(this._descriptionElement,...f(t)):this._descriptionElement.textContent=t}}class bt{constructor(t){this.container=t}_buttons=[];_buttonStore=new x;dispose(){this._buttonStore.dispose()}get buttons(){return this._buttons}clear(){this._buttonStore.clear(),this._buttons.length=0}addButton(t){const e=this._buttonStore.add(new u(this.container,t));return this.pushButton(e),e}addButtonWithDescription(t){const e=this._buttonStore.add(new W(this.container,t));return this.pushButton(e),e}addButtonWithDropdown(t){const e=this._buttonStore.add(new O(this.container,t));return this.pushButton(e),e}pushButton(t){this._buttons.push(t);const e=this._buttons.length-1;this._buttonStore.add(s(t.element,a.KEY_DOWN,n=>{const r=new _(n);let i=!0,o;r.equals(l.LeftArrow)?o=e>0?e-1:this._buttons.length-1:r.equals(l.RightArrow)?o=e===this._buttons.length-1?0:e+1:i=!1,i&&typeof o=="number"&&(this._buttons[o].focus(),p.stop(n,!0))}))}}export{u as Button,bt as ButtonBar,W as ButtonWithDescription,O as ButtonWithDropdown,mt as unthemedButtonStyles};
