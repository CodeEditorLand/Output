import{EditContext as c}from"./editContextFactory.js";const h="blue",v="red",_="green";class E{_isDebugging=!0;_controlBounds=null;_selectionBounds=null;_characterBounds=null;_editContext;constructor(e,t){this._editContext=c.create(e,t)}get text(){return this._editContext.text}get selectionStart(){return this._editContext.selectionStart}get selectionEnd(){return this._editContext.selectionEnd}get characterBoundsRangeStart(){return this._editContext.characterBoundsRangeStart}updateText(e,t,n){this._editContext.updateText(e,t,n),this.renderDebug()}updateSelection(e,t){this._editContext.updateSelection(e,t),this.renderDebug()}updateControlBounds(e){this._editContext.updateControlBounds(e),this._controlBounds=e,this.renderDebug()}updateSelectionBounds(e){this._editContext.updateSelectionBounds(e),this._selectionBounds=e,this.renderDebug()}updateCharacterBounds(e,t){this._editContext.updateCharacterBounds(e,t),this._characterBounds={rangeStart:e,characterBounds:t},this.renderDebug()}attachedElements(){return this._editContext.attachedElements()}characterBounds(){return this._editContext.characterBounds()}_ontextupdateWrapper=new o("textupdate",this);_ontextformatupdateWrapper=new o("textformatupdate",this);_oncharacterboundsupdateWrapper=new o("characterboundsupdate",this);_oncompositionstartWrapper=new o("compositionstart",this);_oncompositionendWrapper=new o("compositionend",this);get ontextupdate(){return this._ontextupdateWrapper.eventHandler}set ontextupdate(e){this._ontextupdateWrapper.eventHandler=e}get ontextformatupdate(){return this._ontextformatupdateWrapper.eventHandler}set ontextformatupdate(e){this._ontextformatupdateWrapper.eventHandler=e}get oncharacterboundsupdate(){return this._oncharacterboundsupdateWrapper.eventHandler}set oncharacterboundsupdate(e){this._oncharacterboundsupdateWrapper.eventHandler=e}get oncompositionstart(){return this._oncompositionstartWrapper.eventHandler}set oncompositionstart(e){this._oncompositionstartWrapper.eventHandler=e}get oncompositionend(){return this._oncompositionendWrapper.eventHandler}set oncompositionend(e){this._oncompositionendWrapper.eventHandler=e}_listenerMap=new Map;addEventListener(e,t,n){if(!t)return;const s=d=>{this._isDebugging&&this.renderDebug(),typeof t=="function"?t.call(this,d):typeof t=="object"&&"handleEvent"in t&&t.handleEvent(d)};this._listenerMap.set(t,s),this._editContext.addEventListener(e,s,n),this.renderDebug()}removeEventListener(e,t,n){if(!t)return;const s=this._listenerMap.get(t);s&&(this._editContext.removeEventListener(e,s,n),this._listenerMap.delete(t)),this.renderDebug()}dispatchEvent(e){return this._editContext.dispatchEvent(e)}startDebugging(){this._isDebugging=!0,this.renderDebug()}endDebugging(){this._isDebugging=!1,this.renderDebug()}_disposables=[];renderDebug(){if(this._disposables.forEach(e=>e.dispose()),this._disposables=[],!(!this._isDebugging||this._listenerMap.size===0)){if(this._controlBounds&&this._disposables.push(a(this._controlBounds,h)),this._selectionBounds&&this._disposables.push(a(this._selectionBounds,v)),this._characterBounds)for(const e of this._characterBounds.characterBounds)this._disposables.push(a(e,_));this._disposables.push(b(this._editContext.text,this._editContext.selectionStart,this._editContext.selectionEnd))}}}function b(r,e,t){const n=document.createElement("div");n.className="debug-rect-marker",n.style.position="absolute",n.style.zIndex="999999999",n.style.bottom="50px",n.style.left="60px",n.style.backgroundColor="white",n.style.border="1px solid black",n.style.padding="5px",n.style.whiteSpace="pre",n.style.font="12px monospace",n.style.pointerEvents="none";const s=r.substring(0,e),d=r.substring(e,t)||"|",l=r.substring(t)+" ",p=document.createTextNode(s);n.appendChild(p);const i=document.createElement("span");i.style.backgroundColor="yellow",i.appendChild(document.createTextNode(d)),i.style.minWidth="2px",i.style.minHeight="16px",n.appendChild(i);const u=document.createTextNode(l);return n.appendChild(u),document.body.appendChild(n),{dispose:()=>{n.remove()}}}function a(r,e){const t=document.createElement("div");return t.className="debug-rect-marker",t.style.position="absolute",t.style.zIndex="999999999",t.style.outline=`2px solid ${e}`,t.style.pointerEvents="none",t.style.top=r.top+"px",t.style.left=r.left+"px",t.style.width=r.width+"px",t.style.height=r.height+"px",document.body.appendChild(t),{dispose:()=>{t.remove()}}}class o{constructor(e,t){this._eventType=e;this._target=t}_eventHandler=null;get eventHandler(){return this._eventHandler}set eventHandler(e){this._eventHandler&&this._target.removeEventListener(this._eventType,this._eventHandler),this._eventHandler=e,e&&this._target.addEventListener(this._eventType,e)}}export{E as DebugEditContext};
