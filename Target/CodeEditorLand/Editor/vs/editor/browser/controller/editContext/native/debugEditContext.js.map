{
  "version": 3,
  "sources": ["../../../../../../../../../../../Dependency/Land/Dependency/Editor/Source/vs/editor/browser/controller/editContext/native/debugEditContext.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { EditContext } from './editContextFactory.js';\n\nconst COLOR_FOR_CONTROL_BOUNDS = 'blue';\nconst COLOR_FOR_SELECTION_BOUNDS = 'red';\nconst COLOR_FOR_CHARACTER_BOUNDS = 'green';\n\nexport class DebugEditContext {\n\tprivate _isDebugging = true;\n\tprivate _controlBounds: DOMRect | null = null;\n\tprivate _selectionBounds: DOMRect | null = null;\n\tprivate _characterBounds: { rangeStart: number; characterBounds: DOMRect[] } | null = null;\n\n\tprivate _editContext: EditContext;\n\n\tconstructor(window: Window, options?: EditContextInit | undefined) {\n\t\tthis._editContext = EditContext.create(window, options);\n\t}\n\n\tget text(): DOMString {\n\t\treturn this._editContext.text;\n\t}\n\n\tget selectionStart(): number {\n\t\treturn this._editContext.selectionStart;\n\t}\n\n\tget selectionEnd(): number {\n\t\treturn this._editContext.selectionEnd;\n\t}\n\n\tget characterBoundsRangeStart(): number {\n\t\treturn this._editContext.characterBoundsRangeStart;\n\t}\n\n\tupdateText(rangeStart: number, rangeEnd: number, text: string): void {\n\t\tthis._editContext.updateText(rangeStart, rangeEnd, text);\n\t\tthis.renderDebug();\n\t}\n\tupdateSelection(start: number, end: number): void {\n\t\tthis._editContext.updateSelection(start, end);\n\t\tthis.renderDebug();\n\t}\n\tupdateControlBounds(controlBounds: DOMRect): void {\n\t\tthis._editContext.updateControlBounds(controlBounds);\n\t\tthis._controlBounds = controlBounds;\n\t\tthis.renderDebug();\n\t}\n\tupdateSelectionBounds(selectionBounds: DOMRect): void {\n\t\tthis._editContext.updateSelectionBounds(selectionBounds);\n\t\tthis._selectionBounds = selectionBounds;\n\t\tthis.renderDebug();\n\t}\n\tupdateCharacterBounds(rangeStart: number, characterBounds: DOMRect[]): void {\n\t\tthis._editContext.updateCharacterBounds(rangeStart, characterBounds);\n\t\tthis._characterBounds = { rangeStart, characterBounds };\n\t\tthis.renderDebug();\n\t}\n\tattachedElements(): HTMLElement[] {\n\t\treturn this._editContext.attachedElements();\n\t}\n\n\tcharacterBounds(): DOMRect[] {\n\t\treturn this._editContext.characterBounds();\n\t}\n\n\tprivate readonly _ontextupdateWrapper = new EventListenerWrapper('textupdate', this);\n\tprivate readonly _ontextformatupdateWrapper = new EventListenerWrapper('textformatupdate', this);\n\tprivate readonly _oncharacterboundsupdateWrapper = new EventListenerWrapper('characterboundsupdate', this);\n\tprivate readonly _oncompositionstartWrapper = new EventListenerWrapper('compositionstart', this);\n\tprivate readonly _oncompositionendWrapper = new EventListenerWrapper('compositionend', this);\n\n\tget ontextupdate(): EventHandler | null { return this._ontextupdateWrapper.eventHandler; }\n\tset ontextupdate(value: EventHandler | null) { this._ontextupdateWrapper.eventHandler = value; }\n\tget ontextformatupdate(): EventHandler | null { return this._ontextformatupdateWrapper.eventHandler; }\n\tset ontextformatupdate(value: EventHandler | null) { this._ontextformatupdateWrapper.eventHandler = value; }\n\tget oncharacterboundsupdate(): EventHandler | null { return this._oncharacterboundsupdateWrapper.eventHandler; }\n\tset oncharacterboundsupdate(value: EventHandler | null) { this._oncharacterboundsupdateWrapper.eventHandler = value; }\n\tget oncompositionstart(): EventHandler | null { return this._oncompositionstartWrapper.eventHandler; }\n\tset oncompositionstart(value: EventHandler | null) { this._oncompositionstartWrapper.eventHandler = value; }\n\tget oncompositionend(): EventHandler | null { return this._oncompositionendWrapper.eventHandler; }\n\tset oncompositionend(value: EventHandler | null) { this._oncompositionendWrapper.eventHandler = value; }\n\n\n\tprivate readonly _listenerMap = new Map<EventListenerOrEventListenerObject, EventListenerOrEventListenerObject>();\n\n\taddEventListener<K extends keyof EditContextEventHandlersEventMap>(type: K, listener: (this: GlobalEventHandlers, ev: EditContextEventHandlersEventMap[K]) => any, options?: boolean | AddEventListenerOptions): void;\n\taddEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions): void {\n\t\tif (!listener) { return; }\n\n\t\tconst debugListener = (event: Event) => {\n\t\t\tif (this._isDebugging) {\n\t\t\t\tthis.renderDebug();\n\t\t\t\tconsole.log(`DebugEditContex.on_${type}`, event);\n\t\t\t}\n\t\t\tif (typeof listener === 'function') {\n\t\t\t\tlistener.call(this, event);\n\t\t\t} else if (typeof listener === 'object' && 'handleEvent' in listener) {\n\t\t\t\tlistener.handleEvent(event);\n\t\t\t}\n\t\t};\n\t\tthis._listenerMap.set(listener, debugListener);\n\t\tthis._editContext.addEventListener(type, debugListener, options);\n\t\tthis.renderDebug();\n\t}\n\n\tremoveEventListener(type: string, listener: EventListenerOrEventListenerObject | null, options?: boolean | EventListenerOptions | undefined): void {\n\t\tif (!listener) { return; }\n\t\tconst debugListener = this._listenerMap.get(listener);\n\t\tif (debugListener) {\n\t\t\tthis._editContext.removeEventListener(type, debugListener, options);\n\t\t\tthis._listenerMap.delete(listener);\n\t\t}\n\t\tthis.renderDebug();\n\t}\n\n\tdispatchEvent(event: Event): boolean {\n\t\treturn this._editContext.dispatchEvent(event);\n\t}\n\n\tpublic startDebugging() {\n\t\tthis._isDebugging = true;\n\t\tthis.renderDebug();\n\t}\n\n\tpublic endDebugging() {\n\t\tthis._isDebugging = false;\n\t\tthis.renderDebug();\n\t}\n\n\tprivate _disposables: { dispose(): void }[] = [];\n\n\tpublic renderDebug() {\n\t\tthis._disposables.forEach(d => d.dispose());\n\t\tthis._disposables = [];\n\t\tif (!this._isDebugging || this._listenerMap.size === 0) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._controlBounds) {\n\t\t\tthis._disposables.push(createRect(this._controlBounds, COLOR_FOR_CONTROL_BOUNDS));\n\t\t}\n\t\tif (this._selectionBounds) {\n\t\t\tthis._disposables.push(createRect(this._selectionBounds, COLOR_FOR_SELECTION_BOUNDS));\n\t\t}\n\t\tif (this._characterBounds) {\n\t\t\tfor (const rect of this._characterBounds.characterBounds) {\n\t\t\t\tthis._disposables.push(createRect(rect, COLOR_FOR_CHARACTER_BOUNDS));\n\t\t\t}\n\t\t}\n\t\tthis._disposables.push(createDiv(this._editContext.text, this._editContext.selectionStart, this._editContext.selectionEnd));\n\t}\n}\n\nfunction createDiv(text: string, selectionStart: number, selectionEnd: number) {\n\tconst ret = document.createElement('div');\n\tret.className = 'debug-rect-marker';\n\tret.style.position = 'absolute';\n\tret.style.zIndex = '999999999';\n\tret.style.bottom = '50px';\n\tret.style.left = '60px';\n\tret.style.backgroundColor = 'white';\n\tret.style.border = '1px solid black';\n\tret.style.padding = '5px';\n\tret.style.whiteSpace = 'pre';\n\tret.style.font = '12px monospace';\n\tret.style.pointerEvents = 'none';\n\n\tconst before = text.substring(0, selectionStart);\n\tconst selected = text.substring(selectionStart, selectionEnd) || '|';\n\tconst after = text.substring(selectionEnd) + ' ';\n\n\tconst beforeNode = document.createTextNode(before);\n\tret.appendChild(beforeNode);\n\n\tconst selectedNode = document.createElement('span');\n\tselectedNode.style.backgroundColor = 'yellow';\n\tselectedNode.appendChild(document.createTextNode(selected));\n\n\tselectedNode.style.minWidth = '2px';\n\tselectedNode.style.minHeight = '16px';\n\tret.appendChild(selectedNode);\n\n\tconst afterNode = document.createTextNode(after);\n\tret.appendChild(afterNode);\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tdocument.body.appendChild(ret);\n\n\treturn {\n\t\tdispose: () => {\n\t\t\tret.remove();\n\t\t}\n\t};\n}\n\nfunction createRect(rect: DOMRect, color: 'green' | 'blue' | 'red') {\n\tconst ret = document.createElement('div');\n\tret.className = 'debug-rect-marker';\n\tret.style.position = 'absolute';\n\tret.style.zIndex = '999999999';\n\tret.style.outline = `2px solid ${color}`;\n\tret.style.pointerEvents = 'none';\n\n\tret.style.top = rect.top + 'px';\n\tret.style.left = rect.left + 'px';\n\tret.style.width = rect.width + 'px';\n\tret.style.height = rect.height + 'px';\n\n\t// eslint-disable-next-line no-restricted-syntax\n\tdocument.body.appendChild(ret);\n\n\treturn {\n\t\tdispose: () => {\n\t\t\tret.remove();\n\t\t}\n\t};\n}\n\nclass EventListenerWrapper {\n\tprivate _eventHandler: EventHandler | null = null;\n\n\tconstructor(\n\t\tprivate readonly _eventType: string,\n\t\tprivate readonly _target: EventTarget,\n\t) {\n\t}\n\n\tget eventHandler(): EventHandler | null {\n\t\treturn this._eventHandler;\n\t}\n\n\tset eventHandler(value: EventHandler | null) {\n\t\tif (this._eventHandler) {\n\t\t\tthis._target.removeEventListener(this._eventType, this._eventHandler);\n\t\t}\n\t\tthis._eventHandler = value;\n\t\tif (value) {\n\t\t\tthis._target.addEventListener(this._eventType, value);\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
