var E=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var I=(d,i,n,t)=>{for(var e=t>1?void 0:t?S(i,n):i,s=d.length-1,a;s>=0;s--)(a=d[s])&&(e=(t?a(i,n,e):a(e))||e);return t&&e&&E(i,n,e),e},c=(d,i)=>(n,t)=>i(n,t,d);import"../../../../../base/common/cancellation.js";import{Disposable as g}from"../../../../../base/common/lifecycle.js";import{autorunWithStore as x,observableSignalFromEvent as P}from"../../../../../base/common/observable.js";import{IConfigurationService as h}from"../../../../../platform/configuration/common/configuration.js";import{IInstantiationService as F}from"../../../../../platform/instantiation/common/instantiation.js";import{observableConfigValue as b}from"../../../../../platform/observable/common/platformObservableUtils.js";import"../../../../browser/editorBrowser.js";import"../../../../common/core/position.js";import{InlineEditTriggerKind as y}from"../../../../common/languages.js";import"../../../../common/model.js";import{ILanguageFeaturesService as T}from"../../../../common/services/languageFeatures.js";let l=class extends g{constructor(n,t){super();this.instantiationService=t;l.isFirst&&(l.isFirst=!1,this.instantiationService.createInstance(o))}static ID="editor.contrib.inlineEditsAdapter";static isFirst=!0};l=I([c(1,F)],l);let o=class extends g{constructor(n,t){super();this._languageFeaturesService=n;this._configurationService=t;const e=P("didChangeSignal",this._languageFeaturesService.inlineEditProvider.onDidChange);this._register(x((s,a)=>{this._inlineCompletionInlineEdits.read(s)&&(e.read(s),a.add(this._languageFeaturesService.inlineCompletionsProvider.register("*",new class{async provideInlineCompletions(m,p,_,f){const C=n.inlineEditProvider.all(m),u=(await Promise.all(C.map(async r=>{const v=await r.provideInlineEdit(m,{triggerKind:y.Automatic},f);if(v)return{result:v,provider:r}}))).filter(r=>!!r);return{edits:u,items:u.map(r=>({range:r.result.range,insertText:r.result.text,command:r.result.accepted,isInlineEdit:!0}))}}freeInlineCompletions(m){for(const p of m.edits)p.provider.freeInlineEdit(p.result)}})))}))}static experimentalInlineEditsEnabled="editor.inlineSuggest.experimentalInlineEditsEnabled";_inlineCompletionInlineEdits=b(o.experimentalInlineEditsEnabled,!1,this._configurationService)};o=I([c(0,T),c(1,h)],o);export{o as InlineEditsAdapter,l as InlineEditsAdapterContribution};
