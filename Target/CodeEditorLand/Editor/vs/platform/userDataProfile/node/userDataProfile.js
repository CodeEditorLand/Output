var E=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var I=(c,o,t,e)=>{for(var r=e>1?void 0:e?f(o,t):o,S=c.length-1,a;S>=0;S--)(a=c[S])&&(r=(e?a(o,t,r):a(r))||r);return e&&r&&E(o,t,r),r},i=(c,o)=>(t,e)=>o(t,e,c);import{URI as h}from"../../../base/common/uri.js";import{INativeEnvironmentService as m}from"../../environment/common/environment.js";import{IFileService as d}from"../../files/common/files.js";import{ILogService as p}from"../../log/common/log.js";import{IStateReadService as u,IStateService as P}from"../../state/node/state.js";import{IUriIdentityService as l}from"../../uriIdentity/common/uriIdentity.js";import{UserDataProfilesService as g}from"../common/userDataProfile.js";import{isString as x}from"../../../base/common/types.js";import{SaveStrategy as y,StateService as O}from"../../state/node/stateService.js";let n=class extends g{constructor(t,e,r,S,a){super(r,S,e,a);this.stateReadonlyService=t;this.nativeEnvironmentService=r}getStoredProfiles(){return this.stateReadonlyService.getItem(n.PROFILES_KEY,[]).map(e=>({...e,location:x(e.location)?this.uriIdentityService.extUri.joinPath(this.profilesHome,e.location):h.revive(e.location)}))}getStoredProfileAssociations(){return this.stateReadonlyService.getItem(n.PROFILE_ASSOCIATIONS_KEY,{})}getDefaultProfileExtensionsLocation(){return this.uriIdentityService.extUri.joinPath(h.file(this.nativeEnvironmentService.extensionsPath).with({scheme:this.profilesHome.scheme}),"extensions.json")}};n=I([i(0,u),i(1,l),i(2,m),i(3,d),i(4,p)],n);let s=class extends n{constructor(t,e,r,S,a){super(t,e,r,S,a);this.stateService=t}saveStoredProfiles(t){t.length?this.stateService.setItem(s.PROFILES_KEY,t.map(e=>({...e,location:this.uriIdentityService.extUri.basename(e.location)}))):this.stateService.removeItem(s.PROFILES_KEY)}saveStoredProfileAssociations(t){t.emptyWindows||t.workspaces?this.stateService.setItem(s.PROFILE_ASSOCIATIONS_KEY,t):this.stateService.removeItem(s.PROFILE_ASSOCIATIONS_KEY)}};s=I([i(0,P),i(1,l),i(2,m),i(3,d),i(4,p)],s);let v=class extends s{constructor(o,t,e,r){super(new O(y.IMMEDIATE,t,r,e),o,t,e,r)}async init(){return await this.stateService.init(),super.init()}};v=I([i(0,l),i(1,m),i(2,d),i(3,p)],v);export{v as ServerUserDataProfilesService,n as UserDataProfilesReadonlyService,s as UserDataProfilesService};
