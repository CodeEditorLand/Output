{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/Land/Dependency/Editor/Source/vs/workbench/contrib/authentication/browser/authentication.contribution.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IJSONSchema } from '../../../../base/common/jsonSchema.js';\nimport { Disposable, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { isFalsyOrWhitespace } from '../../../../base/common/strings.js';\nimport { localize } from '../../../../nls.js';\nimport { MenuId, MenuRegistry, registerAction2 } from '../../../../platform/actions/common/actions.js';\nimport { CommandsRegistry } from '../../../../platform/commands/common/commands.js';\nimport { ContextKeyExpr } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IExtensionManifest } from '../../../../platform/extensions/common/extensions.js';\nimport { SyncDescriptor } from '../../../../platform/instantiation/common/descriptors.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { IWorkbenchContribution, WorkbenchPhase, registerWorkbenchContribution2 } from '../../../common/contributions.js';\nimport { SignOutOfAccountAction } from './actions/signOutOfAccountAction.js';\nimport { AuthenticationProviderInformation, IAuthenticationService } from '../../../services/authentication/common/authentication.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../../../services/environment/browser/environmentService.js';\nimport { Extensions, IExtensionFeatureTableRenderer, IExtensionFeaturesRegistry, IRenderedData, IRowData, ITableData } from '../../../services/extensionManagement/common/extensionFeatures.js';\nimport { ExtensionsRegistry } from '../../../services/extensions/common/extensionsRegistry.js';\nimport { ManageTrustedExtensionsForAccountAction } from './actions/manageTrustedExtensionsForAccountAction.js';\nimport { ManageAccountPreferencesForExtensionAction } from './actions/manageAccountPreferencesForExtensionAction.js';\nimport { IAuthenticationUsageService } from '../../../services/authentication/browser/authenticationUsageService.js';\n\nconst codeExchangeProxyCommand = CommandsRegistry.registerCommand('workbench.getCodeExchangeProxyEndpoints', function (accessor, _) {\n\tconst environmentService = accessor.get(IBrowserWorkbenchEnvironmentService);\n\treturn environmentService.options?.codeExchangeProxyEndpoints;\n});\n\nconst authenticationDefinitionSchema: IJSONSchema = {\n\ttype: 'object',\n\tadditionalProperties: false,\n\tproperties: {\n\t\tid: {\n\t\t\ttype: 'string',\n\t\t\tdescription: localize('authentication.id', 'The id of the authentication provider.')\n\t\t},\n\t\tlabel: {\n\t\t\ttype: 'string',\n\t\t\tdescription: localize('authentication.label', 'The human readable name of the authentication provider.'),\n\t\t}\n\t}\n};\n\nconst authenticationExtPoint = ExtensionsRegistry.registerExtensionPoint<AuthenticationProviderInformation[]>({\n\textensionPoint: 'authentication',\n\tjsonSchema: {\n\t\tdescription: localize({ key: 'authenticationExtensionPoint', comment: [`'Contributes' means adds here`] }, 'Contributes authentication'),\n\t\ttype: 'array',\n\t\titems: authenticationDefinitionSchema\n\t},\n\tactivationEventsGenerator: (authenticationProviders, result) => {\n\t\tfor (const authenticationProvider of authenticationProviders) {\n\t\t\tif (authenticationProvider.id) {\n\t\t\t\tresult.push(`onAuthenticationRequest:${authenticationProvider.id}`);\n\t\t\t}\n\t\t}\n\t}\n});\n\nclass AuthenticationDataRenderer extends Disposable implements IExtensionFeatureTableRenderer {\n\n\treadonly type = 'table';\n\n\tshouldRender(manifest: IExtensionManifest): boolean {\n\t\treturn !!manifest.contributes?.authentication;\n\t}\n\n\trender(manifest: IExtensionManifest): IRenderedData<ITableData> {\n\t\tconst authentication = manifest.contributes?.authentication || [];\n\t\tif (!authentication.length) {\n\t\t\treturn { data: { headers: [], rows: [] }, dispose: () => { } };\n\t\t}\n\n\t\tconst headers = [\n\t\t\tlocalize('authenticationlabel', \"Label\"),\n\t\t\tlocalize('authenticationid', \"ID\"),\n\t\t];\n\n\t\tconst rows: IRowData[][] = authentication\n\t\t\t.sort((a, b) => a.label.localeCompare(b.label))\n\t\t\t.map(auth => {\n\t\t\t\treturn [\n\t\t\t\t\tauth.label,\n\t\t\t\t\tauth.id,\n\t\t\t\t];\n\t\t\t});\n\n\t\treturn {\n\t\t\tdata: {\n\t\t\t\theaders,\n\t\t\t\trows\n\t\t\t},\n\t\t\tdispose: () => { }\n\t\t};\n\t}\n}\n\nconst extensionFeature = Registry.as<IExtensionFeaturesRegistry>(Extensions.ExtensionFeaturesRegistry).registerExtensionFeature({\n\tid: 'authentication',\n\tlabel: localize('authentication', \"Authentication\"),\n\taccess: {\n\t\tcanToggle: false\n\t},\n\trenderer: new SyncDescriptor(AuthenticationDataRenderer),\n});\n\nclass AuthenticationContribution extends Disposable implements IWorkbenchContribution {\n\tstatic ID = 'workbench.contrib.authentication';\n\n\tprivate _placeholderMenuItem: IDisposable | undefined = MenuRegistry.appendMenuItem(MenuId.AccountsContext, {\n\t\tcommand: {\n\t\t\tid: 'noAuthenticationProviders',\n\t\t\ttitle: localize('authentication.Placeholder', \"No accounts requested yet...\"),\n\t\t\tprecondition: ContextKeyExpr.false()\n\t\t},\n\t});\n\n\tconstructor(@IAuthenticationService private readonly _authenticationService: IAuthenticationService) {\n\t\tsuper();\n\t\tthis._register(codeExchangeProxyCommand);\n\t\tthis._register(extensionFeature);\n\n\t\t// Clear the placeholder menu item if there are already providers registered.\n\t\tif (_authenticationService.getProviderIds().length) {\n\t\t\tthis._clearPlaceholderMenuItem();\n\t\t}\n\t\tthis._registerHandlers();\n\t\tthis._registerAuthenticationExtentionPointHandler();\n\t\tthis._registerActions();\n\t}\n\n\tprivate _registerAuthenticationExtentionPointHandler(): void {\n\t\tauthenticationExtPoint.setHandler((extensions, { added, removed }) => {\n\t\t\tadded.forEach(point => {\n\t\t\t\tfor (const provider of point.value) {\n\t\t\t\t\tif (isFalsyOrWhitespace(provider.id)) {\n\t\t\t\t\t\tpoint.collector.error(localize('authentication.missingId', 'An authentication contribution must specify an id.'));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isFalsyOrWhitespace(provider.label)) {\n\t\t\t\t\t\tpoint.collector.error(localize('authentication.missingLabel', 'An authentication contribution must specify a label.'));\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this._authenticationService.declaredProviders.some(p => p.id === provider.id)) {\n\t\t\t\t\t\tthis._authenticationService.registerDeclaredAuthenticationProvider(provider);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpoint.collector.error(localize('authentication.idConflict', \"This authentication id '{0}' has already been registered\", provider.id));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst removedExtPoints = removed.flatMap(r => r.value);\n\t\t\tremovedExtPoints.forEach(point => {\n\t\t\t\tconst provider = this._authenticationService.declaredProviders.find(provider => provider.id === point.id);\n\t\t\t\tif (provider) {\n\t\t\t\t\tthis._authenticationService.unregisterDeclaredAuthenticationProvider(provider.id);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate _registerHandlers(): void {\n\t\tthis._register(this._authenticationService.onDidRegisterAuthenticationProvider(_e => {\n\t\t\tthis._clearPlaceholderMenuItem();\n\t\t}));\n\t\tthis._register(this._authenticationService.onDidUnregisterAuthenticationProvider(_e => {\n\t\t\tif (!this._authenticationService.getProviderIds().length) {\n\t\t\t\tthis._placeholderMenuItem = MenuRegistry.appendMenuItem(MenuId.AccountsContext, {\n\t\t\t\t\tcommand: {\n\t\t\t\t\t\tid: 'noAuthenticationProviders',\n\t\t\t\t\t\ttitle: localize('loading', \"Loading...\"),\n\t\t\t\t\t\tprecondition: ContextKeyExpr.false()\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _registerActions(): void {\n\t\tthis._register(registerAction2(SignOutOfAccountAction));\n\t\tthis._register(registerAction2(ManageTrustedExtensionsForAccountAction));\n\t\tthis._register(registerAction2(ManageAccountPreferencesForExtensionAction));\n\t}\n\n\tprivate _clearPlaceholderMenuItem(): void {\n\t\tthis._placeholderMenuItem?.dispose();\n\t\tthis._placeholderMenuItem = undefined;\n\t}\n}\n\nclass AuthenticationUsageContribution implements IWorkbenchContribution {\n\tstatic ID = 'workbench.contrib.authenticationUsage';\n\n\tconstructor(\n\t\t@IAuthenticationUsageService private readonly _authenticationUsageService: IAuthenticationUsageService,\n\t) {\n\t\tthis._initializeExtensionUsageCache();\n\t}\n\n\tprivate async _initializeExtensionUsageCache() {\n\t\tawait this._authenticationUsageService.initializeExtensionUsageCache();\n\t}\n}\n\nregisterWorkbenchContribution2(AuthenticationContribution.ID, AuthenticationContribution, WorkbenchPhase.AfterRestored);\nregisterWorkbenchContribution2(AuthenticationUsageContribution.ID, AuthenticationUsageContribution, WorkbenchPhase.Eventually);\n"],
  "mappings": "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",
  "names": ["provider"]
}
