{
  "version": 3,
  "sources": ["../../../../../../../../../../../Dependency/Land/Dependency/Editor/Source/vs/workbench/contrib/chat/browser/actions/chatAccessibilityHelp.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../../nls.js';\nimport { ICodeEditor } from '../../../../../editor/browser/editorBrowser.js';\nimport { ServicesAccessor } from '../../../../../editor/browser/editorExtensions.js';\nimport { IChatWidgetService } from '../chat.js';\nimport { AccessibleViewProviderId, AccessibleViewType, AccessibleContentProvider } from '../../../../../platform/accessibility/browser/accessibleView.js';\nimport { AccessibilityVerbositySettingId } from '../../../accessibility/browser/accessibilityConfiguration.js';\nimport { AccessibleDiffViewerNext } from '../../../../../editor/browser/widget/diffEditor/commands.js';\nimport { INLINE_CHAT_ID } from '../../../inlineChat/common/inlineChat.js';\nimport { ICodeEditorService } from '../../../../../editor/browser/services/codeEditorService.js';\nimport { ContextKeyExpr } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { CONTEXT_IN_CHAT_SESSION, CONTEXT_RESPONSE, CONTEXT_REQUEST, CONTEXT_CHAT_LOCATION, CONTEXT_IN_QUICK_CHAT } from '../../common/chatContextKeys.js';\nimport { IAccessibleViewImplentation } from '../../../../../platform/accessibility/browser/accessibleViewRegistry.js';\nimport { ChatAgentLocation } from '../../common/chatAgents.js';\nimport { IKeybindingService } from '../../../../../platform/keybinding/common/keybinding.js';\n\nexport class PanelChatAccessibilityHelp implements IAccessibleViewImplentation {\n\treadonly priority = 107;\n\treadonly name = 'panelChat';\n\treadonly type = AccessibleViewType.Help;\n\treadonly when = ContextKeyExpr.and(CONTEXT_CHAT_LOCATION.isEqualTo(ChatAgentLocation.Panel), CONTEXT_IN_QUICK_CHAT.negate(), ContextKeyExpr.or(CONTEXT_IN_CHAT_SESSION, CONTEXT_RESPONSE, CONTEXT_REQUEST));\n\tgetProvider(accessor: ServicesAccessor) {\n\t\tconst codeEditor = accessor.get(ICodeEditorService).getActiveCodeEditor() || accessor.get(ICodeEditorService).getFocusedCodeEditor();\n\t\treturn getChatAccessibilityHelpProvider(accessor, codeEditor ?? undefined, 'panelChat');\n\t}\n}\n\nexport class QuickChatAccessibilityHelp implements IAccessibleViewImplentation {\n\treadonly priority = 107;\n\treadonly name = 'quickChat';\n\treadonly type = AccessibleViewType.Help;\n\treadonly when = ContextKeyExpr.and(CONTEXT_IN_QUICK_CHAT, ContextKeyExpr.or(CONTEXT_IN_CHAT_SESSION, CONTEXT_RESPONSE, CONTEXT_REQUEST));\n\tgetProvider(accessor: ServicesAccessor) {\n\t\tconst codeEditor = accessor.get(ICodeEditorService).getActiveCodeEditor() || accessor.get(ICodeEditorService).getFocusedCodeEditor();\n\t\treturn getChatAccessibilityHelpProvider(accessor, codeEditor ?? undefined, 'quickChat');\n\t}\n}\n\nexport function getAccessibilityHelpText(type: 'panelChat' | 'inlineChat' | 'quickChat', keybindingService: IKeybindingService): string {\n\tconst content = [];\n\tif (type === 'panelChat' || type === 'quickChat') {\n\t\tcontent.push(localize('chat.overview', 'The chat view is comprised of an input box and a request/response list. The input box is used to make requests and the list is used to display responses.'));\n\t\tcontent.push(localize('chat.requestHistory', 'In the input box, use up and down arrows to navigate your request history. Edit input and use enter or the submit button to run a new request.'));\n\t\tcontent.push(localize('chat.inspectResponse', 'In the input box, inspect the last response in the accessible view{0}.', '<keybinding:editor.action.accessibleView>'));\n\t\tcontent.push(localize('chat.followUp', 'In the input box, navigate to the suggested follow up question (Shift+Tab) and press Enter to run it.'));\n\t\tcontent.push(localize('chat.announcement', 'Chat responses will be announced as they come in. A response will indicate the number of code blocks, if any, and then the rest of the response.'));\n\t\tcontent.push(localize('workbench.action.chat.focus', 'To focus the chat request/response list, which can be navigated with up and down arrows, invoke the Focus Chat command{0}.', getChatFocusKeybindingLabel(keybindingService, type, false)));\n\t\tcontent.push(localize('workbench.action.chat.focusInput', 'To focus the input box for chat requests, invoke the Focus Chat Input command{0}.', getChatFocusKeybindingLabel(keybindingService, type, true)));\n\t\tcontent.push(localize('workbench.action.chat.nextCodeBlock', 'To focus the next code block within a response, invoke the Chat: Next Code Block command{0}.', '<keybinding:workbench.action.chat.nextCodeBlock>'));\n\t\tif (type === 'panelChat') {\n\t\t\tcontent.push(localize('workbench.action.chat.newChat', 'To create a new chat session, invoke the New Chat command{0}.', '<keybinding:workbench.action.chat.new>'));\n\t\t}\n\t}\n\telse {\n\t\tcontent.push(localize('inlineChat.overview', \"Inline chat occurs within a code editor and takes into account the current selection. It is useful for making changes to the current editor. For example, fixing diagnostics, documenting or refactoring code. Keep in mind that AI generated code may be incorrect.\"));\n\t\tcontent.push(localize('inlineChat.access', \"It can be activated via code actions or directly using the command: Inline Chat: Start Inline Chat{0}.\", '<keybinding:inlineChat.start>'));\n\t\tcontent.push(localize('inlineChat.requestHistory', 'In the input box, use Show Previous{0} and Show Next{1} to navigate your request history. Edit input and use enter or the submit button to run a new request.', '<keybinding:history.showPrevious>', '<keybinding:history.showNext>'));\n\t\tcontent.push(localize('inlineChat.inspectResponse', 'In the input box, inspect the response in the accessible view{0}.', '<keybinding:editor.action.accessibleView>'));\n\t\tcontent.push(localize('inlineChat.contextActions', \"Context menu actions may run a request prefixed with a /. Type / to discover such ready-made commands.\"));\n\t\tcontent.push(localize('inlineChat.fix', \"If a fix action is invoked, a response will indicate the problem with the current code. A diff editor will be rendered and can be reached by tabbing.\"));\n\t\tcontent.push(localize('inlineChat.diff', \"Once in the diff editor, enter review mode with{0}. Use up and down arrows to navigate lines with the proposed changes.\", AccessibleDiffViewerNext.id));\n\t\tcontent.push(localize('inlineChat.toolbar', \"Use tab to reach conditional parts like commands, status, message responses and more.\"));\n\t}\n\tcontent.push(localize('chat.signals', \"Accessibility Signals can be changed via settings with a prefix of signals.chat. By default, if a request takes more than 4 seconds, you will hear a sound indicating that progress is still occurring.\"));\n\treturn content.join('\\n');\n}\n\nexport function getChatAccessibilityHelpProvider(accessor: ServicesAccessor, editor: ICodeEditor | undefined, type: 'panelChat' | 'inlineChat' | 'quickChat') {\n\tconst widgetService = accessor.get(IChatWidgetService);\n\tconst keybindingService = accessor.get(IKeybindingService);\n\tconst inputEditor: ICodeEditor | undefined = type === 'panelChat' || type === 'quickChat' ? widgetService.lastFocusedWidget?.inputEditor : editor;\n\n\tif (!inputEditor) {\n\t\treturn;\n\t}\n\tconst domNode = inputEditor.getDomNode() ?? undefined;\n\tif (!domNode) {\n\t\treturn;\n\t}\n\n\tconst cachedPosition = inputEditor.getPosition();\n\tinputEditor.getSupportedActions();\n\tconst helpText = getAccessibilityHelpText(type, keybindingService);\n\treturn new AccessibleContentProvider(\n\t\ttype === 'panelChat' ? AccessibleViewProviderId.PanelChat : type === 'inlineChat' ? AccessibleViewProviderId.InlineChat : AccessibleViewProviderId.QuickChat,\n\t\t{ type: AccessibleViewType.Help },\n\t\t() => helpText,\n\t\t() => {\n\t\t\tif (type === 'panelChat' && cachedPosition) {\n\t\t\t\tinputEditor.setPosition(cachedPosition);\n\t\t\t\tinputEditor.focus();\n\n\t\t\t} else if (type === 'inlineChat') {\n\t\t\t\t// TODO@jrieken find a better way for this\n\t\t\t\tconst ctrl = <{ focus(): void } | undefined>editor?.getContribution(INLINE_CHAT_ID);\n\t\t\t\tctrl?.focus();\n\n\t\t\t}\n\t\t},\n\t\ttype === 'panelChat' ? AccessibilityVerbositySettingId.Chat : AccessibilityVerbositySettingId.InlineChat,\n\t);\n}\n\n// The when clauses for actions may not be true when we invoke the accessible view, so we need to provide the keybinding label manually\n// to ensure it's correct\nfunction getChatFocusKeybindingLabel(keybindingService: IKeybindingService, type: 'panelChat' | 'inlineChat' | 'quickChat', focusInput?: boolean): string | undefined {\n\tlet kbs;\n\tconst fallback = ' (unassigned keybinding)';\n\tif (focusInput) {\n\t\tkbs = keybindingService.lookupKeybindings('workbench.action.chat.focusInput');\n\t} else {\n\t\tkbs = keybindingService.lookupKeybindings('chat.action.focus');\n\t}\n\tif (!kbs?.length) {\n\t\treturn fallback;\n\t}\n\tlet kb;\n\tif (type === 'panelChat') {\n\t\tif (focusInput) {\n\t\t\tkb = kbs.find(kb => kb.getAriaLabel()?.includes('DownArrow'))?.getAriaLabel();\n\t\t} else {\n\t\t\tkb = kbs.find(kb => kb.getAriaLabel()?.includes('UpArrow'))?.getAriaLabel();\n\t\t}\n\t} else {\n\t\t// Quick chat\n\t\tif (focusInput) {\n\t\t\tkb = kbs.find(kb => kb.getAriaLabel()?.includes('UpArrow'))?.getAriaLabel();\n\t\t} else {\n\t\t\tkb = kbs.find(kb => kb.getAriaLabel()?.includes('DownArrow'))?.getAriaLabel();\n\t\t}\n\t}\n\treturn !!kb ? ` (${kb})` : fallback;\n}\n"],
  "mappings": "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",
  "names": ["kb"]
}
