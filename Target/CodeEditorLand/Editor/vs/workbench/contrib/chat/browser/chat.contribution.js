var K=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var x=(f,n,m,o)=>{for(var a=o>1?void 0:o?X(n,m):n,g=f.length-1,S;g>=0;g--)(S=f[g])&&(a=(o?S(n,m,a):S(a))||a);return o&&a&&K(n,m,a),a},p=(f,n)=>(m,o)=>n(m,o,f);import{timeout as Y}from"../../../../base/common/async.js";import{MarkdownString as h,isMarkdownString as E}from"../../../../base/common/htmlContent.js";import{Disposable as A}from"../../../../base/common/lifecycle.js";import{Schemas as T}from"../../../../base/common/network.js";import{isMacintosh as Z}from"../../../../base/common/platform.js";import{EditorContributionInstantiation as ee,registerEditorContribution as te}from"../../../../editor/browser/editorExtensions.js";import{registerEditorFeature as ie}from"../../../../editor/common/editorFeatures.js";import*as i from"../../../../nls.js";import{AccessibleViewRegistry as D}from"../../../../platform/accessibility/browser/accessibleViewRegistry.js";import{ICommandService as oe}from"../../../../platform/commands/common/commands.js";import{Extensions as re,ConfigurationScope as P}from"../../../../platform/configuration/common/configurationRegistry.js";import{SyncDescriptor as ae}from"../../../../platform/instantiation/common/descriptors.js";import{InstantiationType as e,registerSingleton as t}from"../../../../platform/instantiation/common/extensions.js";import{IInstantiationService as R}from"../../../../platform/instantiation/common/instantiation.js";import{Registry as k}from"../../../../platform/registry/common/platform.js";import{EditorPaneDescriptor as ne}from"../../../browser/editor.js";import{Extensions as ce,WorkbenchPhase as d,registerWorkbenchContribution2 as l}from"../../../common/contributions.js";import{EditorExtensions as z}from"../../../common/editor.js";import{IEditorResolverService as se,RegisteredEditorPriority as me}from"../../../services/editor/common/editorResolverService.js";import{LifecyclePhase as de}from"../../../services/lifecycle/common/lifecycle.js";import{ChatAgentLocation as y,ChatAgentNameService as le,ChatAgentService as pe,IChatAgentNameService as he,IChatAgentService as W}from"../common/chatAgents.js";import{CodeMapperService as fe,ICodeMapperService as Ce}from"../common/chatCodeMapperService.js";import"../common/chatColors.js";import{IChatEditingService as ge}from"../common/chatEditingService.js";import{chatVariableLeader as ue}from"../common/chatParserTypes.js";import{IChatService as ye}from"../common/chatService.js";import{ChatService as Ie}from"../common/chatServiceImpl.js";import{ChatSlashCommandService as ve,IChatSlashCommandService as M}from"../common/chatSlashCommands.js";import{IChatVariablesService as L}from"../common/chatVariables.js";import{ChatWidgetHistoryService as Se,IChatWidgetHistoryService as ke}from"../common/chatWidgetHistoryService.js";import{ILanguageModelsService as be,LanguageModelsService as we}from"../common/languageModels.js";import{ILanguageModelStatsService as xe,LanguageModelStatsService as Ee}from"../common/languageModelStats.js";import{ILanguageModelToolsService as De}from"../common/languageModelToolsService.js";import{LanguageModelToolsExtensionPointHandler as V}from"../common/tools/languageModelToolsContribution.js";import{IVoiceChatService as Pe,VoiceChatService as Ae}from"../common/voiceChatService.js";import{PanelChatAccessibilityHelp as Te,QuickChatAccessibilityHelp as Re}from"./actions/chatAccessibilityHelp.js";import{ChatCommandCenterRendering as H,registerChatActions as ze}from"./actions/chatActions.js";import{ACTION_ID_NEW_CHAT as We,registerNewChatActions as Me}from"./actions/chatClearActions.js";import{registerChatCodeBlockActions as Le,registerChatCodeCompareBlockActions as Ve}from"./actions/chatCodeblockActions.js";import{registerChatContextActions as He}from"./actions/chatContextActions.js";import{registerChatCopyActions as $e}from"./actions/chatCopyActions.js";import{registerChatDeveloperActions as Fe}from"./actions/chatDeveloperActions.js";import{SubmitAction as Ne,registerChatExecuteActions as Be}from"./actions/chatExecuteActions.js";import{registerChatFileTreeActions as _e}from"./actions/chatFileTreeActions.js";import{registerChatExportActions as qe}from"./actions/chatImportExport.js";import{registerMoveActions as Oe}from"./actions/chatMoveActions.js";import{registerQuickChatActions as je}from"./actions/chatQuickInputActions.js";import{registerChatTitleActions as Qe}from"./actions/chatTitleActions.js";import{IChatAccessibilityService as Ge,IChatCodeBlockContextProviderService as Ue,IChatWidgetService as Je,IQuickChatService as Ke}from"./chat.js";import{ChatAccessibilityService as Xe}from"./chatAccessibilityService.js";import"./chatAttachmentModel.js";import{ChatMarkdownAnchorService as Ye,IChatMarkdownAnchorService as Ze}from"./chatContentParts/chatMarkdownAnchorService.js";import{ChatEditingService as et}from"./chatEditingService.js";import{ChatEditor as tt}from"./chatEditor.js";import{registerChatEditorActions as it}from"./chatEditorActions.js";import{ChatEditorController as $}from"./chatEditorController.js";import{ChatEditorInput as I,ChatEditorInputSerializer as ot}from"./chatEditorInput.js";import{ChatEditorSaving as F}from"./chatEditorSaving.js";import{ChatGettingStartedContribution as N}from"./chatGettingStarted.js";import{agentSlashCommandToMarkdown as rt,agentToMarkdown as at}from"./chatMarkdownDecorationsRenderer.js";import{ChatCompatibilityNotifier as B,ChatExtensionPointHandler as _}from"./chatParticipantContributions.js";import{ChatPasteProvidersFeature as nt}from"./chatPasteProviders.js";import{QuickChatService as ct}from"./chatQuick.js";import{ChatResponseAccessibleView as st}from"./chatResponseAccessibleView.js";import{ChatVariablesService as mt}from"./chatVariables.js";import{ChatWidgetService as dt}from"./chatWidget.js";import{ChatCodeBlockContextProviderService as lt}from"./codeBlockContextProviderService.js";import"./contrib/chatInputCompletions.js";import"./contrib/chatInputEditorContrib.js";import"./contrib/chatInputEditorHover.js";import{ChatImplicitContextContribution as q}from"./contrib/chatImplicitContext.js";import{LanguageModelToolsService as pt}from"./languageModelToolsService.js";import{ChatViewsWelcomeHandler as O}from"./viewsWelcome/chatViewsWelcomeContributions.js";const ht=k.as(re.Configuration);ht.registerConfiguration({id:"chatSidebar",title:i.localize("interactiveSessionConfigurationTitle","Chat"),type:"object",properties:{"chat.editor.fontSize":{type:"number",description:i.localize("interactiveSession.editor.fontSize","Controls the font size in pixels in chat codeblocks."),default:Z?12:14},"chat.editor.fontFamily":{type:"string",description:i.localize("interactiveSession.editor.fontFamily","Controls the font family in chat codeblocks."),default:"default"},"chat.editor.fontWeight":{type:"string",description:i.localize("interactiveSession.editor.fontWeight","Controls the font weight in chat codeblocks."),default:"default"},"chat.editor.wordWrap":{type:"string",description:i.localize("interactiveSession.editor.wordWrap","Controls whether lines should wrap in chat codeblocks."),default:"off",enum:["on","off"]},"chat.editor.lineHeight":{type:"number",description:i.localize("interactiveSession.editor.lineHeight","Controls the line height in pixels in chat codeblocks. Use 0 to compute the line height from the font size."),default:0},"chat.commandCenter.enabled":{type:"boolean",tags:["experimental"],markdownDescription:i.localize("chat.commandCenter.enabled","Controls whether the command center shows a menu for chat actions (requires {0}).","`#window.commandCenter#`"),default:!1},"chat.editing.alwaysSaveWithGeneratedChanges":{type:"boolean",scope:P.APPLICATION,markdownDescription:i.localize("chat.editing.alwaysSaveWithGeneratedChanges","Whether to always ask before saving files with changes made by chat."),default:!1},"chat.editing.confirmEditRequestRemoval":{type:"boolean",scope:P.APPLICATION,markdownDescription:i.localize("chat.editing.confirmEditRequestRemoval","Whether to show a confirmation before removing a request and its associated edits."),default:!0},"chat.editing.confirmEditRequestRetry":{type:"boolean",scope:P.APPLICATION,markdownDescription:i.localize("chat.editing.confirmEditRequestRetry","Whether to show a confirmation before retrying a request and its associated edits."),default:!0},"chat.experimental.detectParticipant.enabled":{type:"boolean",description:i.localize("chat.experimental.detectParticipant.enabled","Enables chat participant autodetection for panel chat."),default:null}}}),k.as(z.EditorPane).registerEditorPane(ne.create(tt,I.EditorID,i.localize("chat","Chat")),[new ae(I)]);let C=class extends A{static ID="workbench.contrib.chatResolver";constructor(n,m){super(),this._register(n.registerEditor(`${T.vscodeChatSesssion}:**/**`,{id:I.EditorID,label:i.localize("chat","Chat"),priority:me.builtin},{singlePerResource:!0,canSupportResource:o=>o.scheme===T.vscodeChatSesssion},{createEditorInput:({resource:o,options:a})=>({editor:m.createInstance(I,o,a),options:a})}))}};C=x([p(0,se),p(1,R)],C),D.register(new st),D.register(new Te),D.register(new Re);let v=class extends A{constructor(n,m,o,a,g){super(),this._store.add(n.registerSlashCommand({command:"clear",detail:i.localize("clear","Start a new chat"),sortText:"z2_clear",executeImmediately:!0,locations:[y.Panel]},async()=>{m.executeCommand(We)})),this._store.add(n.registerSlashCommand({command:"help",detail:"",sortText:"z1_help",executeImmediately:!0,locations:[y.Panel]},async(S,c)=>{const r=o.getDefaultAgent(y.Panel),j=o.getAgents();r?.metadata.helpTextPrefix&&(E(r.metadata.helpTextPrefix)?c.report({content:r.metadata.helpTextPrefix,kind:"markdownContent"}):c.report({content:new h(r.metadata.helpTextPrefix),kind:"markdownContent"}),c.report({content:new h(`

`),kind:"markdownContent"}));const Q=(await Promise.all(j.filter(s=>s.id!==r?.id).filter(s=>s.locations.includes(y.Panel)).map(async s=>{const b=s.description?`- ${s.description}`:"",G=`- ${g.invokeFunction(u=>at(s,!0,u))} ${b}`,U=s.slashCommands.map(u=>{const J=u.description?`- ${u.description}`:"";return`	* ${rt(s,u)} ${J}`}).join(`
`);return(G+`
`+U).trim()}))).join(`
`);if(c.report({content:new h(Q,{isTrusted:{enabledCommands:[Ne.ID]}}),kind:"markdownContent"}),r?.metadata.helpTextVariablesPrefix){c.report({content:new h(`

`),kind:"markdownContent"}),E(r.metadata.helpTextVariablesPrefix)?c.report({content:r.metadata.helpTextVariablesPrefix,kind:"markdownContent"}):c.report({content:new h(r.metadata.helpTextVariablesPrefix),kind:"markdownContent"});const b=[...a.getVariables(y.Panel),{name:"file",description:i.localize("file","Choose a file in the workspace")}].map(w=>`* \`${ue}${w.name}\` - ${w.description}`).join(`
`);c.report({content:new h(`
`+b),kind:"markdownContent"})}r?.metadata.helpTextPostfix&&(c.report({content:new h(`

`),kind:"markdownContent"}),E(r.metadata.helpTextPostfix)?c.report({content:r.metadata.helpTextPostfix,kind:"markdownContent"}):c.report({content:new h(r.metadata.helpTextPostfix),kind:"markdownContent"})),await Y(200)}))}};v=x([p(0,M),p(1,oe),p(2,W),p(3,L),p(4,R)],v);const ft=k.as(ce.Workbench);l(C.ID,C,d.BlockStartup),ft.registerWorkbenchContribution(v,de.Eventually),k.as(z.EditorFactory).registerEditorSerializer(I.TypeID,ot),l(_.ID,_,d.BlockStartup),l(V.ID,V,d.BlockRestore),l(B.ID,B,d.Eventually),l(N.ID,N,d.Eventually),l(H.ID,H,d.AfterRestored),l(q.ID,q,d.Eventually),l(F.ID,F,d.AfterRestored),l(O.ID,O,d.BlockStartup),ze(),$e(),Le(),Ve(),_e(),Qe(),Be(),je(),qe(),Oe(),Me(),He(),Fe(),it(),ie(nt),te($.ID,$,ee.Eventually),t(ye,Ie,e.Delayed),t(Je,dt,e.Delayed),t(Ke,ct,e.Delayed),t(Ge,Xe,e.Delayed),t(ke,Se,e.Delayed),t(be,we,e.Delayed),t(xe,Ee,e.Delayed),t(M,ve,e.Delayed),t(W,pe,e.Delayed),t(he,le,e.Delayed),t(L,mt,e.Delayed),t(De,pt,e.Delayed),t(Pe,Ae,e.Delayed),t(Ue,lt,e.Delayed),t(Ce,fe,e.Delayed),t(ge,et,e.Delayed),t(Ze,Ye,e.Delayed);
