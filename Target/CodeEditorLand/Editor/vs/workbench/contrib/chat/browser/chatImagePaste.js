var m=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var u=(e,a,r,t)=>{for(var i=t>1?void 0:t?p(a,r):a,n=e.length-1,s;n>=0;n--)(s=e[n])&&(i=(t?s(a,r,i):s(i))||i);return t&&i&&m(a,r,i),i},c=(e,a)=>(r,t)=>a(r,t,e);import{Codicon as x}from"../../../../base/common/codicons.js";import{Disposable as d}from"../../../../base/common/lifecycle.js";import{IClipboardService as f}from"../../../../platform/clipboard/common/clipboardService.js";import"../common/chatModel.js";import"./chatInputPart.js";import{localize as l}from"../../../../nls.js";import{IConfigurationService as h}from"../../../../platform/configuration/common/configuration.js";let o=class extends d{constructor(r,t,i){super();this.inputPart=r;this.clipboardService=t;this.configurationService=i;this._register(this.inputPart.inputEditor.onDidPaste(n=>{this.configurationService.getValue("chat.experimental.imageAttachments")&&this._handlePaste()}))}async _handlePaste(){const r=await this.clipboardService.readImage();if(!r||!v(r))return;const t=await g(r);if(!t)return;const i=this.inputPart.attachmentModel.getAttachmentIDs(),n=[];i.has(t.id)||(i.add(t.id),n.push(t)),this.inputPart.attachmentModel.addContext(...n)}};o=u([c(1,f),c(2,h)],o);async function g(e){return{value:e,id:await y(e),name:l("pastedImage","Pasted Image"),isImage:!0,icon:x.fileMedia,isDynamic:!0}}async function y(e){const a=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(a)).map(t=>t.toString(16).padStart(2,"0")).join("")}function v(e){return e.length<4?!1:Object.values({png:[137,80,78,71,13,10,26,10],jpeg:[255,216,255],bmp:[66,77],gif:[71,73,70,56],tiff:[73,73,42,0]}).some(r=>r.every((t,i)=>e[i]===t))}export{o as ChatImageDropAndPaste,y as imageToHash,v as isImage};
