{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/Land/Dependency/Editor/Source/vs/workbench/contrib/chat/browser/chatInputPart.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { addDisposableListener } from '../../../../base/browser/dom.js';\nimport { DEFAULT_FONT_FAMILY } from '../../../../base/browser/fonts.js';\nimport { IHistoryNavigationWidget } from '../../../../base/browser/history.js';\nimport { StandardKeyboardEvent } from '../../../../base/browser/keyboardEvent.js';\nimport * as aria from '../../../../base/browser/ui/aria/aria.js';\nimport { Button } from '../../../../base/browser/ui/button/button.js';\nimport { IHoverDelegate } from '../../../../base/browser/ui/hover/hoverDelegate.js';\nimport { createInstantHoverDelegate } from '../../../../base/browser/ui/hover/hoverDelegateFactory.js';\nimport { renderLabelWithIcons } from '../../../../base/browser/ui/iconLabel/iconLabels.js';\nimport { ProgressBar } from '../../../../base/browser/ui/progressbar/progressbar.js';\nimport { IAction } from '../../../../base/common/actions.js';\nimport { Promises } from '../../../../base/common/async.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { HistoryNavigator2 } from '../../../../base/common/history.js';\nimport { KeyCode } from '../../../../base/common/keyCodes.js';\nimport { Disposable, DisposableStore, IDisposable, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { ResourceSet } from '../../../../base/common/map.js';\nimport { basename, dirname } from '../../../../base/common/path.js';\nimport { isMacintosh } from '../../../../base/common/platform.js';\nimport type { Mutable } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IEditorConstructionOptions } from '../../../../editor/browser/config/editorConfiguration.js';\nimport { EditorExtensionsRegistry } from '../../../../editor/browser/editorExtensions.js';\nimport { CodeEditorWidget } from '../../../../editor/browser/widget/codeEditor/codeEditorWidget.js';\nimport { EditorOptions } from '../../../../editor/common/config/editorOptions.js';\nimport { IDimension } from '../../../../editor/common/core/dimension.js';\nimport { IPosition } from '../../../../editor/common/core/position.js';\nimport { Range } from '../../../../editor/common/core/range.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { CopyPasteController } from '../../../../editor/contrib/dropOrPasteInto/browser/copyPasteController.js';\nimport { ContentHoverController } from '../../../../editor/contrib/hover/browser/contentHoverController.js';\nimport { GlyphHoverController } from '../../../../editor/contrib/hover/browser/glyphHoverController.js';\nimport { SuggestController } from '../../../../editor/contrib/suggest/browser/suggestController.js';\nimport { localize } from '../../../../nls.js';\nimport { IAccessibilityService } from '../../../../platform/accessibility/common/accessibility.js';\nimport { DropdownWithPrimaryActionViewItem, IDropdownWithPrimaryActionViewItemOptions } from '../../../../platform/actions/browser/dropdownWithPrimaryActionViewItem.js';\nimport { createAndFillInActionBarActions, IMenuEntryActionViewItemOptions, MenuEntryActionViewItem } from '../../../../platform/actions/browser/menuEntryActionViewItem.js';\nimport { HiddenItemStrategy, MenuWorkbenchToolBar } from '../../../../platform/actions/browser/toolbar.js';\nimport { IMenuService, MenuId, MenuItemAction } from '../../../../platform/actions/common/actions.js';\nimport { ICommandService } from '../../../../platform/commands/common/commands.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IContextKey, IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\nimport type { ITextEditorOptions } from '../../../../platform/editor/common/editor.js';\nimport { FileKind, IFileService } from '../../../../platform/files/common/files.js';\nimport { registerAndCreateHistoryNavigationContext } from '../../../../platform/history/browser/contextScopedHistoryWidget.js';\nimport { IHoverService } from '../../../../platform/hover/browser/hover.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { WorkbenchList } from '../../../../platform/list/browser/listService.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { IOpenerService, type OpenInternalOptions } from '../../../../platform/opener/common/opener.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { ResourceLabels } from '../../../browser/labels.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { AccessibilityVerbositySettingId } from '../../accessibility/browser/accessibilityConfiguration.js';\nimport { AccessibilityCommandId } from '../../accessibility/common/accessibilityCommands.js';\nimport { getSimpleCodeEditorWidgetOptions, getSimpleEditorOptions, setupSimpleEditorSelectionStyling } from '../../codeEditor/browser/simpleEditorOptions.js';\nimport { ChatAgentLocation, IChatAgentService } from '../common/chatAgents.js';\nimport { CONTEXT_CHAT_HAS_FILE_ATTACHMENTS, CONTEXT_CHAT_INPUT_CURSOR_AT_TOP, CONTEXT_CHAT_INPUT_HAS_FOCUS, CONTEXT_CHAT_INPUT_HAS_TEXT, CONTEXT_IN_CHAT_INPUT } from '../common/chatContextKeys.js';\nimport { ChatEditingSessionState, IChatEditingSession, WorkingSetEntryState } from '../common/chatEditingService.js';\nimport { IChatRequestVariableEntry } from '../common/chatModel.js';\nimport { IChatFollowup } from '../common/chatService.js';\nimport { IChatResponseViewModel } from '../common/chatViewModel.js';\nimport { IChatHistoryEntry, IChatInputState, IChatWidgetHistoryService } from '../common/chatWidgetHistoryService.js';\nimport { ILanguageModelChatMetadata, ILanguageModelsService } from '../common/languageModels.js';\nimport { CancelAction, ChatModelPickerActionId, ChatSubmitSecondaryAgentAction, IChatExecuteActionContext, SubmitAction } from './actions/chatExecuteActions.js';\nimport { ImplicitContextAttachmentWidget } from './attachments/implicitContextAttachment.js';\nimport { IChatWidget } from './chat.js';\nimport { ChatAttachmentModel } from './chatAttachmentModel.js';\nimport { IDisposableReference } from './chatContentParts/chatCollections.js';\nimport { CollapsibleListPool, IChatCollapsibleListItem } from './chatContentParts/chatReferencesContentPart.js';\nimport { ChatEditingAcceptAllAction, ChatEditingDiscardAllAction, ChatEditingShowChangesAction } from './chatEditingActions.js';\nimport { ChatEditingSaveAllAction } from './chatEditorSaving.js';\nimport { ChatFollowups } from './chatFollowups.js';\nimport { IChatViewState } from './chatWidget.js';\nimport { ChatImplicitContext } from './contrib/chatImplicitContext.js';\n\nconst $ = dom.$;\n\nconst INPUT_EDITOR_MAX_HEIGHT = 250;\n\ninterface IChatInputPartOptions {\n\trenderFollowups: boolean;\n\trenderStyle?: 'compact';\n\tmenus: {\n\t\texecuteToolbar: MenuId;\n\t\tinputSideToolbar?: MenuId;\n\t\ttelemetrySource?: string;\n\t};\n\teditorOverflowWidgetsDomNode?: HTMLElement;\n}\n\nexport class ChatInputPart extends Disposable implements IHistoryNavigationWidget {\n\tstatic readonly INPUT_SCHEME = 'chatSessionInput';\n\tprivate static _counter = 0;\n\n\tprivate _onDidLoadInputState = this._register(new Emitter<any>());\n\treadonly onDidLoadInputState = this._onDidLoadInputState.event;\n\n\tprivate _onDidChangeHeight = this._register(new Emitter<void>());\n\treadonly onDidChangeHeight = this._onDidChangeHeight.event;\n\n\tprivate _onDidFocus = this._register(new Emitter<void>());\n\treadonly onDidFocus = this._onDidFocus.event;\n\n\tprivate _onDidBlur = this._register(new Emitter<void>());\n\treadonly onDidBlur = this._onDidBlur.event;\n\n\tprivate _onDidChangeContext = this._register(new Emitter<{ removed?: IChatRequestVariableEntry[]; added?: IChatRequestVariableEntry[] }>());\n\treadonly onDidChangeContext = this._onDidChangeContext.event;\n\n\tprivate _onDidAcceptFollowup = this._register(new Emitter<{ followup: IChatFollowup; response: IChatResponseViewModel | undefined }>());\n\treadonly onDidAcceptFollowup = this._onDidAcceptFollowup.event;\n\n\tprivate readonly _attachmentModel: ChatAttachmentModel;\n\tpublic get attachmentModel(): ChatAttachmentModel {\n\t\treturn this._attachmentModel;\n\t}\n\n\tpublic getAttachedAndImplicitContext(): IChatRequestVariableEntry[] {\n\t\tconst contextArr = [...this.attachmentModel.attachments];\n\t\tif (this.implicitContext.enabled && this.implicitContext.value) {\n\t\t\tcontextArr.push(this.implicitContext.toBaseEntry());\n\t\t}\n\n\t\treturn contextArr;\n\t}\n\n\tprivate _indexOfLastAttachedContextDeletedWithKeyboard: number = -1;\n\n\tprivate readonly _implicitContext = this._register(new ChatImplicitContext());\n\tpublic get implicitContext(): ChatImplicitContext {\n\t\treturn this._implicitContext;\n\t}\n\n\tprivate _hasFileAttachmentContextKey: IContextKey<boolean>;\n\n\tprivate readonly _onDidChangeVisibility = this._register(new Emitter<boolean>());\n\tprivate readonly _contextResourceLabels = this.instantiationService.createInstance(ResourceLabels, { onDidChangeVisibility: this._onDidChangeVisibility.event });\n\n\tprivate readonly inputEditorMaxHeight: number;\n\tprivate inputEditorHeight = 0;\n\tprivate container!: HTMLElement;\n\n\tprivate inputSideToolbarContainer?: HTMLElement;\n\n\tprivate followupsContainer!: HTMLElement;\n\tprivate readonly followupsDisposables = this._register(new DisposableStore());\n\n\tprivate attachedContextContainer!: HTMLElement;\n\tprivate readonly attachedContextDisposables = this._register(new MutableDisposable<DisposableStore>());\n\n\tprivate chatEditingSessionWidgetContainer!: HTMLElement;\n\n\tprivate _inputPartHeight: number = 0;\n\tget inputPartHeight() {\n\t\treturn this._inputPartHeight;\n\t}\n\n\tprivate _followupsHeight: number = 0;\n\tget followupsHeight() {\n\t\treturn this._followupsHeight;\n\t}\n\n\tprivate _inputEditor!: CodeEditorWidget;\n\tprivate _inputEditorElement!: HTMLElement;\n\n\tprivate executeToolbar!: MenuWorkbenchToolBar;\n\tprivate inputActionsToolbar!: MenuWorkbenchToolBar;\n\n\tget inputEditor() {\n\t\treturn this._inputEditor;\n\t}\n\n\tprivate history: HistoryNavigator2<IChatHistoryEntry>;\n\tprivate historyNavigationBackwardsEnablement!: IContextKey<boolean>;\n\tprivate historyNavigationForewardsEnablement!: IContextKey<boolean>;\n\tprivate inputModel: ITextModel | undefined;\n\tprivate inputEditorHasText: IContextKey<boolean>;\n\tprivate chatCursorAtTop: IContextKey<boolean>;\n\tprivate inputEditorHasFocus: IContextKey<boolean>;\n\n\tprivate readonly _waitForPersistedLanguageModel = this._register(new MutableDisposable<IDisposable>());\n\tprivate _onDidChangeCurrentLanguageModel = new Emitter<string>();\n\tprivate _currentLanguageModel: string | undefined;\n\tget currentLanguageModel() {\n\t\treturn this._currentLanguageModel;\n\t}\n\n\tprivate cachedDimensions: dom.Dimension | undefined;\n\tprivate cachedExecuteToolbarWidth: number | undefined;\n\tprivate cachedInputToolbarWidth: number | undefined;\n\n\treadonly inputUri = URI.parse(`${ChatInputPart.INPUT_SCHEME}:input-${ChatInputPart._counter++}`);\n\n\tprivate readonly _chatEditsActionsDisposables = this._register(new DisposableStore());\n\tprivate readonly _chatEditsDisposables = this._register(new DisposableStore());\n\tprivate _chatEditingSession: IChatEditingSession | undefined;\n\tprivate _chatEditsProgress: ProgressBar | undefined;\n\tprivate _chatEditsListPool: CollapsibleListPool;\n\tprivate _chatEditList: IDisposableReference<WorkbenchList<IChatCollapsibleListItem>> | undefined;\n\tget selectedElements(): URI[] {\n\t\tconst edits = [];\n\t\tconst editsList = this._chatEditList?.object;\n\t\tconst selectedElements = editsList?.getSelectedElements() ?? [];\n\t\tfor (const element of selectedElements) {\n\t\t\tif (element.kind === 'reference' && URI.isUri(element.reference)) {\n\t\t\t\tedits.push(element.reference);\n\t\t\t}\n\t\t}\n\t\treturn edits;\n\t}\n\n\tprivate readonly getInputState: () => IChatInputState;\n\n\tconstructor(\n\t\t// private readonly editorOptions: ChatEditorOptions, // TODO this should be used\n\t\tprivate readonly location: ChatAgentLocation,\n\t\tprivate readonly options: IChatInputPartOptions,\n\t\tgetContribsInputState: () => any,\n\t\t@IChatWidgetHistoryService private readonly historyService: IChatWidgetHistoryService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IKeybindingService private readonly keybindingService: IKeybindingService,\n\t\t@IAccessibilityService private readonly accessibilityService: IAccessibilityService,\n\t\t@ILanguageModelsService private readonly languageModelsService: ILanguageModelsService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IHoverService private readonly hoverService: IHoverService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@ICommandService private readonly commandService: ICommandService,\n\t\t@IEditorService private readonly editorService: IEditorService,\n\t\t@IOpenerService private readonly openerService: IOpenerService,\n\t) {\n\t\tsuper();\n\n\t\tthis._attachmentModel = this._register(new ChatAttachmentModel());\n\t\tthis.getInputState = (): IChatInputState => {\n\t\t\t// Get input state from widget contribs, merge with attachments and working set\n\t\t\tconst chatWorkingSet: { uri: URI; state: WorkingSetEntryState }[] = [];\n\t\t\tfor (const [uri, state] of this._chatEditingSession?.workingSet.entries() ?? []) {\n\t\t\t\tchatWorkingSet.push({ uri, state });\n\t\t\t}\n\t\t\treturn {\n\t\t\t\t...getContribsInputState(),\n\t\t\t\tchatContextAttachments: this._attachmentModel.attachments,\n\t\t\t\tchatWorkingSet: chatWorkingSet\n\t\t\t};\n\t\t};\n\t\tthis.inputEditorMaxHeight = this.options.renderStyle === 'compact' ? INPUT_EDITOR_MAX_HEIGHT / 3 : INPUT_EDITOR_MAX_HEIGHT;\n\n\t\tthis.inputEditorHasText = CONTEXT_CHAT_INPUT_HAS_TEXT.bindTo(contextKeyService);\n\t\tthis.chatCursorAtTop = CONTEXT_CHAT_INPUT_CURSOR_AT_TOP.bindTo(contextKeyService);\n\t\tthis.inputEditorHasFocus = CONTEXT_CHAT_INPUT_HAS_FOCUS.bindTo(contextKeyService);\n\n\t\tthis.history = this.loadHistory();\n\t\tthis._register(this.historyService.onDidClearHistory(() => this.history = new HistoryNavigator2([{ text: '' }], 50, historyKeyFn)));\n\n\t\tthis._register(this.configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(AccessibilityVerbositySettingId.Chat)) {\n\t\t\t\tthis.inputEditor.updateOptions({ ariaLabel: this._getAriaLabel() });\n\t\t\t}\n\t\t}));\n\n\t\tthis._chatEditsListPool = this._register(this.instantiationService.createInstance(CollapsibleListPool, this._onDidChangeVisibility.event, MenuId.ChatEditingSessionWidgetToolbar));\n\n\t\tthis._hasFileAttachmentContextKey = CONTEXT_CHAT_HAS_FILE_ATTACHMENTS.bindTo(contextKeyService);\n\t}\n\n\tprivate setCurrentLanguageModelToDefault() {\n\t\tconst defaultLanguageModel = this.languageModelsService.getLanguageModelIds().find(id => this.languageModelsService.lookupLanguageModel(id)?.isDefault);\n\t\tconst hasUserSelectableLanguageModels = this.languageModelsService.getLanguageModelIds().find(id => {\n\t\t\tconst model = this.languageModelsService.lookupLanguageModel(id);\n\t\t\treturn model?.isUserSelectable && !model.isDefault;\n\t\t});\n\t\tthis._currentLanguageModel = hasUserSelectableLanguageModels ? defaultLanguageModel : undefined;\n\t}\n\n\tprivate setCurrentLanguageModelByUser(modelId: string) {\n\t\tthis._currentLanguageModel = modelId;\n\n\t\t// The user changed the language model, so we don't wait for the persisted option to be registered\n\t\tthis._waitForPersistedLanguageModel.clear();\n\t\tif (this.cachedDimensions) {\n\t\t\tthis.layout(this.cachedDimensions.height, this.cachedDimensions.width);\n\t\t}\n\t}\n\n\tprivate loadHistory(): HistoryNavigator2<IChatHistoryEntry> {\n\t\tconst history = this.historyService.getHistory(this.location);\n\t\tif (history.length === 0) {\n\t\t\thistory.push({ text: '' });\n\t\t}\n\n\t\treturn new HistoryNavigator2(history, 50, historyKeyFn);\n\t}\n\n\tprivate _getAriaLabel(): string {\n\t\tconst verbose = this.configurationService.getValue<boolean>(AccessibilityVerbositySettingId.Chat);\n\t\tif (verbose) {\n\t\t\tconst kbLabel = this.keybindingService.lookupKeybinding(AccessibilityCommandId.OpenAccessibilityHelp)?.getLabel();\n\t\t\treturn kbLabel ? localize('actions.chat.accessibiltyHelp', \"Chat Input,  Type to ask questions or type / for topics, press enter to send out the request. Use {0} for Chat Accessibility Help.\", kbLabel) : localize('chatInput.accessibilityHelpNoKb', \"Chat Input,  Type code here and press Enter to run. Use the Chat Accessibility Help command for more information.\");\n\t\t}\n\t\treturn localize('chatInput', \"Chat Input\");\n\t}\n\n\tinitForNewChatModel(state: IChatViewState): void {\n\t\tthis.history = this.loadHistory();\n\t\tthis.history.add({\n\t\t\ttext: state.inputValue ?? this.history.current().text,\n\t\t\tstate: state.inputState ?? this.getInputState()\n\t\t});\n\t\tconst attachments = state.inputState?.chatContextAttachments ?? [];\n\t\tthis._attachmentModel.clearAndSetContext(...attachments);\n\n\t\tif (state.inputValue) {\n\t\t\tthis.setValue(state.inputValue, false);\n\t\t}\n\n\t\tif (state.selectedLanguageModelId) {\n\t\t\tconst model = this.languageModelsService.lookupLanguageModel(state.selectedLanguageModelId);\n\t\t\tif (model) {\n\t\t\t\tthis._currentLanguageModel = state.selectedLanguageModelId;\n\t\t\t\tthis._onDidChangeCurrentLanguageModel.fire(this._currentLanguageModel);\n\t\t\t} else {\n\t\t\t\tthis._waitForPersistedLanguageModel.value = this.languageModelsService.onDidChangeLanguageModels(e => {\n\t\t\t\t\tconst persistedModel = e.added?.find(m => m.identifier === state.selectedLanguageModelId);\n\t\t\t\t\tif (persistedModel) {\n\t\t\t\t\t\tthis._waitForPersistedLanguageModel.clear();\n\n\t\t\t\t\t\tif (persistedModel.metadata.isUserSelectable) {\n\t\t\t\t\t\t\tthis._currentLanguageModel = state.selectedLanguageModelId;\n\t\t\t\t\t\t\tthis._onDidChangeCurrentLanguageModel.fire(this._currentLanguageModel!);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tlogInputHistory(): void {\n\t\tconst historyStr = [...this.history].map(entry => JSON.stringify(entry)).join('\\n');\n\t\tthis.logService.info(`[${this.location}] Chat input history:`, historyStr);\n\t}\n\n\tsetVisible(visible: boolean): void {\n\t\tthis._onDidChangeVisibility.fire(visible);\n\t}\n\n\tget element(): HTMLElement {\n\t\treturn this.container;\n\t}\n\n\tshowPreviousValue(): void {\n\t\tconst inputState = this.getInputState();\n\t\tif (this.history.isAtEnd()) {\n\t\t\tthis.saveCurrentValue(inputState);\n\t\t} else {\n\t\t\tif (!this.history.has({ text: this._inputEditor.getValue(), state: inputState })) {\n\t\t\t\tthis.saveCurrentValue(inputState);\n\t\t\t\tthis.history.resetCursor();\n\t\t\t}\n\t\t}\n\n\t\tthis.navigateHistory(true);\n\t}\n\n\tshowNextValue(): void {\n\t\tconst inputState = this.getInputState();\n\t\tif (this.history.isAtEnd()) {\n\t\t\treturn;\n\t\t} else {\n\t\t\tif (!this.history.has({ text: this._inputEditor.getValue(), state: inputState })) {\n\t\t\t\tthis.saveCurrentValue(inputState);\n\t\t\t\tthis.history.resetCursor();\n\t\t\t}\n\t\t}\n\n\t\tthis.navigateHistory(false);\n\t}\n\n\tprivate navigateHistory(previous: boolean): void {\n\t\tconst historyEntry = previous ?\n\t\t\tthis.history.previous() : this.history.next();\n\n\t\tconst historyAttachments = historyEntry.state?.chatContextAttachments ?? [];\n\t\tthis._chatEditingSession?.workingSet.clear();\n\t\tfor (const entry of historyEntry.state?.chatWorkingSet ?? []) {\n\t\t\tthis._chatEditingSession?.workingSet.set(entry.uri, entry.state);\n\t\t}\n\t\tthis._attachmentModel.clearAndSetContext(...historyAttachments);\n\n\t\taria.status(historyEntry.text);\n\t\tthis.setValue(historyEntry.text, true);\n\n\t\tthis._onDidLoadInputState.fire(historyEntry.state);\n\n\t\tconst model = this._inputEditor.getModel();\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (previous) {\n\t\t\tconst endOfFirstViewLine = this._inputEditor._getViewModel()?.getLineLength(1) ?? 1;\n\t\t\tconst endOfFirstModelLine = model.getLineLength(1);\n\t\t\tif (endOfFirstViewLine === endOfFirstModelLine) {\n\t\t\t\t// Not wrapped - set cursor to the end of the first line\n\t\t\t\tthis._inputEditor.setPosition({ lineNumber: 1, column: endOfFirstViewLine + 1 });\n\t\t\t} else {\n\t\t\t\t// Wrapped - set cursor one char short of the end of the first view line.\n\t\t\t\t// If it's after the next character, the cursor shows on the second line.\n\t\t\t\tthis._inputEditor.setPosition({ lineNumber: 1, column: endOfFirstViewLine });\n\t\t\t}\n\t\t} else {\n\t\t\tthis._inputEditor.setPosition(getLastPosition(model));\n\t\t}\n\t}\n\n\tsetValue(value: string, transient: boolean): void {\n\t\tthis.inputEditor.setValue(value);\n\t\t// always leave cursor at the end\n\t\tthis.inputEditor.setPosition({ lineNumber: 1, column: value.length + 1 });\n\n\t\tif (!transient) {\n\t\t\tthis.saveCurrentValue(this.getInputState());\n\t\t}\n\t}\n\n\tprivate saveCurrentValue(inputState: any): void {\n\t\tconst newEntry = { text: this._inputEditor.getValue(), state: inputState };\n\t\tthis.history.replaceLast(newEntry);\n\t}\n\n\tfocus() {\n\t\tthis._inputEditor.focus();\n\t}\n\n\thasFocus(): boolean {\n\t\treturn this._inputEditor.hasWidgetFocus();\n\t}\n\n\t/**\n\t * Reset the input and update history.\n\t * @param userQuery If provided, this will be added to the history. Followups and programmatic queries should not be passed.\n\t */\n\tasync acceptInput(isUserQuery?: boolean): Promise<void> {\n\t\tif (isUserQuery) {\n\t\t\tconst userQuery = this._inputEditor.getValue();\n\t\t\tconst entry: IChatHistoryEntry = { text: userQuery, state: this.getInputState() };\n\t\t\tthis.history.replaceLast(entry);\n\t\t\tthis.history.add({ text: '' });\n\t\t}\n\n\t\t// Clear attached context, fire event to clear input state, and clear the input editor\n\t\tthis.attachmentModel.clear();\n\t\tthis._onDidLoadInputState.fire({});\n\t\tif (this.accessibilityService.isScreenReaderOptimized() && isMacintosh) {\n\t\t\tthis._acceptInputForVoiceover();\n\t\t} else {\n\t\t\tthis._inputEditor.focus();\n\t\t\tthis._inputEditor.setValue('');\n\t\t}\n\t}\n\n\tprivate _acceptInputForVoiceover(): void {\n\t\tconst domNode = this._inputEditor.getDomNode();\n\t\tif (!domNode) {\n\t\t\treturn;\n\t\t}\n\t\t// Remove the input editor from the DOM temporarily to prevent VoiceOver\n\t\t// from reading the cleared text (the request) to the user.\n\t\tdomNode.remove();\n\t\tthis._inputEditor.setValue('');\n\t\tthis._inputEditorElement.appendChild(domNode);\n\t\tthis._inputEditor.focus();\n\t}\n\n\tprivate _handleAttachedContextChange() {\n\t\tthis._hasFileAttachmentContextKey.set(Boolean(this._attachmentModel.attachments.find(a => a.isFile)));\n\t\tthis.renderAttachedContext();\n\t}\n\n\trender(container: HTMLElement, initialValue: string, widget: IChatWidget) {\n\t\tlet elements;\n\t\tif (this.options.renderStyle === 'compact') {\n\t\t\telements = dom.h('.interactive-input-part', [\n\t\t\t\tdom.h('.interactive-input-and-edit-session', [\n\t\t\t\t\tdom.h('.chat-editing-session@chatEditingSessionWidgetContainer'),\n\t\t\t\t\tdom.h('.interactive-input-and-side-toolbar@inputAndSideToolbar', [\n\t\t\t\t\t\tdom.h('.chat-input-container@inputContainer', [\n\t\t\t\t\t\t\tdom.h('.chat-editor-container@editorContainer'),\n\t\t\t\t\t\t\tdom.h('.chat-input-toolbars@inputToolbars'),\n\t\t\t\t\t\t]),\n\t\t\t\t\t]),\n\t\t\t\t\tdom.h('.chat-attached-context@attachedContextContainer'),\n\t\t\t\t\tdom.h('.interactive-input-followups@followupsContainer'),\n\t\t\t\t])\n\t\t\t]);\n\t\t} else {\n\t\t\telements = dom.h('.interactive-input-part', [\n\t\t\t\tdom.h('.interactive-input-followups@followupsContainer'),\n\t\t\t\tdom.h('.chat-editing-session@chatEditingSessionWidgetContainer'),\n\t\t\t\tdom.h('.interactive-input-and-side-toolbar@inputAndSideToolbar', [\n\t\t\t\t\tdom.h('.chat-input-container@inputContainer', [\n\t\t\t\t\t\tdom.h('.chat-editor-container@editorContainer'),\n\t\t\t\t\t\tdom.h('.chat-attached-context@attachedContextContainer'),\n\t\t\t\t\t\tdom.h('.chat-input-toolbars@inputToolbars'),\n\t\t\t\t\t]),\n\t\t\t\t]),\n\t\t\t]);\n\t\t}\n\t\tthis.container = elements.root;\n\t\tcontainer.append(this.container);\n\t\tthis.container.classList.toggle('compact', this.options.renderStyle === 'compact');\n\t\tthis.followupsContainer = elements.followupsContainer;\n\t\tconst inputAndSideToolbar = elements.inputAndSideToolbar; // The chat input and toolbar to the right\n\t\tconst inputContainer = elements.inputContainer; // The chat editor, attachments, and toolbars\n\t\tconst editorContainer = elements.editorContainer;\n\t\tthis.attachedContextContainer = elements.attachedContextContainer;\n\t\tconst toolbarsContainer = elements.inputToolbars;\n\t\tthis.chatEditingSessionWidgetContainer = elements.chatEditingSessionWidgetContainer;\n\t\tthis.renderAttachedContext();\n\t\tthis._register(this._implicitContext.onDidChangeValue(() => this._handleAttachedContextChange()));\n\t\tthis._register(this._attachmentModel.onDidChangeContext(() => this._handleAttachedContextChange()));\n\t\tthis.renderChatEditingSessionState(null, widget);\n\n\t\tconst inputScopedContextKeyService = this._register(this.contextKeyService.createScoped(inputContainer));\n\t\tCONTEXT_IN_CHAT_INPUT.bindTo(inputScopedContextKeyService).set(true);\n\t\tconst scopedInstantiationService = this._register(this.instantiationService.createChild(new ServiceCollection([IContextKeyService, inputScopedContextKeyService])));\n\n\t\tconst { historyNavigationBackwardsEnablement, historyNavigationForwardsEnablement } = this._register(registerAndCreateHistoryNavigationContext(inputScopedContextKeyService, this));\n\t\tthis.historyNavigationBackwardsEnablement = historyNavigationBackwardsEnablement;\n\t\tthis.historyNavigationForewardsEnablement = historyNavigationForwardsEnablement;\n\n\t\tconst options: IEditorConstructionOptions = getSimpleEditorOptions(this.configurationService);\n\t\toptions.overflowWidgetsDomNode = this.options.editorOverflowWidgetsDomNode;\n\t\toptions.pasteAs = EditorOptions.pasteAs.defaultValue;\n\t\toptions.readOnly = false;\n\t\toptions.ariaLabel = this._getAriaLabel();\n\t\toptions.fontFamily = DEFAULT_FONT_FAMILY;\n\t\toptions.fontSize = 13;\n\t\toptions.lineHeight = 20;\n\t\toptions.padding = this.options.renderStyle === 'compact' ? { top: 2, bottom: 2 } : { top: 8, bottom: 8 };\n\t\toptions.cursorWidth = 1;\n\t\toptions.wrappingStrategy = 'advanced';\n\t\toptions.bracketPairColorization = { enabled: false };\n\t\toptions.suggest = {\n\t\t\tshowIcons: false,\n\t\t\tshowSnippets: false,\n\t\t\tshowWords: true,\n\t\t\tshowStatusBar: false,\n\t\t\tinsertMode: 'replace',\n\t\t};\n\t\toptions.scrollbar = { ...(options.scrollbar ?? {}), vertical: 'hidden' };\n\t\toptions.stickyScroll = { enabled: false };\n\n\t\tthis._inputEditorElement = dom.append(editorContainer!, $(chatInputEditorContainerSelector));\n\t\tconst editorOptions = getSimpleCodeEditorWidgetOptions();\n\t\teditorOptions.contributions?.push(...EditorExtensionsRegistry.getSomeEditorContributions([ContentHoverController.ID, GlyphHoverController.ID, CopyPasteController.ID]));\n\t\tthis._inputEditor = this._register(scopedInstantiationService.createInstance(CodeEditorWidget, this._inputEditorElement, options, editorOptions));\n\t\tSuggestController.get(this._inputEditor)?.forceRenderingAbove();\n\n\t\tthis._register(this._inputEditor.onDidChangeModelContent(() => {\n\t\t\tconst currentHeight = Math.min(this._inputEditor.getContentHeight(), this.inputEditorMaxHeight);\n\t\t\tif (currentHeight !== this.inputEditorHeight) {\n\t\t\t\tthis.inputEditorHeight = currentHeight;\n\t\t\t\tthis._onDidChangeHeight.fire();\n\t\t\t}\n\n\t\t\tconst model = this._inputEditor.getModel();\n\t\t\tconst inputHasText = !!model && model.getValue().trim().length > 0;\n\t\t\tthis.inputEditorHasText.set(inputHasText);\n\t\t}));\n\t\tthis._register(this._inputEditor.onDidFocusEditorText(() => {\n\t\t\tthis.inputEditorHasFocus.set(true);\n\t\t\tthis._onDidFocus.fire();\n\t\t\tinputContainer.classList.toggle('focused', true);\n\t\t}));\n\t\tthis._register(this._inputEditor.onDidBlurEditorText(() => {\n\t\t\tthis.inputEditorHasFocus.set(false);\n\t\t\tinputContainer.classList.toggle('focused', false);\n\n\t\t\tthis._onDidBlur.fire();\n\t\t}));\n\n\t\tconst hoverDelegate = this._register(createInstantHoverDelegate());\n\n\t\tthis._register(dom.addStandardDisposableListener(toolbarsContainer, dom.EventType.CLICK, e => this.inputEditor.focus()));\n\t\tthis.inputActionsToolbar = this._register(this.instantiationService.createInstance(MenuWorkbenchToolBar, toolbarsContainer, MenuId.ChatInput, {\n\t\t\ttelemetrySource: this.options.menus.telemetrySource,\n\t\t\tmenuOptions: { shouldForwardArgs: true },\n\t\t\thiddenItemStrategy: HiddenItemStrategy.Ignore,\n\t\t\thoverDelegate\n\t\t}));\n\t\tthis.inputActionsToolbar.context = { widget } satisfies IChatExecuteActionContext;\n\t\tthis._register(this.inputActionsToolbar.onDidChangeMenuItems(() => {\n\t\t\tif (this.cachedDimensions && typeof this.cachedInputToolbarWidth === 'number' && this.cachedInputToolbarWidth !== this.inputActionsToolbar.getItemsWidth()) {\n\t\t\t\tthis.layout(this.cachedDimensions.height, this.cachedDimensions.width);\n\t\t\t}\n\t\t}));\n\t\tthis.executeToolbar = this._register(this.instantiationService.createInstance(MenuWorkbenchToolBar, toolbarsContainer, this.options.menus.executeToolbar, {\n\t\t\ttelemetrySource: this.options.menus.telemetrySource,\n\t\t\tmenuOptions: {\n\t\t\t\tshouldForwardArgs: true\n\t\t\t},\n\t\t\thoverDelegate,\n\t\t\thiddenItemStrategy: HiddenItemStrategy.Ignore, // keep it lean when hiding items and avoid a \"...\" overflow menu\n\t\t\tactionViewItemProvider: (action, options) => {\n\t\t\t\tif (this.location === ChatAgentLocation.Panel) {\n\t\t\t\t\tif ((action.id === SubmitAction.ID || action.id === CancelAction.ID) && action instanceof MenuItemAction) {\n\t\t\t\t\t\tconst dropdownAction = this.instantiationService.createInstance(MenuItemAction, { id: 'chat.moreExecuteActions', title: localize('notebook.moreExecuteActionsLabel', \"More...\"), icon: Codicon.chevronDown }, undefined, undefined, undefined, undefined);\n\t\t\t\t\t\treturn this.instantiationService.createInstance(ChatSubmitDropdownActionItem, action, dropdownAction, options);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (action.id === ChatModelPickerActionId && action instanceof MenuItemAction) {\n\t\t\t\t\tif (!this._currentLanguageModel) {\n\t\t\t\t\t\tthis.setCurrentLanguageModelToDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._currentLanguageModel) {\n\t\t\t\t\t\tconst itemDelegate: ModelPickerDelegate = {\n\t\t\t\t\t\t\tonDidChangeModel: this._onDidChangeCurrentLanguageModel.event,\n\t\t\t\t\t\t\tsetModel: (modelId: string) => {\n\t\t\t\t\t\t\t\tthis.setCurrentLanguageModelByUser(modelId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn this.instantiationService.createInstance(ModelPickerActionViewItem, action, this._currentLanguageModel, itemDelegate, { hoverDelegate: options.hoverDelegate, keybinding: options.keybinding ?? undefined });\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}));\n\t\tthis.executeToolbar.context = { widget } satisfies IChatExecuteActionContext;\n\t\tthis._register(this.executeToolbar.onDidChangeMenuItems(() => {\n\t\t\tif (this.cachedDimensions && typeof this.cachedExecuteToolbarWidth === 'number' && this.cachedExecuteToolbarWidth !== this.executeToolbar.getItemsWidth()) {\n\t\t\t\tthis.layout(this.cachedDimensions.height, this.cachedDimensions.width);\n\t\t\t}\n\t\t}));\n\t\tif (this.options.menus.inputSideToolbar) {\n\t\t\tconst toolbarSide = this._register(this.instantiationService.createInstance(MenuWorkbenchToolBar, inputAndSideToolbar, this.options.menus.inputSideToolbar, {\n\t\t\t\ttelemetrySource: this.options.menus.telemetrySource,\n\t\t\t\tmenuOptions: {\n\t\t\t\t\tshouldForwardArgs: true\n\t\t\t\t},\n\t\t\t\thoverDelegate\n\t\t\t}));\n\t\t\tthis.inputSideToolbarContainer = toolbarSide.getElement();\n\t\t\ttoolbarSide.getElement().classList.add('chat-side-toolbar');\n\t\t\ttoolbarSide.context = { widget } satisfies IChatExecuteActionContext;\n\t\t}\n\n\t\tlet inputModel = this.modelService.getModel(this.inputUri);\n\t\tif (!inputModel) {\n\t\t\tinputModel = this.modelService.createModel('', null, this.inputUri, true);\n\t\t\tthis._register(inputModel);\n\t\t}\n\n\t\tthis.inputModel = inputModel;\n\t\tthis.inputModel.updateOptions({ bracketColorizationOptions: { enabled: false, independentColorPoolPerBracketType: false } });\n\t\tthis._inputEditor.setModel(this.inputModel);\n\t\tif (initialValue) {\n\t\t\tthis.inputModel.setValue(initialValue);\n\t\t\tconst lineNumber = this.inputModel.getLineCount();\n\t\t\tthis._inputEditor.setPosition({ lineNumber, column: this.inputModel.getLineMaxColumn(lineNumber) });\n\t\t}\n\n\t\tconst onDidChangeCursorPosition = () => {\n\t\t\tconst model = this._inputEditor.getModel();\n\t\t\tif (!model) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst position = this._inputEditor.getPosition();\n\t\t\tif (!position) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst atTop = position.lineNumber === 1 && position.column - 1 <= (this._inputEditor._getViewModel()?.getLineLength(1) ?? 0);\n\t\t\tthis.chatCursorAtTop.set(atTop);\n\n\t\t\tthis.historyNavigationBackwardsEnablement.set(atTop);\n\t\t\tthis.historyNavigationForewardsEnablement.set(position.equals(getLastPosition(model)));\n\t\t};\n\t\tthis._register(this._inputEditor.onDidChangeCursorPosition(e => onDidChangeCursorPosition()));\n\t\tonDidChangeCursorPosition();\n\t}\n\n\tprivate async renderAttachedContext(isLayout = false) {\n\t\tconst container = this.attachedContextContainer;\n\t\tthis.attachedContextDisposables.clear();\n\t\tconst store = new DisposableStore;\n\t\tthis.attachedContextDisposables.value = store;\n\n\t\tconst oldHeight = container.offsetHeight;\n\t\tdom.clearNode(container);\n\t\tconst hoverDelegate = store.add(createInstantHoverDelegate());\n\t\tdom.setVisibility(Boolean(this.attachmentModel.size) || Boolean(this.implicitContext.value), this.attachedContextContainer);\n\t\tif (!this.attachmentModel.size) {\n\t\t\tthis._indexOfLastAttachedContextDeletedWithKeyboard = -1;\n\t\t}\n\n\t\tif (this.implicitContext.value && this.location === ChatAgentLocation.Panel) {\n\t\t\tconst implicitPart = store.add(this.instantiationService.createInstance(ImplicitContextAttachmentWidget, this.implicitContext, this._contextResourceLabels));\n\t\t\tcontainer.appendChild(implicitPart.domNode);\n\t\t}\n\n\t\tconst attachmentInitPromises: Promise<void>[] = [];\n\t\tfor (const [index, attachment] of this.attachmentModel.attachments.entries()) {\n\t\t\tif (attachment.isFile && this.location === ChatAgentLocation.EditingSession) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst widget = dom.append(container, $('.chat-attached-context-attachment.show-file-icons'));\n\t\t\tconst label = this._contextResourceLabels.create(widget, { supportIcons: true, hoverDelegate, hoverTargetOverrride: widget });\n\n\t\t\tlet ariaLabel: string | undefined;\n\n\t\t\tconst file = URI.isUri(attachment.value) ? attachment.value : attachment.value && typeof attachment.value === 'object' && 'uri' in attachment.value && URI.isUri(attachment.value.uri) ? attachment.value.uri : undefined;\n\t\t\tconst range = attachment.value && typeof attachment.value === 'object' && 'range' in attachment.value && Range.isIRange(attachment.value.range) ? attachment.value.range : undefined;\n\t\t\tif (file && attachment.isFile) {\n\t\t\t\tconst fileBasename = basename(file.path);\n\t\t\t\tconst fileDirname = dirname(file.path);\n\t\t\t\tconst friendlyName = `${fileBasename} ${fileDirname}`;\n\n\t\t\t\tariaLabel = range ? localize('chat.fileAttachmentWithRange', \"Attached file, {0}, line {1} to line {2}\", friendlyName, range.startLineNumber, range.endLineNumber) : localize('chat.fileAttachment', \"Attached file, {0}\", friendlyName);\n\n\t\t\t\tlabel.setFile(file, {\n\t\t\t\t\tfileKind: FileKind.FILE,\n\t\t\t\t\thidePath: true,\n\t\t\t\t\trange,\n\t\t\t\t});\n\t\t\t\tthis.attachButtonAndDisposables(widget, index, attachment, hoverDelegate);\n\t\t\t} else if (attachment.isImage) {\n\t\t\t\tariaLabel = localize('chat.imageAttachment', \"Attached image, {0}\", attachment.name);\n\n\t\t\t\tconst hoverElement = dom.$('div.chat-attached-context-hover');\n\t\t\t\thoverElement.setAttribute('aria-label', ariaLabel);\n\n\t\t\t\t// Custom label\n\t\t\t\tconst pillIcon = dom.$('div.chat-attached-context-pill', {}, dom.$('span.codicon.codicon-file-media'));\n\t\t\t\tconst textLabel = dom.$('span.chat-attached-context-custom-text', {}, attachment.name);\n\t\t\t\twidget.appendChild(pillIcon);\n\t\t\t\twidget.appendChild(textLabel);\n\n\t\t\t\tattachmentInitPromises.push(Promises.withAsyncBody(async (resolve) => {\n\t\t\t\t\tlet buffer: Uint8Array;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis.attachButtonAndDisposables(widget, index, attachment, hoverDelegate);\n\t\t\t\t\t\tif (attachment.value instanceof URI) {\n\t\t\t\t\t\t\tconst readFile = await this.fileService.readFile(attachment.value);\n\t\t\t\t\t\t\tif (store.isDisposed) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbuffer = readFile.value.buffer;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbuffer = attachment.value as Uint8Array;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.createImageElements(buffer, widget, hoverElement);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error('Error processing attachment:', error);\n\t\t\t\t\t}\n\n\t\t\t\t\twidget.style.position = 'relative';\n\t\t\t\t\tstore.add(this.hoverService.setupManagedHover(hoverDelegate, widget, hoverElement, { trapFocus: false }));\n\t\t\t\t\tresolve();\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tconst attachmentLabel = attachment.fullName ?? attachment.name;\n\t\t\t\tconst withIcon = attachment.icon?.id ? `$(${attachment.icon.id}) ${attachmentLabel}` : attachmentLabel;\n\t\t\t\tlabel.setLabel(withIcon, undefined);\n\n\t\t\t\tariaLabel = localize('chat.attachment', \"Attached context, {0}\", attachment.name);\n\n\t\t\t\tthis.attachButtonAndDisposables(widget, index, attachment, hoverDelegate);\n\t\t\t}\n\n\t\t\tawait Promise.all(attachmentInitPromises);\n\t\t\tif (store.isDisposed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (file) {\n\t\t\t\twidget.style.cursor = 'pointer';\n\t\t\t\tstore.add(dom.addDisposableListener(widget, dom.EventType.CLICK, (e: MouseEvent) => {\n\t\t\t\t\tdom.EventHelper.stop(e, true);\n\t\t\t\t\tconst options: Mutable<OpenInternalOptions> = {\n\t\t\t\t\t\tfromUserGesture: true\n\t\t\t\t\t};\n\t\t\t\t\tif (range) {\n\t\t\t\t\t\tconst textEditorOptions: ITextEditorOptions = {\n\t\t\t\t\t\t\tselection: range\n\t\t\t\t\t\t};\n\t\t\t\t\t\toptions.editorOptions = textEditorOptions;\n\t\t\t\t\t}\n\t\t\t\t\tthis.openerService.open(file, options);\n\t\t\t\t}));\n\n\t\t\t\tstore.add(dom.addDisposableListener(widget, dom.EventType.KEY_DOWN, (e: KeyboardEvent) => {\n\t\t\t\t\tconst event = new StandardKeyboardEvent(e);\n\t\t\t\t\tif (event.equals(KeyCode.Enter) || event.equals(KeyCode.Space)) {\n\t\t\t\t\t\tdom.EventHelper.stop(e, true);\n\t\t\t\t\t\tconst options: Mutable<OpenInternalOptions> = {\n\t\t\t\t\t\t\tfromUserGesture: true\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (range) {\n\t\t\t\t\t\t\tconst textEditorOptions: ITextEditorOptions = {\n\t\t\t\t\t\t\t\tselection: range\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\toptions.editorOptions = textEditorOptions;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.openerService.open(file, options);\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\twidget.tabIndex = 0;\n\t\t\twidget.ariaLabel = ariaLabel;\n\t\t}\n\n\t\tif (oldHeight !== container.offsetHeight && !isLayout) {\n\t\t\tthis._onDidChangeHeight.fire();\n\t\t}\n\t}\n\n\tprivate attachButtonAndDisposables(widget: HTMLElement, index: number, attachment: IChatRequestVariableEntry, hoverDelegate: IHoverDelegate) {\n\t\tconst store = this.attachedContextDisposables.value;\n\t\tif (!store) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst clearButton = new Button(widget, {\n\t\t\tsupportIcons: true,\n\t\t\thoverDelegate,\n\t\t\ttitle: localize('chat.attachment.clearButton', \"Remove from context\"),\n\t\t});\n\n\t\t// If this item is rendering in place of the last attached context item, focus the clear button so the user can continue deleting attached context items with the keyboard\n\t\tif (index === Math.min(this._indexOfLastAttachedContextDeletedWithKeyboard, this.attachmentModel.size - 1)) {\n\t\t\tclearButton.focus();\n\t\t}\n\n\t\tstore.add(clearButton);\n\t\tclearButton.icon = Codicon.close;\n\t\tconst disp = Event.once(clearButton.onDidClick)((e) => {\n\t\t\tthis._attachmentModel.delete(attachment.id);\n\n\t\t\t// Set focus to the next attached context item if deletion was triggered by a keystroke (vs a mouse click)\n\t\t\tif (dom.isKeyboardEvent(e)) {\n\t\t\t\tconst event = new StandardKeyboardEvent(e);\n\t\t\t\tif (event.equals(KeyCode.Enter) || event.equals(KeyCode.Space)) {\n\t\t\t\t\tthis._indexOfLastAttachedContextDeletedWithKeyboard = index;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this._attachmentModel.size === 0) {\n\t\t\t\tthis.focus();\n\t\t\t}\n\n\t\t\tthis._onDidChangeHeight.fire();\n\t\t\tthis._onDidChangeContext.fire({ removed: [attachment] });\n\t\t});\n\t\tstore.add(disp);\n\t}\n\n\t// Helper function to create and replace image\n\tprivate createImageElements(buffer: ArrayBuffer | Uint8Array, widget: HTMLElement, hoverElement: HTMLElement) {\n\t\tconst blob = new Blob([buffer], { type: 'image/png' });\n\t\tconst url = URL.createObjectURL(blob);\n\t\tconst pillImg = dom.$('img.chat-attached-context-pill-image', { src: url, alt: '' });\n\t\tconst pill = dom.$('div.chat-attached-context-pill', {}, pillImg);\n\n\t\tconst existingPill = widget.querySelector('.chat-attached-context-pill');\n\t\tif (existingPill) {\n\t\t\texistingPill.replaceWith(pill);\n\t\t}\n\n\t\tconst hoverImage = dom.$('img.chat-attached-context-image', { src: url, alt: '' });\n\n\t\t// Update hover image\n\t\thoverElement.appendChild(hoverImage);\n\n\t\thoverImage.onload = () => {\n\t\t\tURL.revokeObjectURL(url);\n\t\t};\n\t}\n\n\tasync renderChatEditingSessionState(chatEditingSession: IChatEditingSession | null, chatWidget?: IChatWidget) {\n\t\tdom.setVisibility(Boolean(chatEditingSession), this.chatEditingSessionWidgetContainer);\n\n\t\tif (!chatEditingSession) {\n\t\t\tdom.clearNode(this.chatEditingSessionWidgetContainer);\n\t\t\tthis._chatEditsDisposables.clear();\n\t\t\tthis._chatEditList = undefined;\n\t\t\tthis._chatEditsProgress?.dispose();\n\t\t\tthis._chatEditingSession = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tthis._chatEditingSession = chatEditingSession;\n\t\tconst currentChatEditingState = chatEditingSession.state.get();\n\t\tif (this._chatEditList && !chatWidget?.viewModel?.requestInProgress && (currentChatEditingState === ChatEditingSessionState.Idle || currentChatEditingState === ChatEditingSessionState.Initial)) {\n\t\t\tthis._chatEditsProgress?.stop();\n\t\t}\n\n\t\t// Summary of number of files changed\n\t\tconst innerContainer = this.chatEditingSessionWidgetContainer.querySelector('.chat-editing-session-container.show-file-icons') as HTMLElement ?? dom.append(this.chatEditingSessionWidgetContainer, $('.chat-editing-session-container.show-file-icons'));\n\t\tconst modifiedFiles = new ResourceSet();\n\t\tconst entries: IChatCollapsibleListItem[] = chatEditingSession?.entries.get().map((entry) => {\n\t\t\tmodifiedFiles.add(entry.modifiedURI);\n\t\t\treturn {\n\t\t\t\treference: entry.modifiedURI,\n\t\t\t\tstate: entry.state.get(),\n\t\t\t\tkind: 'reference',\n\t\t\t};\n\t\t}) ?? [];\n\t\tfor (const attachment of this.attachmentModel.attachments) {\n\t\t\tif (attachment.isFile && URI.isUri(attachment.value) && !modifiedFiles.has(attachment.value)) {\n\t\t\t\tentries.unshift({\n\t\t\t\t\treference: attachment.value,\n\t\t\t\t\tstate: WorkingSetEntryState.Attached,\n\t\t\t\t\tkind: 'reference',\n\t\t\t\t});\n\t\t\t\tmodifiedFiles.add(attachment.value);\n\t\t\t}\n\t\t}\n\t\tfor (const [file, state] of chatEditingSession.workingSet.entries()) {\n\t\t\tif (!modifiedFiles.has(file)) {\n\t\t\t\tentries.unshift({\n\t\t\t\t\treference: file,\n\t\t\t\t\tstate: state,\n\t\t\t\t\tkind: 'reference',\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tentries.sort((a, b) => {\n\t\t\tif (a.kind === 'reference' && b.kind === 'reference') {\n\t\t\t\tif (a.state === b.state || a.state === undefined || b.state === undefined) {\n\t\t\t\t\treturn a.reference.toString().localeCompare(b.reference.toString());\n\t\t\t\t}\n\t\t\t\treturn a.state - b.state;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\t\tconst overviewRegion = innerContainer.querySelector('.chat-editing-session-overview') as HTMLElement ?? dom.append(innerContainer, $('.chat-editing-session-overview'));\n\t\tif (entries.length !== this._chatEditList?.object.length) {\n\t\t\tconst overviewText = overviewRegion.querySelector('span') ?? dom.append(overviewRegion, $('span'));\n\t\t\toverviewText.textContent = localize('chatEditingSession.workingSet', 'Working Set');\n\n\t\t\tif (entries.length === 1) {\n\t\t\t\toverviewText.textContent += ' ' + localize('chatEditingSession.oneFile', '(1 file)');\n\t\t\t} else if (entries.length > 1) {\n\t\t\t\toverviewText.textContent += ' ' + localize('chatEditingSession.manyFiles', '({0} files)', entries.length);\n\t\t\t}\n\t\t}\n\n\t\t// Clear out the previous actions (if any)\n\t\tthis._chatEditsActionsDisposables.clear();\n\n\t\t//#region Chat editing session actions\n\t\t{\n\t\t\tconst actionsContainer = overviewRegion.querySelector('.chat-editing-session-actions') as HTMLElement ?? dom.append(overviewRegion, $('.chat-editing-session-actions'));\n\t\t\tdom.clearNode(actionsContainer);\n\n\t\t\t// TODO@joyceerhl adopt `MenuWorkbenchButtonBar`\n\t\t\tif (chatEditingSession.entries.get().find((e) => e.state.get() === WorkingSetEntryState.Modified)) {\n\t\t\t\t// Don't show Accept All / Discard All actions if user already selected Accept All / Discard All\n\t\t\t\tconst actions = [];\n\t\t\t\tactions.push(\n\t\t\t\t\t{\n\t\t\t\t\t\tcommand: ChatEditingAcceptAllAction.ID,\n\t\t\t\t\t\tlabel: ChatEditingAcceptAllAction.LABEL,\n\t\t\t\t\t\tisSecondary: false,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tcommand: ChatEditingSaveAllAction.ID,\n\t\t\t\t\t\tlabel: ChatEditingSaveAllAction.LABEL,\n\t\t\t\t\t\tisSecondary: true,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tcommand: ChatEditingDiscardAllAction.ID,\n\t\t\t\t\t\tlabel: ChatEditingDiscardAllAction.LABEL,\n\t\t\t\t\t\tisSecondary: true,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tcommand: ChatEditingShowChangesAction.ID,\n\t\t\t\t\t\tlabel: ChatEditingShowChangesAction.LABEL,\n\t\t\t\t\t\ticon: Codicon.diffMultiple,\n\t\t\t\t\t\tisSecondary: true\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\tfor (const action of actions) {\n\t\t\t\t\tconst button = this._chatEditsActionsDisposables.add(new Button(actionsContainer, {\n\t\t\t\t\t\tsupportIcons: true,\n\t\t\t\t\t\tsecondary: action.isSecondary\n\t\t\t\t\t}));\n\t\t\t\t\tif (action.icon) {\n\t\t\t\t\t\tbutton.icon = action.icon;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbutton.label = action.label;\n\t\t\t\t\t}\n\t\t\t\t\tbutton.setTitle(action.label);\n\t\t\t\t\tthis._chatEditsActionsDisposables.add(button.onDidClick(() => {\n\t\t\t\t\t\tthis.commandService.executeCommand(action.command);\n\t\t\t\t\t}));\n\t\t\t\t\tdom.append(actionsContainer, button.element);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t//#endregion\n\n\t\tif (!chatEditingSession) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (currentChatEditingState === ChatEditingSessionState.StreamingEdits || chatWidget?.viewModel?.requestInProgress) {\n\t\t\tthis._chatEditsProgress ??= new ProgressBar(innerContainer);\n\t\t\tthis._chatEditsProgress?.infinite().show(500);\n\t\t}\n\n\t\t// Working set\n\t\tif (!this._chatEditList) {\n\t\t\tthis._chatEditList = this._chatEditsListPool.get();\n\t\t\tconst list = this._chatEditList.object;\n\t\t\tthis._chatEditsDisposables.add(this._chatEditList);\n\t\t\tthis._chatEditsDisposables.add(list.onDidFocus(() => {\n\t\t\t\tthis._onDidFocus.fire();\n\t\t\t}));\n\t\t\tthis._chatEditsDisposables.add(list.onDidOpen((e) => {\n\t\t\t\tif (e.element?.kind === 'reference' && URI.isUri(e.element.reference)) {\n\t\t\t\t\tconst modifiedFileUri = e.element.reference;\n\t\t\t\t\tthis.editorService.openEditor({ resource: modifiedFileUri, options: { preserveFocus: true } });\n\t\t\t\t}\n\t\t\t}));\n\t\t\tthis._chatEditsDisposables.add(addDisposableListener(list.getHTMLElement(), 'click', e => {\n\t\t\t\tif (!this.hasFocus()) {\n\t\t\t\t\tthis._onDidFocus.fire();\n\t\t\t\t}\n\t\t\t}, true));\n\t\t\tdom.append(innerContainer, list.getHTMLElement());\n\t\t}\n\n\t\tconst maxItemsShown = 6;\n\t\tconst itemsShown = Math.min(entries.length, maxItemsShown);\n\t\tconst height = itemsShown * 22;\n\t\tconst list = this._chatEditList.object;\n\t\tlist.layout(height);\n\t\tlist.getHTMLElement().style.height = `${height}px`;\n\t\tlist.splice(0, list.length, entries);\n\n\t\tconst actionsContainer = innerContainer.querySelector('.chat-editing-session-toolbar-actions') as HTMLElement ?? dom.append(innerContainer, $('.chat-editing-session-toolbar-actions'));\n\n\t\tconst button = this._chatEditsActionsDisposables.add(new Button(actionsContainer, {\n\t\t\tsupportIcons: true,\n\t\t\tsecondary: true\n\t\t}));\n\t\tbutton.label = localize('chatAddFiles', '{0} Add Files...', '$(add)');\n\t\tthis._chatEditsActionsDisposables.add(button.onDidClick(() => {\n\t\t\tthis.commandService.executeCommand('workbench.action.chat.attachContext', { widget: chatWidget, showFilesOnly: true, placeholder: localize('chatAttachFiles', 'Search for files to add to your working set') });\n\t\t}));\n\t\tdom.append(actionsContainer, button.element);\n\t}\n\n\tasync renderFollowups(items: IChatFollowup[] | undefined, response: IChatResponseViewModel | undefined): Promise<void> {\n\t\tif (!this.options.renderFollowups) {\n\t\t\treturn;\n\t\t}\n\t\tthis.followupsDisposables.clear();\n\t\tdom.clearNode(this.followupsContainer);\n\n\t\tif (items && items.length > 0) {\n\t\t\tthis.followupsDisposables.add(this.instantiationService.createInstance<typeof ChatFollowups<IChatFollowup>, ChatFollowups<IChatFollowup>>(ChatFollowups, this.followupsContainer, items, this.location, undefined, followup => this._onDidAcceptFollowup.fire({ followup, response })));\n\t\t}\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tget contentHeight(): number {\n\t\tconst data = this.getLayoutData();\n\t\treturn data.followupsHeight + data.inputPartEditorHeight + data.inputPartVerticalPadding + data.inputEditorBorder + data.attachmentsHeight + data.toolbarsHeight + data.chatEditingStateHeight;\n\t}\n\n\tlayout(height: number, width: number) {\n\t\tthis.cachedDimensions = new dom.Dimension(width, height);\n\n\t\treturn this._layout(height, width);\n\t}\n\n\tprivate previousInputEditorDimension: IDimension | undefined;\n\tprivate _layout(height: number, width: number, allowRecurse = true): void {\n\t\tthis.renderAttachedContext(true);\n\n\t\tconst data = this.getLayoutData();\n\t\tconst inputEditorHeight = Math.min(data.inputPartEditorHeight, height - data.followupsHeight - data.attachmentsHeight - data.inputPartVerticalPadding - data.toolbarsHeight);\n\n\t\tconst followupsWidth = width - data.inputPartHorizontalPadding;\n\t\tthis.followupsContainer.style.width = `${followupsWidth}px`;\n\n\t\tthis._inputPartHeight = data.inputPartVerticalPadding + data.followupsHeight + inputEditorHeight + data.inputEditorBorder + data.attachmentsHeight + data.toolbarsHeight + data.chatEditingStateHeight;\n\t\tthis._followupsHeight = data.followupsHeight;\n\n\t\tconst initialEditorScrollWidth = this._inputEditor.getScrollWidth();\n\t\tconst newEditorWidth = width - data.inputPartHorizontalPadding - data.editorBorder - data.inputPartHorizontalPaddingInside - data.toolbarsWidth - data.sideToolbarWidth;\n\t\tconst newDimension = { width: newEditorWidth, height: inputEditorHeight };\n\t\tif (!this.previousInputEditorDimension || (this.previousInputEditorDimension.width !== newDimension.width || this.previousInputEditorDimension.height !== newDimension.height)) {\n\t\t\t// This layout call has side-effects that are hard to understand. eg if we are calling this inside a onDidChangeContent handler, this can trigger the next onDidChangeContent handler\n\t\t\t// to be invoked, and we have a lot of these on this editor. Only doing a layout this when the editor size has actually changed makes it much easier to follow.\n\t\t\tthis._inputEditor.layout(newDimension);\n\t\t\tthis.previousInputEditorDimension = newDimension;\n\t\t}\n\n\t\tif (allowRecurse && initialEditorScrollWidth < 10) {\n\t\t\t// This is probably the initial layout. Now that the editor is layed out with its correct width, it should report the correct contentHeight\n\t\t\treturn this._layout(height, width, false);\n\t\t}\n\t}\n\n\tprivate getLayoutData() {\n\t\tconst executeToolbarWidth = this.cachedExecuteToolbarWidth = this.executeToolbar.getItemsWidth();\n\t\tconst inputToolbarWidth = this.cachedInputToolbarWidth = this.inputActionsToolbar.getItemsWidth();\n\t\tconst executeToolbarPadding = (this.executeToolbar.getItemsLength() - 1) * 4;\n\t\tconst inputToolbarPadding = this.inputActionsToolbar.getItemsLength() ? (this.inputActionsToolbar.getItemsLength() - 1) * 4 : 0;\n\t\treturn {\n\t\t\tinputEditorBorder: 2,\n\t\t\tfollowupsHeight: this.followupsContainer.offsetHeight,\n\t\t\tinputPartEditorHeight: Math.min(this._inputEditor.getContentHeight(), this.inputEditorMaxHeight),\n\t\t\tinputPartHorizontalPadding: this.options.renderStyle === 'compact' ? 16 : 32,\n\t\t\tinputPartVerticalPadding: this.options.renderStyle === 'compact' ? 12 : 28,\n\t\t\tattachmentsHeight: this.attachedContextContainer.offsetHeight,\n\t\t\teditorBorder: 2,\n\t\t\tinputPartHorizontalPaddingInside: 12,\n\t\t\ttoolbarsWidth: this.options.renderStyle === 'compact' ? executeToolbarWidth + executeToolbarPadding + inputToolbarWidth + inputToolbarPadding : 0,\n\t\t\ttoolbarsHeight: this.options.renderStyle === 'compact' ? 0 : 22,\n\t\t\tchatEditingStateHeight: this.chatEditingSessionWidgetContainer.offsetHeight,\n\t\t\tsideToolbarWidth: this.inputSideToolbarContainer ? dom.getTotalWidth(this.inputSideToolbarContainer) + 4 /*gap*/ : 0,\n\t\t};\n\t}\n\n\tgetViewState(): IChatInputState {\n\t\treturn this.getInputState();\n\t}\n\n\tsaveState(): void {\n\t\tthis.saveCurrentValue(this.getInputState());\n\t\tconst inputHistory = [...this.history];\n\t\tthis.historyService.saveHistory(this.location, inputHistory);\n\t}\n}\n\nconst historyKeyFn = (entry: IChatHistoryEntry) => JSON.stringify(entry);\n\nfunction getLastPosition(model: ITextModel): IPosition {\n\treturn { lineNumber: model.getLineCount(), column: model.getLineLength(model.getLineCount()) + 1 };\n}\n\n// This does seems like a lot just to customize an item with dropdown. This whole class exists just because we need an\n// onDidChange listener on the submenu, which is apparently not needed in other cases.\nclass ChatSubmitDropdownActionItem extends DropdownWithPrimaryActionViewItem {\n\tconstructor(\n\t\taction: MenuItemAction,\n\t\tdropdownAction: IAction,\n\t\toptions: IDropdownWithPrimaryActionViewItemOptions,\n\t\t@IMenuService menuService: IMenuService,\n\t\t@IContextMenuService contextMenuService: IContextMenuService,\n\t\t@IChatAgentService chatAgentService: IChatAgentService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService\n\t) {\n\t\tsuper(\n\t\t\taction,\n\t\t\tdropdownAction,\n\t\t\t[],\n\t\t\t'',\n\t\t\t{\n\t\t\t\t...options,\n\t\t\t\tgetKeyBinding: (action: IAction) => keybindingService.lookupKeybinding(action.id, contextKeyService)\n\t\t\t},\n\t\t\tcontextMenuService,\n\t\t\tkeybindingService,\n\t\t\tnotificationService,\n\t\t\tcontextKeyService,\n\t\t\tthemeService,\n\t\t\taccessibilityService);\n\t\tconst menu = menuService.createMenu(MenuId.ChatExecuteSecondary, contextKeyService);\n\t\tconst setActions = () => {\n\t\t\tconst secondary: IAction[] = [];\n\t\t\tcreateAndFillInActionBarActions(menu, { shouldForwardArgs: true }, secondary);\n\t\t\tconst secondaryAgent = chatAgentService.getSecondaryAgent();\n\t\t\tif (secondaryAgent) {\n\t\t\t\tsecondary.forEach(a => {\n\t\t\t\t\tif (a.id === ChatSubmitSecondaryAgentAction.ID) {\n\t\t\t\t\t\ta.label = localize('chat.submitToSecondaryAgent', \"Send to @{0}\", secondaryAgent.name);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn a;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.update(dropdownAction, secondary);\n\t\t};\n\t\tsetActions();\n\t\tthis._register(menu.onDidChange(() => setActions()));\n\t}\n}\n\ninterface ModelPickerDelegate {\n\tonDidChangeModel: Event<string>;\n\tsetModel(selectedModelId: string): void;\n}\n\nclass ModelPickerActionViewItem extends MenuEntryActionViewItem {\n\tconstructor(\n\t\taction: MenuItemAction,\n\t\tprivate currentLanguageModel: string,\n\t\tprivate readonly delegate: ModelPickerDelegate,\n\t\toptions: IMenuEntryActionViewItemOptions,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IContextMenuService contextMenuService: IContextMenuService,\n\t\t@ILanguageModelsService private readonly _languageModelsService: ILanguageModelsService,\n\t\t@IAccessibilityService _accessibilityService: IAccessibilityService\n\t) {\n\t\tsuper(action, options, keybindingService, notificationService, contextKeyService, themeService, contextMenuService, _accessibilityService);\n\n\t\tthis._register(delegate.onDidChangeModel(modelId => {\n\t\t\tthis.currentLanguageModel = modelId;\n\t\t\tthis.updateLabel();\n\t\t}));\n\t}\n\n\t// TODO need extra context tooltip?\n\t// protected override getTooltip(): string {\n\t// \treturn super.getTooltip() + '\\n' + localize('modelPickerHint', \"A chat participant may or may not choose to use the selected model\");\n\t// }\n\n\toverride async onClick(event: MouseEvent): Promise<void> {\n\t\tthis._openContextMenu();\n\t}\n\n\toverride render(container: HTMLElement): void {\n\t\tsuper.render(container);\n\t\tcontainer.classList.add('chat-modelPicker-item');\n\n\t\t// TODO@roblourens this should be a DropdownMenuActionViewItem, but we can't customize how it's rendered yet.\n\t\tthis._register(dom.addDisposableListener(container, dom.EventType.KEY_UP, e => {\n\t\t\tconst event = new StandardKeyboardEvent(e);\n\t\t\tif (event.equals(KeyCode.Enter) || event.equals(KeyCode.Space)) {\n\t\t\t\tthis._openContextMenu();\n\t\t\t}\n\t\t}));\n\t}\n\n\tprotected override updateLabel(): void {\n\t\tif (this.label) {\n\t\t\tconst model = this._languageModelsService.lookupLanguageModel(this.currentLanguageModel);\n\t\t\tif (model) {\n\t\t\t\tthis.label.textContent = model.name;\n\t\t\t\tdom.reset(this.label, ...renderLabelWithIcons(`${model.name}$(chevron-down)`));\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _openContextMenu() {\n\t\tconst setLanguageModelAction = (id: string, modelMetadata: ILanguageModelChatMetadata): IAction => {\n\t\t\treturn {\n\t\t\t\tid,\n\t\t\t\tlabel: modelMetadata.name,\n\t\t\t\ttooltip: '',\n\t\t\t\tclass: undefined,\n\t\t\t\tenabled: true,\n\t\t\t\tchecked: id === this.currentLanguageModel,\n\t\t\t\trun: () => {\n\t\t\t\t\tthis.currentLanguageModel = id;\n\t\t\t\t\tthis.updateLabel();\n\t\t\t\t\tthis.delegate.setModel(id);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\n\t\tconst models = this._languageModelsService.getLanguageModelIds()\n\t\t\t.map(modelId => ({ id: modelId, model: this._languageModelsService.lookupLanguageModel(modelId)! }))\n\t\t\t.filter(entry => entry.model?.isUserSelectable);\n\t\tthis._contextMenuService.showContextMenu({\n\t\t\tgetAnchor: () => this.element!,\n\t\t\tgetActions: () => models.map(entry => setLanguageModelAction(entry.id, entry.model)),\n\t\t});\n\t}\n}\n\nconst chatInputEditorContainerSelector = '.interactive-input-editor';\nsetupSimpleEditorSelectionStyling(chatInputEditorContainerSelector);\n"],
  "mappings": "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",
  "names": ["options", "actionsContainer", "button", "list", "action"]
}
