{
  "version": 3,
  "sources": ["../../../../../../../../../../../Dependency/Land/Dependency/Editor/Source/vs/workbench/contrib/chat/browser/contrib/chatImplicitContext.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from '../../../../../base/common/event.js';\nimport { Disposable, DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { basename } from '../../../../../base/common/resources.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { ICodeEditorService } from '../../../../../editor/browser/services/codeEditorService.js';\nimport { Location } from '../../../../../editor/common/languages.js';\nimport { IWorkbenchContribution } from '../../../../common/contributions.js';\nimport { IEditorService } from '../../../../services/editor/common/editorService.js';\nimport { ChatAgentLocation } from '../../common/chatAgents.js';\nimport { IBaseChatRequestVariableEntry, IChatRequestImplicitVariableEntry } from '../../common/chatModel.js';\nimport { IChatWidget, IChatWidgetService } from '../chat.js';\n\nexport class ChatImplicitContextContribution extends Disposable implements IWorkbenchContribution {\n\tstatic readonly ID = 'chat.implicitContext';\n\n\tconstructor(\n\t\t@ICodeEditorService private readonly codeEditorService: ICodeEditorService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IChatWidgetService private readonly chatWidgetService: IChatWidgetService,\n\t) {\n\t\tsuper();\n\n\t\tconst activeEditorDisposables = this._register(new DisposableStore());\n\t\tthis._register(Event.runAndSubscribe(\n\t\t\teditorService.onDidActiveEditorChange,\n\t\t\t(() => {\n\t\t\t\tactiveEditorDisposables.clear();\n\t\t\t\tconst codeEditor = codeEditorService.getActiveCodeEditor();\n\t\t\t\tif (codeEditor) {\n\t\t\t\t\tactiveEditorDisposables.add(codeEditor.onDidChangeModel(() => this.updateImplicitContext()));\n\t\t\t\t\tactiveEditorDisposables.add(Event.debounce(codeEditor.onDidChangeCursorSelection, () => undefined, 500)(() => this.updateImplicitContext()));\n\t\t\t\t}\n\n\t\t\t\tthis.updateImplicitContext();\n\t\t\t})));\n\t\tthis._register(chatWidgetService.onDidAddWidget(widget => this.updateImplicitContext(widget)));\n\t}\n\n\tprivate updateImplicitContext(updateWidget?: IChatWidget): void {\n\t\tconst codeEditor = this.codeEditorService.getActiveCodeEditor();\n\t\tconst model = codeEditor?.getModel();\n\t\tconst selection = codeEditor?.getSelection();\n\t\tconst newValue = model ?\n\t\t\t(selection && !selection?.isEmpty() ? { uri: model.uri, range: selection } satisfies Location : model.uri) :\n\t\t\tundefined;\n\n\t\tconst widgets = updateWidget ? [updateWidget] : this.chatWidgetService.getAllWidgets(ChatAgentLocation.Panel);\n\t\tfor (const widget of widgets) {\n\t\t\twidget.input.implicitContext.value = newValue;\n\t\t}\n\t}\n}\n\nexport class ChatImplicitContext extends Disposable implements IChatRequestImplicitVariableEntry {\n\treadonly id = 'vscode.implicit';\n\n\tget name(): string {\n\t\tif (URI.isUri(this.value)) {\n\t\t\treturn `file:${basename(this.value)}`;\n\t\t} else if (this.value) {\n\t\t\treturn `file:${basename(this.value.uri)}`;\n\t\t} else {\n\t\t\treturn 'implicit';\n\t\t}\n\t}\n\n\treadonly kind = 'implicit';\n\n\tget modelDescription(): string {\n\t\tif (URI.isUri(this.value)) {\n\t\t\treturn `User's active file`;\n\t\t} else {\n\t\t\treturn `User's active selection`;\n\t\t}\n\t}\n\n\treadonly isDynamic = true;\n\treadonly isFile = true;\n\n\tprivate _onDidChangeValue = new Emitter<void>();\n\treadonly onDidChangeValue = this._onDidChangeValue.event;\n\n\tprivate _value: Location | URI | undefined;\n\tget value() {\n\t\treturn this._value;\n\t}\n\n\tset value(value: Location | URI | undefined) {\n\t\tthis._value = value;\n\t\tthis._onDidChangeValue.fire();\n\t}\n\n\tprivate _enabled = true;\n\tget enabled() {\n\t\treturn this._enabled;\n\t}\n\n\tset enabled(value: boolean) {\n\t\tthis._enabled = value;\n\t\tthis._onDidChangeValue.fire();\n\t}\n\n\tconstructor(value?: Location | URI) {\n\t\tsuper();\n\t\tthis._value = value;\n\t}\n\n\tsetValue(value: Location | URI) {\n\t\tthis._value = value;\n\t\tthis._onDidChangeValue.fire();\n\t}\n\n\ttoBaseEntry(): IBaseChatRequestVariableEntry {\n\t\treturn {\n\t\t\tid: this.id,\n\t\t\tname: this.name,\n\t\t\tvalue: this.value,\n\t\t\tisFile: true,\n\t\t\tisDynamic: true,\n\t\t\tmodelDescription: this.modelDescription\n\t\t};\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
