{
  "version": 3,
  "sources": ["../../../../../../../../../../../Dependency/Land/Dependency/Editor/Source/vs/workbench/contrib/chat/browser/viewsWelcome/chatViewWelcomeController.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../../base/browser/dom.js';\nimport { Button } from '../../../../../base/browser/ui/button/button.js';\nimport { renderIcon } from '../../../../../base/browser/ui/iconLabel/iconLabels.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport { IMarkdownString } from '../../../../../base/common/htmlContent.js';\nimport { Disposable, DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { ThemeIcon } from '../../../../../base/common/themables.js';\nimport { MarkdownRenderer } from '../../../../../editor/browser/widget/markdownRenderer/browser/markdownRenderer.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../../../platform/log/common/log.js';\nimport { IOpenerService } from '../../../../../platform/opener/common/opener.js';\nimport { defaultButtonStyles } from '../../../../../platform/theme/browser/defaultStyles.js';\nimport { chatViewsWelcomeRegistry, IChatViewsWelcomeDescriptor } from './chatViewsWelcome.js';\n\nconst $ = dom.$;\n\nexport interface IViewWelcomeDelegate {\n\treadonly onDidChangeViewWelcomeState: Event<void>;\n\tshouldShowWelcome(): boolean;\n}\n\nexport class ChatViewWelcomeController extends Disposable {\n\tprivate element: HTMLElement | undefined;\n\n\tprivate enabled = false;\n\tprivate readonly enabledDisposables = this._register(new DisposableStore());\n\tprivate readonly renderDisposables = this._register(new DisposableStore());\n\n\tconstructor(\n\t\tprivate readonly container: HTMLElement,\n\t\tprivate readonly delegate: IViewWelcomeDelegate,\n\t\t@IContextKeyService private contextKeyService: IContextKeyService,\n\t\t@IInstantiationService private instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis.element = dom.append(this.container, dom.$('.chat-view-welcome'));\n\t\tthis._register(Event.runAndSubscribe(\n\t\t\tdelegate.onDidChangeViewWelcomeState,\n\t\t\t() => this.update()));\n\t\tthis._register(chatViewsWelcomeRegistry.onDidChange(() => this.update(true)));\n\t}\n\n\tprivate update(force?: boolean): void {\n\t\tconst enabled = this.delegate.shouldShowWelcome();\n\t\tif (this.enabled === enabled || force) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enabledDisposables.clear();\n\t\tif (!enabled) {\n\t\t\tthis.container.classList.toggle('chat-view-welcome-visible', false);\n\t\t\tthis.renderDisposables.clear();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enabled = true;\n\t\tconst descriptors = chatViewsWelcomeRegistry.get();\n\t\tif (descriptors.length) {\n\t\t\tthis.render(descriptors);\n\n\t\t\tconst descriptorKeys: Set<string> = new Set(descriptors.flatMap(d => d.when.keys()));\n\t\t\tthis.enabledDisposables.add(this.contextKeyService.onDidChangeContext(e => {\n\t\t\t\tif (e.affectsSome(descriptorKeys)) {\n\t\t\t\t\tthis.render(descriptors);\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n\n\tprivate render(descriptors: ReadonlyArray<IChatViewsWelcomeDescriptor>): void {\n\t\tthis.renderDisposables.clear();\n\t\tdom.clearNode(this.element!);\n\n\t\tconst enabledDescriptor = descriptors.find(d => this.contextKeyService.contextMatchesRules(d.when));\n\t\tif (enabledDescriptor) {\n\t\t\tconst content: IChatViewWelcomeContent = {\n\t\t\t\ticon: enabledDescriptor.icon,\n\t\t\t\ttitle: enabledDescriptor.title,\n\t\t\t\tmessage: enabledDescriptor.content,\n\t\t\t};\n\t\t\tconst welcomeView = this.renderDisposables.add(this.instantiationService.createInstance(ChatViewWelcomePart, content, { firstLinkToButton: true }));\n\t\t\tthis.element!.appendChild(welcomeView.element);\n\t\t\tthis.container.classList.toggle('chat-view-welcome-visible', true);\n\t\t} else {\n\t\t\tthis.container.classList.toggle('chat-view-welcome-visible', false);\n\t\t}\n\t}\n}\n\nexport interface IChatViewWelcomeContent {\n\ticon?: ThemeIcon;\n\ttitle: string;\n\tmessage: IMarkdownString;\n\ttips?: IMarkdownString;\n}\n\nexport interface IChatViewWelcomeRenderOptions {\n\tfirstLinkToButton?: boolean;\n}\n\nexport class ChatViewWelcomePart extends Disposable {\n\tpublic readonly element: HTMLElement;\n\n\tconstructor(\n\t\tcontent: IChatViewWelcomeContent,\n\t\toptions: IChatViewWelcomeRenderOptions | undefined,\n\t\t@IOpenerService private openerService: IOpenerService,\n\t\t@IInstantiationService private instantiationService: IInstantiationService,\n\t\t@ILogService private logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis.element = dom.$('.chat-welcome-view');\n\n\t\ttry {\n\t\t\tconst icon = dom.append(this.element!, $('.chat-welcome-view-icon'));\n\t\t\tconst title = dom.append(this.element!, $('.chat-welcome-view-title'));\n\t\t\tconst message = dom.append(this.element!, $('.chat-welcome-view-message'));\n\n\t\t\tif (content.icon) {\n\t\t\t\ticon.appendChild(renderIcon(content.icon));\n\t\t\t}\n\n\t\t\ttitle.textContent = content.title;\n\t\t\tconst renderer = this.instantiationService.createInstance(MarkdownRenderer, {});\n\t\t\tconst messageResult = this._register(renderer.render(content.message));\n\t\t\tconst firstLink = options?.firstLinkToButton ? messageResult.element.querySelector('a') : undefined;\n\t\t\tif (firstLink) {\n\t\t\t\tconst target = firstLink.getAttribute('data-href');\n\t\t\t\tconst button = this._register(new Button(firstLink.parentElement!, defaultButtonStyles));\n\t\t\t\tbutton.label = firstLink.textContent ?? '';\n\t\t\t\tif (target) {\n\t\t\t\t\tthis._register(button.onDidClick(() => {\n\t\t\t\t\t\tthis.openerService.open(target, { allowCommands: true });\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t\tfirstLink.replaceWith(button.element);\n\t\t\t}\n\n\t\t\tdom.append(message, messageResult.element);\n\n\t\t\tif (content.tips) {\n\t\t\t\tconst tips = dom.append(this.element!, $('.chat-welcome-view-tips'));\n\t\t\t\tconst tipsResult = this._register(renderer.render(content.tips));\n\t\t\t\ttips.appendChild(tipsResult.element);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tthis.logService.error('Failed to render chat view welcome content', err);\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
