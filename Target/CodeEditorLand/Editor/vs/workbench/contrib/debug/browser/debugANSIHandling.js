import{Color as p,RGBA as v}from"../../../../base/common/color.js";import{isDefined as $}from"../../../../base/common/types.js";import{editorHoverBackground as F,listActiveSelectionBackground as L,listFocusBackground as D,listInactiveFocusBackground as M,listInactiveSelectionBackground as E}from"../../../../platform/theme/common/colorRegistry.js";import{registerThemingParticipant as H}from"../../../../platform/theme/common/themeService.js";import"../../../../platform/workspace/common/workspace.js";import{PANEL_BACKGROUND as W,SIDE_BAR_BACKGROUND as C}from"../../../common/theme.js";import{ansiColorIdentifiers as A}from"../../terminal/common/terminalColorRegistry.js";import"./linkDetector.js";function V(o,t,s){const u=document.createElement("span"),f=o.length;let r=[],d,a,b,m=!1,l=0,h="";for(;l<f;){let n=!1;if(o.charCodeAt(l)===27&&o.charAt(l+1)==="["){const i=l;l+=2;let e="";for(;l<f;){const c=o.charAt(l);if(e+=c,l++,c.match(/^[ABCDHIJKfhmpsu]$/)){n=!0;break}}if(n){if(I(u,h,r,t,s,d,a,b),h="",e.match(/^(?:[34][0-8]|9[0-7]|10[0-7]|[0-9]|2[1-5,7-9]|[34]9|5[8,9]|1[0-9])(?:;[349][0-7]|10[0-7]|[013]|[245]|[34]9)?(?:;[012]?[0-9]?[0-9])*;?m$/)){const c=e.slice(0,-1).split(";").filter(k=>k!=="").map(k=>parseInt(k,10));if(c[0]===38||c[0]===48||c[0]===58){const k=c[0]===38?"foreground":c[0]===48?"background":"underline";c[1]===5?G(c,k):c[1]===2&&S(c,k)}else R(c)}}else l=i}n===!1&&(h+=o.charAt(l),l++)}return h&&I(u,h,r,t,s,d,a,b),u;function g(n,i){n==="foreground"?d=i:n==="background"?a=i:n==="underline"&&(b=i),r=r.filter(e=>e!==`code-${n}-colored`),i!==void 0&&r.push(`code-${n}-colored`)}function B(){const n=d;g("foreground",a),g("background",n)}function R(n){for(const i of n)switch(i){case 0:{r=[],d=void 0,a=void 0;break}case 1:{r=r.filter(e=>e!=="code-bold"),r.push("code-bold");break}case 2:{r=r.filter(e=>e!=="code-dim"),r.push("code-dim");break}case 3:{r=r.filter(e=>e!=="code-italic"),r.push("code-italic");break}case 4:{r=r.filter(e=>e!=="code-underline"&&e!=="code-double-underline"),r.push("code-underline");break}case 5:{r=r.filter(e=>e!=="code-blink"),r.push("code-blink");break}case 6:{r=r.filter(e=>e!=="code-rapid-blink"),r.push("code-rapid-blink");break}case 7:{m||(m=!0,B());break}case 8:{r=r.filter(e=>e!=="code-hidden"),r.push("code-hidden");break}case 9:{r=r.filter(e=>e!=="code-strike-through"),r.push("code-strike-through");break}case 10:{r=r.filter(e=>!e.startsWith("code-font"));break}case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:{r=r.filter(e=>!e.startsWith("code-font")),r.push(`code-font-${i-10}`);break}case 21:{r=r.filter(e=>e!=="code-underline"&&e!=="code-double-underline"),r.push("code-double-underline");break}case 22:{r=r.filter(e=>e!=="code-bold"&&e!=="code-dim");break}case 23:{r=r.filter(e=>e!=="code-italic"&&e!=="code-font-10");break}case 24:{r=r.filter(e=>e!=="code-underline"&&e!=="code-double-underline");break}case 25:{r=r.filter(e=>e!=="code-blink"&&e!=="code-rapid-blink");break}case 27:{m&&(m=!1,B());break}case 28:{r=r.filter(e=>e!=="code-hidden");break}case 29:{r=r.filter(e=>e!=="code-strike-through");break}case 53:{r=r.filter(e=>e!=="code-overline"),r.push("code-overline");break}case 55:{r=r.filter(e=>e!=="code-overline");break}case 39:{g("foreground",void 0);break}case 49:{g("background",void 0);break}case 59:{g("underline",void 0);break}case 73:{r=r.filter(e=>e!=="code-superscript"&&e!=="code-subscript"),r.push("code-superscript");break}case 74:{r=r.filter(e=>e!=="code-superscript"&&e!=="code-subscript"),r.push("code-subscript");break}case 75:{r=r.filter(e=>e!=="code-superscript"&&e!=="code-subscript");break}default:{w(i);break}}}function S(n,i){if(n.length>=5&&n[2]>=0&&n[2]<=255&&n[3]>=0&&n[3]<=255&&n[4]>=0&&n[4]<=255){const e=new v(n[2],n[3],n[4]);g(i,e)}}function G(n,i){let e=n[2];const c=P(e);if(c)g(i,c);else if(e>=0&&e<=15){if(i==="underline"){const k=A[e];g(i,`--vscode-debug-ansi-${k}`);return}e+=30,e>=38&&(e+=52),i==="background"&&(e+=10),w(e)}}function w(n){let i,e;if(n>=30&&n<=37?(e=n-30,i="foreground"):n>=90&&n<=97?(e=n-90+8,i="foreground"):n>=40&&n<=47?(e=n-40,i="background"):n>=100&&n<=107&&(e=n-100+8,i="background"),e!==void 0&&i){const c=A[e];g(i,`--vscode-debug-ansi-${c.replaceAll(".","-")}`)}}}function I(o,t,s,u,f,r,d,a){if(!o||!t)return;const b=u.linkify(t,!0,f);b.className=s.join(" "),r&&(b.style.color=typeof r=="string"?`var(${r})`:p.Format.CSS.formatRGB(new p(r))),d&&(b.style.backgroundColor=typeof d=="string"?`var(${d})`:p.Format.CSS.formatRGB(new p(d))),a&&(b.style.textDecorationColor=typeof a=="string"?`var(${a})`:p.Format.CSS.formatRGB(new p(a))),o.appendChild(b)}function P(o){if(o%1===0)if(o>=16&&o<=231){o-=16;let t=o%6;o=(o-t)/6;let s=o%6;o=(o-s)/6;let u=o;const f=255/5;return t=Math.round(t*f),s=Math.round(s*f),u=Math.round(u*f),new v(u,s,t)}else if(o>=232&&o<=255){o-=232;const t=Math.round(o/23*255);return new v(t,t,t)}else return}H((o,t)=>{const s=[{selector:".monaco-workbench .sidebar, .monaco-workbench .auxiliarybar",bg:o.getColor(C)},{selector:".monaco-workbench .panel",bg:o.getColor(W)},{selector:".monaco-workbench .monaco-list-row.selected",bg:o.getColor(E)},{selector:".monaco-workbench .monaco-list-row.focused",bg:o.getColor(M)},{selector:".monaco-workbench .monaco-list:focus .monaco-list-row.focused",bg:o.getColor(D)},{selector:".monaco-workbench .monaco-list:focus .monaco-list-row.selected",bg:o.getColor(L)},{selector:".debug-hover-widget",bg:o.getColor(F)}];for(const{selector:u,bg:f}of s){const r=A.map(d=>{const a=o.getColor(d);if(a)return`--vscode-debug-ansi-${d.replaceAll(".","-")}:${f?f.ensureConstrast(a,4):a}`}).filter($);t.addRule(`${u} { ${r.join(";")} }`)}});export{I as appendStylizedStringToContainer,P as calcANSI8bitColor,V as handleANSIOutput};
