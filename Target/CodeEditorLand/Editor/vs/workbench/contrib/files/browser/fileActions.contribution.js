import*as n from"../../../../nls.js";import{ToggleAutoSaveAction as $,FocusFilesExplorer as Ae,GlobalCompareResourcesAction as xe,ShowActiveFileInExplorer as Oe,CompareWithClipboardAction as ye,NEW_FILE_COMMAND_ID as j,NEW_FILE_LABEL as J,NEW_FOLDER_COMMAND_ID as Q,NEW_FOLDER_LABEL as Z,TRIGGER_RENAME_LABEL as Re,MOVE_FILE_TO_TRASH_LABEL as Fe,COPY_FILE_LABEL as Se,PASTE_FILE_LABEL as Ne,FileCopiedContext as De,renameHandler as ve,moveFileToTrashHandler as we,copyFileHandler as Le,pasteFileHandler as Te,deleteFileHandler as ee,cutFileHandler as fe,DOWNLOAD_COMMAND_ID as be,openFilePreserveFocusHandler as We,DOWNLOAD_LABEL as ke,OpenActiveFileInEmptyWorkspace as ze,UPLOAD_COMMAND_ID as Pe,UPLOAD_LABEL as He,CompareNewUntitledTextFilesAction as Ke,SetActiveEditorReadonlyInSession as Ve,SetActiveEditorWriteableInSession as Be,ToggleActiveEditorReadonlyInSession as Ge,ResetActiveEditorReadonlyInSession as Ue}from"./fileActions.js";import{revertLocalChangesCommand as qe,acceptLocalChangesCommand as Xe,CONFLICT_RESOLUTION_CONTEXT as Ye}from"./editors/textFileSaveErrorHandler.js";import{MenuId as o,MenuRegistry as t,registerAction2 as s}from"../../../../platform/actions/common/actions.js";import"../../../../platform/action/common/action.js";import{KeyMod as I,KeyCode as d}from"../../../../base/common/keyCodes.js";import{openWindowCommand as $e,newWindowCommand as je}from"./fileCommands.js";import{COPY_PATH_COMMAND_ID as W,REVEAL_IN_EXPLORER_COMMAND_ID as Je,OPEN_TO_SIDE_COMMAND_ID as Qe,REVERT_FILE_COMMAND_ID as k,SAVE_FILE_COMMAND_ID as z,SAVE_FILE_LABEL as oe,SAVE_FILE_AS_COMMAND_ID as te,SAVE_FILE_AS_LABEL as Ze,SAVE_ALL_IN_GROUP_COMMAND_ID as ne,OpenEditorsGroupContext as A,COMPARE_WITH_SAVED_COMMAND_ID as re,COMPARE_RESOURCE_COMMAND_ID as eo,SELECT_FOR_COMPARE_COMMAND_ID as oo,ResourceSelectedForCompareContext as ie,OpenEditorsDirtyEditorContext as P,COMPARE_SELECTED_COMMAND_ID as to,REMOVE_ROOT_FOLDER_COMMAND_ID as no,REMOVE_ROOT_FOLDER_LABEL as ro,SAVE_FILES_COMMAND_ID as io,COPY_RELATIVE_PATH_COMMAND_ID as H,SAVE_FILE_WITHOUT_FORMATTING_COMMAND_ID as ao,SAVE_FILE_WITHOUT_FORMATTING_LABEL as lo,OpenEditorsReadonlyEditorContext as ae,OPEN_WITH_EXPLORER_COMMAND_ID as po,NEW_UNTITLED_FILE_COMMAND_ID as K,NEW_UNTITLED_FILE_LABEL as mo,SAVE_ALL_COMMAND_ID as co,OpenEditorsSelectedFileOrUntitledContext as so}from"./fileConstants.js";import{CommandsRegistry as N}from"../../../../platform/commands/common/commands.js";import{ContextKeyExpr as e}from"../../../../platform/contextkey/common/contextkey.js";import{KeybindingsRegistry as C,KeybindingWeight as E}from"../../../../platform/keybinding/common/keybindingsRegistry.js";import{FilesExplorerFocusCondition as _,ExplorerRootContext as u,ExplorerFolderContext as l,ExplorerResourceNotReadonlyContext as i,ExplorerResourceCut as uo,ExplorerResourceMoveableToTrash as D,ExplorerResourceAvailableEditorIdsContext as Co,FoldersViewVisibleContext as v}from"../common/files.js";import{ADD_ROOT_FOLDER_COMMAND_ID as Eo,ADD_ROOT_FOLDER_LABEL as _o}from"../../../browser/actions/workspaceCommands.js";import{CLOSE_SAVED_EDITORS_COMMAND_ID as go,CLOSE_EDITORS_IN_GROUP_COMMAND_ID as Io,CLOSE_EDITOR_COMMAND_ID as de,CLOSE_OTHER_EDITORS_IN_GROUP_COMMAND_ID as ho,REOPEN_WITH_COMMAND_ID as Mo}from"../../../browser/parts/editor/editorCommands.js";import{AutoSaveAfterShortDelayContext as V}from"../../../services/filesConfiguration/common/filesConfigurationService.js";import{WorkbenchListDoubleSelection as h,WorkbenchTreeFindOpen as a}from"../../../../platform/list/browser/listService.js";import{Schemas as R}from"../../../../base/common/network.js";import{DirtyWorkingCopiesContext as le,EnterMultiRootWorkspaceSupportContext as pe,HasWebFileSystemAccess as Ao,WorkbenchStateContext as me,WorkspaceFolderCountContext as B,SidebarFocusContext as w,ActiveEditorCanRevertContext as xo,ActiveEditorContext as G,ResourceContextKey as r,ActiveEditorAvailableEditorIdsContext as Oo,MultipleEditorsSelectedInGroupContext as yo,TwoEditorsSelectedInGroupContext as Ro,SelectedEditorsInGroupFileOrUntitledResourceContextKey as Fo}from"../../../common/contextkeys.js";import{IsWebContext as L}from"../../../../platform/contextkey/common/contextkeys.js";import"../../../../platform/instantiation/common/instantiation.js";import"../../../../base/common/themables.js";import{IExplorerService as So}from"./files.js";import{Codicon as ce}from"../../../../base/common/codicons.js";import{Categories as p}from"../../../../platform/action/common/actionCommonCategories.js";s(xe),s(Ae),s(Oe),s(ye),s(Ke),s($),s(ze),s(Ve),s(Be),s(Ge),s(Ue),N.registerCommand("_files.windowOpen",$e),N.registerCommand("_files.newWindow",je);const g=10,se="renameFile";C.registerCommandAndKeybindingRule({id:se,weight:E.WorkbenchContrib+g,when:e.and(_,u.toNegated(),i),primary:d.F2,mac:{primary:d.Enter},handler:ve});const ue="moveFileToTrash";C.registerCommandAndKeybindingRule({id:ue,weight:E.WorkbenchContrib+g,when:e.and(_,i,D,a.toNegated()),primary:d.Delete,mac:{primary:I.CtrlCmd|d.Backspace,secondary:[d.Delete]},handler:we});const T="deleteFile";C.registerCommandAndKeybindingRule({id:T,weight:E.WorkbenchContrib+g,when:e.and(_,i,a.toNegated()),primary:I.Shift|d.Delete,mac:{primary:I.CtrlCmd|I.Alt|d.Backspace},handler:ee}),C.registerCommandAndKeybindingRule({id:T,weight:E.WorkbenchContrib+g,when:e.and(_,i,D.toNegated(),a.toNegated()),primary:d.Delete,mac:{primary:I.CtrlCmd|d.Backspace},handler:ee});const Ce="filesExplorer.cut";C.registerCommandAndKeybindingRule({id:Ce,weight:E.WorkbenchContrib+g,when:e.and(_,u.toNegated(),i,a.toNegated()),primary:I.CtrlCmd|d.KeyX,handler:fe});const Ee="filesExplorer.copy";C.registerCommandAndKeybindingRule({id:Ee,weight:E.WorkbenchContrib+g,when:e.and(_,u.toNegated()),primary:I.CtrlCmd|d.KeyC,handler:Le});const U="filesExplorer.paste";N.registerCommand(U,Te),C.registerKeybindingRule({id:`^${U}`,weight:E.WorkbenchContrib+g,when:e.and(_,i,a.toNegated()),primary:I.CtrlCmd|d.KeyV}),C.registerCommandAndKeybindingRule({id:"filesExplorer.cancelCut",weight:E.WorkbenchContrib+g,when:e.and(_,uo),primary:d.Escape,handler:async c=>{await c.get(So).setToCopy([],!0)}}),C.registerCommandAndKeybindingRule({id:"filesExplorer.openFilePreserveFocus",weight:E.WorkbenchContrib+g,when:e.and(_,l.toNegated()),primary:d.Space,handler:We});const F={id:W,title:n.localize("copyPath","Copy Path")},S={id:H,title:n.localize("copyRelativePath","Copy Relative Path")},f={id:Je,title:n.localize("revealInSideBar","Reveal in Explorer View")};q(W,F.title,r.IsFileSystemResource,"1_cutcopypaste",!0),q(H,S.title,r.IsFileSystemResource,"1_cutcopypaste",!0),q(f.id,f.title,r.IsFileSystemResource,"2_files",!1,1);function q(c,M,x,O,y,he){const Me=y!==!0?yo.negate():void 0;t.appendMenuItem(o.EditorTitleContext,{command:{id:c,title:M,precondition:Me},when:x,group:O,order:he})}_e("workbench.files.action.acceptLocalChanges",n.localize("acceptLocalChanges","Use your changes and overwrite file contents"),ce.check,-10,Xe),_e("workbench.files.action.revertLocalChanges",n.localize("revertLocalChanges","Discard your changes and revert to file contents"),ce.discard,-9,qe);function _e(c,M,x,O,y){N.registerCommand(c,y),t.appendMenuItem(o.EditorTitle,{command:{id:c,title:M,icon:x},when:e.equals(Ye,!0),group:"navigation",order:O})}function m({id:c,title:M,category:x,metadata:O},y){t.appendMenuItem(o.CommandPalette,{command:{id:c,title:M,category:x,metadata:O},when:y})}m({id:W,title:n.localize2("copyPathOfActive","Copy Path of Active File"),category:p.File}),m({id:H,title:n.localize2("copyRelativePathOfActive","Copy Relative Path of Active File"),category:p.File}),m({id:z,title:oe,category:p.File}),m({id:ao,title:lo,category:p.File}),m({id:ne,title:n.localize2("saveAllInGroup","Save All in Group"),category:p.File}),m({id:io,title:n.localize2("saveFiles","Save All Files"),category:p.File}),m({id:k,title:n.localize2("revert","Revert File"),category:p.File}),m({id:re,title:n.localize2("compareActiveWithSaved","Compare Active File with Saved"),category:p.File,metadata:{description:n.localize2("compareActiveWithSavedMeta","Opens a new diff editor to compare the active file with the version on disk.")}}),m({id:te,title:Ze,category:p.File}),m({id:j,title:J,category:p.File},B.notEqualsTo("0")),m({id:Q,title:Z,category:p.File,metadata:{description:n.localize2("newFolderDescription","Create a new folder or directory")}},B.notEqualsTo("0")),m({id:K,title:mo,category:p.File});const X=e.or(r.IsFileSystemResource,r.Scheme.isEqualTo(R.untitled)),b={id:Qe,title:n.localize("openToSide","Open to the Side")};t.appendMenuItem(o.OpenEditorsContext,{group:"navigation",order:10,command:b,when:X}),t.appendMenuItem(o.OpenEditorsContext,{group:"1_open",order:10,command:{id:Mo,title:n.localize("reopenWith","Reopen Editor With...")},when:e.and(Oo,A.toNegated())}),t.appendMenuItem(o.OpenEditorsContext,{group:"1_cutcopypaste",order:10,command:F,when:r.IsFileSystemResource}),t.appendMenuItem(o.OpenEditorsContext,{group:"1_cutcopypaste",order:20,command:S,when:r.IsFileSystemResource}),t.appendMenuItem(o.OpenEditorsContext,{group:"2_save",order:10,command:{id:z,title:oe,precondition:P},when:e.or(r.Scheme.isEqualTo(R.untitled),e.and(A.toNegated(),ae.toNegated(),V.toNegated()))}),t.appendMenuItem(o.OpenEditorsContext,{group:"2_save",order:20,command:{id:k,title:n.localize("revert","Revert File"),precondition:P},when:e.and(A.toNegated(),ae.toNegated(),r.Scheme.notEqualsTo(R.untitled),V.toNegated())}),t.appendMenuItem(o.OpenEditorsContext,{group:"2_save",order:30,command:{id:ne,title:n.localize("saveAll","Save All"),precondition:le},when:A}),t.appendMenuItem(o.OpenEditorsContext,{group:"3_compare",order:10,command:{id:re,title:n.localize("compareWithSaved","Compare with Saved"),precondition:P},when:e.and(r.IsFileSystemResource,V.toNegated(),h.toNegated())});const ge={id:eo,title:n.localize("compareWithSelected","Compare with Selected")};t.appendMenuItem(o.OpenEditorsContext,{group:"3_compare",order:20,command:ge,when:e.and(r.HasResource,ie,X,h.toNegated())});const Ie={id:oo,title:n.localize("compareSource","Select for Compare")};t.appendMenuItem(o.OpenEditorsContext,{group:"3_compare",order:30,command:Ie,when:e.and(r.HasResource,X,h.toNegated())});const Y={id:to,title:n.localize("compareSelected","Compare Selected")};t.appendMenuItem(o.OpenEditorsContext,{group:"3_compare",order:30,command:Y,when:e.and(r.HasResource,h,so)}),t.appendMenuItem(o.EditorTitleContext,{group:"1_compare",order:30,command:Y,when:e.and(r.HasResource,Ro,Fo)}),t.appendMenuItem(o.OpenEditorsContext,{group:"4_close",order:10,command:{id:de,title:n.localize("close","Close")},when:A.toNegated()}),t.appendMenuItem(o.OpenEditorsContext,{group:"4_close",order:20,command:{id:ho,title:n.localize("closeOthers","Close Others")},when:A.toNegated()}),t.appendMenuItem(o.OpenEditorsContext,{group:"4_close",order:30,command:{id:go,title:n.localize("closeSaved","Close Saved")}}),t.appendMenuItem(o.OpenEditorsContext,{group:"4_close",order:40,command:{id:Io,title:n.localize("closeAll","Close All")}}),t.appendMenuItem(o.ExplorerContext,{group:"navigation",order:4,command:{id:j,title:J,precondition:e.and(i,a.toNegated())},when:l}),t.appendMenuItem(o.ExplorerContext,{group:"navigation",order:6,command:{id:Q,title:Z,precondition:e.and(i,a.toNegated())},when:l}),t.appendMenuItem(o.ExplorerContext,{group:"navigation",order:10,command:b,when:e.and(l.toNegated(),r.HasResource)}),t.appendMenuItem(o.ExplorerContext,{group:"navigation",order:20,command:{id:po,title:n.localize("explorerOpenWith","Open With...")},when:e.and(l.toNegated(),Co)}),t.appendMenuItem(o.ExplorerContext,{group:"3_compare",order:20,command:ge,when:e.and(l.toNegated(),r.HasResource,ie,h.toNegated())}),t.appendMenuItem(o.ExplorerContext,{group:"3_compare",order:30,command:Ie,when:e.and(l.toNegated(),r.HasResource,h.toNegated())}),t.appendMenuItem(o.ExplorerContext,{group:"3_compare",order:30,command:Y,when:e.and(l.toNegated(),r.HasResource,h)}),t.appendMenuItem(o.ExplorerContext,{group:"5_cutcopypaste",order:8,command:{id:Ce,title:n.localize("cut","Cut"),precondition:a.toNegated()},when:e.and(u.toNegated(),i)}),t.appendMenuItem(o.ExplorerContext,{group:"5_cutcopypaste",order:10,command:{id:Ee,title:Se},when:u.toNegated()}),t.appendMenuItem(o.ExplorerContext,{group:"5_cutcopypaste",order:20,command:{id:U,title:Ne,precondition:e.and(i,De,a.toNegated())},when:l}),t.appendMenuItem(o.ExplorerContext,{group:"5b_importexport",order:10,command:{id:be,title:ke},when:e.or(e.and(L.toNegated(),r.Scheme.notEqualsTo(R.file)),e.and(L,l.toNegated(),u.toNegated()),e.and(L,Ao))}),t.appendMenuItem(o.ExplorerContext,{group:"5b_importexport",order:20,command:{id:Pe,title:He},when:e.and(L,l,i)}),t.appendMenuItem(o.ExplorerContext,{group:"6_copypath",order:10,command:F,when:r.IsFileSystemResource}),t.appendMenuItem(o.ExplorerContext,{group:"6_copypath",order:20,command:S,when:r.IsFileSystemResource}),t.appendMenuItem(o.ExplorerContext,{group:"2_workspace",order:10,command:{id:Eo,title:_o,precondition:a.toNegated()},when:e.and(u,e.or(pe,me.isEqualTo("workspace")))}),t.appendMenuItem(o.ExplorerContext,{group:"2_workspace",order:30,command:{id:no,title:ro,precondition:a.toNegated()},when:e.and(u,l,e.and(B.notEqualsTo("0"),e.or(pe,me.isEqualTo("workspace"))))}),t.appendMenuItem(o.ExplorerContext,{group:"7_modification",order:10,command:{id:se,title:Re,precondition:e.and(i,a.toNegated())},when:u.toNegated()}),t.appendMenuItem(o.ExplorerContext,{group:"7_modification",order:20,command:{id:ue,title:Fe,precondition:e.and(i,a.toNegated())},alt:{id:T,title:n.localize("deleteFile","Delete Permanently"),precondition:e.and(i,a.toNegated())},when:e.and(u.toNegated(),D)}),t.appendMenuItem(o.ExplorerContext,{group:"7_modification",order:20,command:{id:T,title:n.localize("deleteFile","Delete Permanently"),precondition:e.and(i,a.toNegated())},when:e.and(u.toNegated(),D.toNegated())});for(const c of[o.EmptyEditorGroupContext,o.EditorTabsBarContext])t.appendMenuItem(c,{command:{id:K,title:n.localize("newFile","New Text File")},group:"1_file",order:10}),t.appendMenuItem(c,{command:{id:"workbench.action.quickOpen",title:n.localize("openFile","Open File...")},group:"1_file",order:20});t.appendMenuItem(o.MenubarFileMenu,{group:"1_new",command:{id:K,title:n.localize({key:"miNewFile",comment:["&& denotes a mnemonic"]},"&&New Text File")},order:1}),t.appendMenuItem(o.MenubarFileMenu,{group:"4_save",command:{id:z,title:n.localize({key:"miSave",comment:["&& denotes a mnemonic"]},"&&Save"),precondition:e.or(G,e.and(v,w))},order:1}),t.appendMenuItem(o.MenubarFileMenu,{group:"4_save",command:{id:te,title:n.localize({key:"miSaveAs",comment:["&& denotes a mnemonic"]},"Save &&As..."),precondition:e.or(G,e.and(v,w))},order:2}),t.appendMenuItem(o.MenubarFileMenu,{group:"4_save",command:{id:co,title:n.localize({key:"miSaveAll",comment:["&& denotes a mnemonic"]},"Save A&&ll"),precondition:le},order:3}),t.appendMenuItem(o.MenubarFileMenu,{group:"5_autosave",command:{id:$.ID,title:n.localize({key:"miAutoSave",comment:["&& denotes a mnemonic"]},"A&&uto Save"),toggled:e.notEquals("config.files.autoSave","off")},order:1}),t.appendMenuItem(o.MenubarFileMenu,{group:"6_close",command:{id:k,title:n.localize({key:"miRevert",comment:["&& denotes a mnemonic"]},"Re&&vert File"),precondition:e.or(e.and(xo),e.and(r.Scheme.notEqualsTo(R.untitled),v,w))},order:1}),t.appendMenuItem(o.MenubarFileMenu,{group:"6_close",command:{id:de,title:n.localize({key:"miCloseEditor",comment:["&& denotes a mnemonic"]},"&&Close Editor"),precondition:e.or(G,e.and(v,w))},order:2}),t.appendMenuItem(o.MenubarGoMenu,{group:"3_global_nav",command:{id:"workbench.action.quickOpen",title:n.localize({key:"miGotoFile",comment:["&& denotes a mnemonic"]},"Go to &&File...")},order:1}),t.appendMenuItem(o.ChatAttachmentsContext,{group:"navigation",order:10,command:b,when:e.and(r.HasResource,l.toNegated())}),t.appendMenuItem(o.ChatAttachmentsContext,{group:"navigation",order:20,command:f,when:r.IsFileSystemResource}),t.appendMenuItem(o.ChatAttachmentsContext,{group:"1_cutcopypaste",order:10,command:F,when:r.IsFileSystemResource}),t.appendMenuItem(o.ChatAttachmentsContext,{group:"1_cutcopypaste",order:20,command:S,when:r.IsFileSystemResource}),t.appendMenuItem(o.ChatInlineResourceAnchorContext,{group:"navigation",order:10,command:b,when:e.and(r.HasResource,l.toNegated())}),t.appendMenuItem(o.ChatInlineResourceAnchorContext,{group:"navigation",order:20,command:f,when:r.IsFileSystemResource}),t.appendMenuItem(o.ChatInlineResourceAnchorContext,{group:"1_cutcopypaste",order:10,command:F,when:r.IsFileSystemResource}),t.appendMenuItem(o.ChatInlineResourceAnchorContext,{group:"1_cutcopypaste",order:20,command:S,when:r.IsFileSystemResource});export{q as appendEditorTitleContextMenuItem,m as appendToCommandPalette,f as revealInsideBarCommand};
