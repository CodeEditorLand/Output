{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/Land/Dependency/Editor/Source/vs/workbench/contrib/search/browser/searchActionsCopy.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as nls from '../../../../nls.js';\nimport { IClipboardService } from '../../../../platform/clipboard/common/clipboardService.js';\nimport { ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { IViewsService } from '../../../services/views/common/viewsService.js';\nimport * as Constants from '../common/constants.js';\nimport { Action2, MenuId, registerAction2 } from '../../../../platform/actions/common/actions.js';\nimport { KeybindingWeight } from '../../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { KeyCode, KeyMod } from '../../../../base/common/keyCodes.js';\nimport { category, getSearchView } from './searchActionsBase.js';\nimport { isWindows } from '../../../../base/common/platform.js';\nimport { searchMatchComparer } from './searchCompare.js';\nimport { RenderableMatch, ISearchTreeMatch, isSearchTreeMatch, ISearchTreeFileMatch, ISearchTreeFolderMatch, ISearchTreeFolderMatchWithResource, isSearchTreeFileMatch, isSearchTreeFolderMatch, isSearchTreeFolderMatchWithResource } from './searchTreeModel/searchTreeCommon.js';\n\n//#region Actions\nregisterAction2(class CopyMatchCommandAction extends Action2 {\n\n\tconstructor(\n\t) {\n\t\tsuper({\n\t\t\tid: Constants.SearchCommandIds.CopyMatchCommandId,\n\t\t\ttitle: nls.localize2('copyMatchLabel', \"Copy\"),\n\t\t\tcategory,\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\twhen: Constants.SearchContext.FileMatchOrMatchFocusKey,\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.KeyC,\n\t\t\t},\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.SearchContext,\n\t\t\t\twhen: Constants.SearchContext.FileMatchOrMatchFocusKey,\n\t\t\t\tgroup: 'search_2',\n\t\t\t\torder: 1\n\t\t\t}]\n\t\t});\n\n\t}\n\n\toverride async run(accessor: ServicesAccessor, match: RenderableMatch | undefined): Promise<any> {\n\t\tawait copyMatchCommand(accessor, match);\n\t}\n});\n\nregisterAction2(class CopyPathCommandAction extends Action2 {\n\n\tconstructor(\n\t) {\n\t\tsuper({\n\t\t\tid: Constants.SearchCommandIds.CopyPathCommandId,\n\t\t\ttitle: nls.localize2('copyPathLabel', \"Copy Path\"),\n\t\t\tcategory,\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\twhen: Constants.SearchContext.FileMatchOrFolderMatchWithResourceFocusKey,\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyMod.Alt | KeyCode.KeyC,\n\t\t\t\twin: {\n\t\t\t\t\tprimary: KeyMod.Shift | KeyMod.Alt | KeyCode.KeyC\n\t\t\t\t},\n\t\t\t},\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.SearchContext,\n\t\t\t\twhen: Constants.SearchContext.FileMatchOrFolderMatchWithResourceFocusKey,\n\t\t\t\tgroup: 'search_2',\n\t\t\t\torder: 2\n\t\t\t}]\n\t\t});\n\n\t}\n\n\toverride async run(accessor: ServicesAccessor, fileMatch: ISearchTreeFileMatch | ISearchTreeFolderMatchWithResource | undefined): Promise<any> {\n\t\tawait copyPathCommand(accessor, fileMatch);\n\t}\n});\n\nregisterAction2(class CopyAllCommandAction extends Action2 {\n\n\tconstructor(\n\t) {\n\t\tsuper({\n\t\t\tid: Constants.SearchCommandIds.CopyAllCommandId,\n\t\t\ttitle: nls.localize2('copyAllLabel', \"Copy All\"),\n\t\t\tcategory,\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.SearchContext,\n\t\t\t\twhen: Constants.SearchContext.HasSearchResults,\n\t\t\t\tgroup: 'search_2',\n\t\t\t\torder: 3\n\t\t\t}]\n\t\t});\n\n\t}\n\n\toverride async run(accessor: ServicesAccessor): Promise<any> {\n\t\tawait copyAllCommand(accessor);\n\t}\n});\n\n//#endregion\n\n//#region Helpers\nexport const lineDelimiter = isWindows ? '\\r\\n' : '\\n';\n\nasync function copyPathCommand(accessor: ServicesAccessor, fileMatch: ISearchTreeFileMatch | ISearchTreeFolderMatchWithResource | undefined) {\n\tif (!fileMatch) {\n\t\tconst selection = getSelectedRow(accessor);\n\t\tif (!isSearchTreeFileMatch(selection) || isSearchTreeFolderMatchWithResource(selection)) {\n\t\t\treturn;\n\t\t}\n\n\t\tfileMatch = selection;\n\t}\n\n\tconst clipboardService = accessor.get(IClipboardService);\n\tconst labelService = accessor.get(ILabelService);\n\n\tconst text = labelService.getUriLabel(fileMatch.resource, { noPrefix: true });\n\tawait clipboardService.writeText(text);\n}\n\nasync function copyMatchCommand(accessor: ServicesAccessor, match: RenderableMatch | undefined) {\n\tif (!match) {\n\t\tconst selection = getSelectedRow(accessor);\n\t\tif (!selection) {\n\t\t\treturn;\n\t\t}\n\n\t\tmatch = selection;\n\t}\n\n\tconst clipboardService = accessor.get(IClipboardService);\n\tconst labelService = accessor.get(ILabelService);\n\n\tlet text: string | undefined;\n\tif (isSearchTreeMatch(match)) {\n\t\ttext = matchToString(match);\n\t} else if (isSearchTreeFileMatch(match)) {\n\t\ttext = fileMatchToString(match, labelService).text;\n\t} else if (isSearchTreeFolderMatch(match)) {\n\t\ttext = folderMatchToString(match, labelService).text;\n\t}\n\n\tif (text) {\n\t\tawait clipboardService.writeText(text);\n\t}\n}\n\nasync function copyAllCommand(accessor: ServicesAccessor) {\n\tconst viewsService = accessor.get(IViewsService);\n\tconst clipboardService = accessor.get(IClipboardService);\n\tconst labelService = accessor.get(ILabelService);\n\n\tconst searchView = getSearchView(viewsService);\n\tif (searchView) {\n\t\tconst root = searchView.searchResult;\n\n\t\tconst text = allFolderMatchesToString(root.folderMatches(), labelService);\n\t\tawait clipboardService.writeText(text);\n\t}\n}\n\nfunction matchToString(match: ISearchTreeMatch, indent = 0): string {\n\tconst getFirstLinePrefix = () => `${match.range().startLineNumber},${match.range().startColumn}`;\n\tconst getOtherLinePrefix = (i: number) => match.range().startLineNumber + i + '';\n\n\tconst fullMatchLines = match.fullPreviewLines();\n\tconst largestPrefixSize = fullMatchLines.reduce((largest, _, i) => {\n\t\tconst thisSize = i === 0 ?\n\t\t\tgetFirstLinePrefix().length :\n\t\t\tgetOtherLinePrefix(i).length;\n\n\t\treturn Math.max(thisSize, largest);\n\t}, 0);\n\n\tconst formattedLines = fullMatchLines\n\t\t.map((line, i) => {\n\t\t\tconst prefix = i === 0 ?\n\t\t\t\tgetFirstLinePrefix() :\n\t\t\t\tgetOtherLinePrefix(i);\n\n\t\t\tconst paddingStr = ' '.repeat(largestPrefixSize - prefix.length);\n\t\t\tconst indentStr = ' '.repeat(indent);\n\t\t\treturn `${indentStr}${prefix}: ${paddingStr}${line}`;\n\t\t});\n\n\treturn formattedLines.join('\\n');\n}\n\nfunction fileFolderMatchToString(match: ISearchTreeFileMatch | ISearchTreeFolderMatch | ISearchTreeFolderMatchWithResource, labelService: ILabelService): { text: string; count: number } {\n\tif (isSearchTreeFileMatch(match)) {\n\t\treturn fileMatchToString(match, labelService);\n\t} else {\n\t\treturn folderMatchToString(match, labelService);\n\t}\n}\n\nfunction fileMatchToString(fileMatch: ISearchTreeFileMatch, labelService: ILabelService): { text: string; count: number } {\n\tconst matchTextRows = fileMatch.matches()\n\t\t.sort(searchMatchComparer)\n\t\t.map(match => matchToString(match, 2));\n\tconst uriString = labelService.getUriLabel(fileMatch.resource, { noPrefix: true });\n\treturn {\n\t\ttext: `${uriString}${lineDelimiter}${matchTextRows.join(lineDelimiter)}`,\n\t\tcount: matchTextRows.length\n\t};\n}\n\nfunction folderMatchToString(folderMatch: ISearchTreeFolderMatchWithResource | ISearchTreeFolderMatch, labelService: ILabelService): { text: string; count: number } {\n\tconst results: string[] = [];\n\tlet numMatches = 0;\n\n\tconst matches = folderMatch.matches().sort(searchMatchComparer);\n\n\tmatches.forEach(match => {\n\t\tconst result = fileFolderMatchToString(match, labelService);\n\t\tnumMatches += result.count;\n\t\tresults.push(result.text);\n\t});\n\n\treturn {\n\t\ttext: results.join(lineDelimiter + lineDelimiter),\n\t\tcount: numMatches\n\t};\n}\n\nfunction allFolderMatchesToString(folderMatches: Array<ISearchTreeFolderMatchWithResource | ISearchTreeFolderMatch>, labelService: ILabelService): string {\n\tconst folderResults: string[] = [];\n\tfolderMatches = folderMatches.sort(searchMatchComparer);\n\tfor (let i = 0; i < folderMatches.length; i++) {\n\t\tconst folderResult = folderMatchToString(folderMatches[i], labelService);\n\t\tif (folderResult.count) {\n\t\t\tfolderResults.push(folderResult.text);\n\t\t}\n\t}\n\n\treturn folderResults.join(lineDelimiter + lineDelimiter);\n}\n\nfunction getSelectedRow(accessor: ServicesAccessor): RenderableMatch | undefined | null {\n\tconst viewsService = accessor.get(IViewsService);\n\tconst searchView = getSearchView(viewsService);\n\treturn searchView?.getControl().getSelection()[0];\n}\n\n//#endregion\n"],
  "mappings": ";;AAIA,YAAY,SAAS;AACrB,SAAS,yBAAyB;AAClC,SAAS,wBAAwB;AACjC,SAAS,qBAAqB;AAC9B,SAAS,qBAAqB;AAC9B,YAAY,eAAe;AAC3B,SAAS,SAAS,QAAQ,uBAAuB;AACjD,SAAS,wBAAwB;AACjC,SAAS,SAAS,cAAc;AAChC,SAAS,UAAU,qBAAqB;AACxC,SAAS,iBAAiB;AAC1B,SAAS,2BAA2B;AACpC,SAAS,iBAAiB,kBAAkB,mBAAmB,sBAAsB,wBAAwB,oCAAoC,uBAAuB,yBAAyB,2CAA2C;AAG5O,gBAAgB,MAAM,+BAA+B,QAAQ;AAAA,EAnB7D,OAmB6D;AAAA;AAAA;AAAA,EAE5D,cACE;AACD,UAAM;AAAA,MACL,IAAI,UAAU,iBAAiB;AAAA,MAC/B,OAAO,IAAI,UAAU,kBAAkB,MAAM;AAAA,MAC7C;AAAA,MACA,YAAY;AAAA,QACX,QAAQ,iBAAiB;AAAA,QACzB,MAAM,UAAU,cAAc;AAAA,QAC9B,SAAS,OAAO,UAAU,QAAQ;AAAA,MACnC;AAAA,MACA,MAAM,CAAC;AAAA,QACN,IAAI,OAAO;AAAA,QACX,MAAM,UAAU,cAAc;AAAA,QAC9B,OAAO;AAAA,QACP,OAAO;AAAA,MACR,CAAC;AAAA,IACF,CAAC;AAAA,EAEF;AAAA,EAEA,MAAe,IAAI,UAA4B,OAAkD;AAChG,UAAM,iBAAiB,UAAU,KAAK;AAAA,EACvC;AACD,CAAC;AAED,gBAAgB,MAAM,8BAA8B,QAAQ;AAAA,EA/C5D,OA+C4D;AAAA;AAAA;AAAA,EAE3D,cACE;AACD,UAAM;AAAA,MACL,IAAI,UAAU,iBAAiB;AAAA,MAC/B,OAAO,IAAI,UAAU,iBAAiB,WAAW;AAAA,MACjD;AAAA,MACA,YAAY;AAAA,QACX,QAAQ,iBAAiB;AAAA,QACzB,MAAM,UAAU,cAAc;AAAA,QAC9B,SAAS,OAAO,UAAU,OAAO,MAAM,QAAQ;AAAA,QAC/C,KAAK;AAAA,UACJ,SAAS,OAAO,QAAQ,OAAO,MAAM,QAAQ;AAAA,QAC9C;AAAA,MACD;AAAA,MACA,MAAM,CAAC;AAAA,QACN,IAAI,OAAO;AAAA,QACX,MAAM,UAAU,cAAc;AAAA,QAC9B,OAAO;AAAA,QACP,OAAO;AAAA,MACR,CAAC;AAAA,IACF,CAAC;AAAA,EAEF;AAAA,EAEA,MAAe,IAAI,UAA4B,WAAgG;AAC9I,UAAM,gBAAgB,UAAU,SAAS;AAAA,EAC1C;AACD,CAAC;AAED,gBAAgB,MAAM,6BAA6B,QAAQ;AAAA,EA9E3D,OA8E2D;AAAA;AAAA;AAAA,EAE1D,cACE;AACD,UAAM;AAAA,MACL,IAAI,UAAU,iBAAiB;AAAA,MAC/B,OAAO,IAAI,UAAU,gBAAgB,UAAU;AAAA,MAC/C;AAAA,MACA,MAAM,CAAC;AAAA,QACN,IAAI,OAAO;AAAA,QACX,MAAM,UAAU,cAAc;AAAA,QAC9B,OAAO;AAAA,QACP,OAAO;AAAA,MACR,CAAC;AAAA,IACF,CAAC;AAAA,EAEF;AAAA,EAEA,MAAe,IAAI,UAA0C;AAC5D,UAAM,eAAe,QAAQ;AAAA,EAC9B;AACD,CAAC;AAKM,MAAM,gBAAgB,YAAY,SAAS;AAElD,eAAe,gBAAgB,UAA4B,WAAkF;AAC5I,MAAI,CAAC,WAAW;AACf,UAAM,YAAY,eAAe,QAAQ;AACzC,QAAI,CAAC,sBAAsB,SAAS,KAAK,oCAAoC,SAAS,GAAG;AACxF;AAAA,IACD;AAEA,gBAAY;AAAA,EACb;AAEA,QAAM,mBAAmB,SAAS,IAAI,iBAAiB;AACvD,QAAM,eAAe,SAAS,IAAI,aAAa;AAE/C,QAAM,OAAO,aAAa,YAAY,UAAU,UAAU,EAAE,UAAU,KAAK,CAAC;AAC5E,QAAM,iBAAiB,UAAU,IAAI;AACtC;AAfe;AAiBf,eAAe,iBAAiB,UAA4B,OAAoC;AAC/F,MAAI,CAAC,OAAO;AACX,UAAM,YAAY,eAAe,QAAQ;AACzC,QAAI,CAAC,WAAW;AACf;AAAA,IACD;AAEA,YAAQ;AAAA,EACT;AAEA,QAAM,mBAAmB,SAAS,IAAI,iBAAiB;AACvD,QAAM,eAAe,SAAS,IAAI,aAAa;AAE/C,MAAI;AACJ,MAAI,kBAAkB,KAAK,GAAG;AAC7B,WAAO,cAAc,KAAK;AAAA,EAC3B,WAAW,sBAAsB,KAAK,GAAG;AACxC,WAAO,kBAAkB,OAAO,YAAY,EAAE;AAAA,EAC/C,WAAW,wBAAwB,KAAK,GAAG;AAC1C,WAAO,oBAAoB,OAAO,YAAY,EAAE;AAAA,EACjD;AAEA,MAAI,MAAM;AACT,UAAM,iBAAiB,UAAU,IAAI;AAAA,EACtC;AACD;AAzBe;AA2Bf,eAAe,eAAe,UAA4B;AACzD,QAAM,eAAe,SAAS,IAAI,aAAa;AAC/C,QAAM,mBAAmB,SAAS,IAAI,iBAAiB;AACvD,QAAM,eAAe,SAAS,IAAI,aAAa;AAE/C,QAAM,aAAa,cAAc,YAAY;AAC7C,MAAI,YAAY;AACf,UAAM,OAAO,WAAW;AAExB,UAAM,OAAO,yBAAyB,KAAK,cAAc,GAAG,YAAY;AACxE,UAAM,iBAAiB,UAAU,IAAI;AAAA,EACtC;AACD;AAZe;AAcf,SAAS,cAAc,OAAyB,SAAS,GAAW;AACnE,QAAM,qBAAqB,6BAAM,GAAG,MAAM,MAAM,EAAE,eAAe,IAAI,MAAM,MAAM,EAAE,WAAW,IAAnE;AAC3B,QAAM,qBAAqB,wBAAC,MAAc,MAAM,MAAM,EAAE,kBAAkB,IAAI,IAAnD;AAE3B,QAAM,iBAAiB,MAAM,iBAAiB;AAC9C,QAAM,oBAAoB,eAAe,OAAO,CAAC,SAAS,GAAG,MAAM;AAClE,UAAM,WAAW,MAAM,IACtB,mBAAmB,EAAE,SACrB,mBAAmB,CAAC,EAAE;AAEvB,WAAO,KAAK,IAAI,UAAU,OAAO;AAAA,EAClC,GAAG,CAAC;AAEJ,QAAM,iBAAiB,eACrB,IAAI,CAAC,MAAM,MAAM;AACjB,UAAM,SAAS,MAAM,IACpB,mBAAmB,IACnB,mBAAmB,CAAC;AAErB,UAAM,aAAa,IAAI,OAAO,oBAAoB,OAAO,MAAM;AAC/D,UAAM,YAAY,IAAI,OAAO,MAAM;AACnC,WAAO,GAAG,SAAS,GAAG,MAAM,KAAK,UAAU,GAAG,IAAI;AAAA,EACnD,CAAC;AAEF,SAAO,eAAe,KAAK,IAAI;AAChC;AAzBS;AA2BT,SAAS,wBAAwB,OAA2F,cAA8D;AACzL,MAAI,sBAAsB,KAAK,GAAG;AACjC,WAAO,kBAAkB,OAAO,YAAY;AAAA,EAC7C,OAAO;AACN,WAAO,oBAAoB,OAAO,YAAY;AAAA,EAC/C;AACD;AANS;AAQT,SAAS,kBAAkB,WAAiC,cAA8D;AACzH,QAAM,gBAAgB,UAAU,QAAQ,EACtC,KAAK,mBAAmB,EACxB,IAAI,WAAS,cAAc,OAAO,CAAC,CAAC;AACtC,QAAM,YAAY,aAAa,YAAY,UAAU,UAAU,EAAE,UAAU,KAAK,CAAC;AACjF,SAAO;AAAA,IACN,MAAM,GAAG,SAAS,GAAG,aAAa,GAAG,cAAc,KAAK,aAAa,CAAC;AAAA,IACtE,OAAO,cAAc;AAAA,EACtB;AACD;AATS;AAWT,SAAS,oBAAoB,aAA0E,cAA8D;AACpK,QAAM,UAAoB,CAAC;AAC3B,MAAI,aAAa;AAEjB,QAAM,UAAU,YAAY,QAAQ,EAAE,KAAK,mBAAmB;AAE9D,UAAQ,QAAQ,WAAS;AACxB,UAAM,SAAS,wBAAwB,OAAO,YAAY;AAC1D,kBAAc,OAAO;AACrB,YAAQ,KAAK,OAAO,IAAI;AAAA,EACzB,CAAC;AAED,SAAO;AAAA,IACN,MAAM,QAAQ,KAAK,gBAAgB,aAAa;AAAA,IAChD,OAAO;AAAA,EACR;AACD;AAhBS;AAkBT,SAAS,yBAAyB,eAAmF,cAAqC;AACzJ,QAAM,gBAA0B,CAAC;AACjC,kBAAgB,cAAc,KAAK,mBAAmB;AACtD,WAAS,IAAI,GAAG,IAAI,cAAc,QAAQ,KAAK;AAC9C,UAAM,eAAe,oBAAoB,cAAc,CAAC,GAAG,YAAY;AACvE,QAAI,aAAa,OAAO;AACvB,oBAAc,KAAK,aAAa,IAAI;AAAA,IACrC;AAAA,EACD;AAEA,SAAO,cAAc,KAAK,gBAAgB,aAAa;AACxD;AAXS;AAaT,SAAS,eAAe,UAAgE;AACvF,QAAM,eAAe,SAAS,IAAI,aAAa;AAC/C,QAAM,aAAa,cAAc,YAAY;AAC7C,SAAO,YAAY,WAAW,EAAE,aAAa,EAAE,CAAC;AACjD;AAJS;",
  "names": []
}
