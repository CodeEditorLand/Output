import{isIMatchInNotebook as p}from"./notebookSearch/notebookSearchModelBase.js";import{compareFileExtensions as x,compareFileNames as s,comparePaths as w}from"../../../../base/common/comparers.js";import{SearchSortOrder as n}from"../../../services/search/common/search.js";import{Range as S}from"../../../../editor/common/core/range.js";import{createParentList as g,isSearchTreeFileMatch as t,isSearchTreeFolderMatch as d,isSearchTreeMatch as M}from"./searchTreeModel/searchTreeCommon.js";import{isSearchTreeAIFileMatch as P}from"./AISearch/aiSearchModelBase.js";let f=-1,b=-1;function N(r,e,c=n.Default){if(t(r)&&d(e))return 1;if(t(e)&&d(r))return-1;if(d(r)&&d(e)){if(f=r.index(),b=e.index(),f!==-1&&b!==-1)return f-b;if(P(r)&&P(e))return r.rank-e.rank;switch(c){case n.CountDescending:return e.count()-r.count();case n.CountAscending:return r.count()-e.count();case n.Type:return x(r.name(),e.name());case n.FileNames:return s(r.name(),e.name());default:return!r.resource||!e.resource?0:w(r.resource.fsPath,e.resource.fsPath)||s(r.name(),e.name())}}if(t(r)&&t(e))switch(c){case n.CountDescending:return e.count()-r.count();case n.CountAscending:return r.count()-e.count();case n.Type:return x(r.name(),e.name());case n.FileNames:return s(r.name(),e.name());case n.Modified:{const a=r.fileStat,i=e.fileStat;if(a&&i)return i.mtime-a.mtime}default:return w(r.resource.fsPath,e.resource.fsPath)||s(r.name(),e.name())}return p(r)&&p(e)?R(r,e):M(r)&&M(e)?S.compareRangesUsingStarts(r.range(),e.range()):0}function R(r,e){return r.cellIndex===e.cellIndex?r.webviewIndex!==void 0&&e.webviewIndex!==void 0?r.webviewIndex-e.webviewIndex:r.webviewIndex===void 0&&e.webviewIndex===void 0?S.compareRangesUsingStarts(r.range(),e.range()):r.webviewIndex!==void 0?1:-1:r.cellIndex<e.cellIndex?-1:1}function O(r,e,c=n.Default){const a=g(r),i=g(e);let o=a.length-1,u=i.length-1;for(;o>=0&&u>=0;){if(a[o].id()!==i[u].id())return N(a[o],i[u],c);o--,u--}const h=o===0,I=u===0;return h&&!I?1:!h&&I?-1:0}export{O as searchComparer,N as searchMatchComparer};
