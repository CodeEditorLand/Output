var o=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var c=(s,r,t,e)=>{for(var n=e>1?void 0:e?u(r,t):r,i=s.length-1,a;i>=0;i--)(a=s[i])&&(n=(e?a(r,t,n):a(n))||n);return e&&n&&o(r,t,n),n};import{memoize as g}from"../../../../../base/common/decorators.js";import{lcut as p}from"../../../../../base/common/strings.js";import{OneLineRange as f}from"../../../../services/search/common/search.js";import{MATCH_PREFIX as v}from"./searchTreeCommon.js";import{Range as m}from"../../../../../editor/common/core/range.js";function I(s,r,t){const e=s.previewText.split(`
`);return s.rangeLocations.map(n=>{const i=n.preview;return new h(r,e,i,n.source,t)})}const l=class l{constructor(r,t,e,n,i=!1){this._parent=r;this._fullPreviewLines=t;this._isReadonly=i;this._oneLinePreviewText=t[e.startLineNumber];const a=e.startLineNumber===e.endLineNumber?e.endColumn:this._oneLinePreviewText.length;this._rangeInPreviewText=new f(1,e.startColumn+1,a+1),this._range=new m(n.startLineNumber+1,n.startColumn+1,n.endLineNumber+1,n.endColumn+1),this._fullPreviewRange=e,this._id=v+this._parent.resource.toString()+">"+this._range+this.getMatchString()}static MAX_PREVIEW_CHARS=250;_id;_range;_oneLinePreviewText;_rangeInPreviewText;_fullPreviewRange;id(){return this._id}parent(){return this._parent}text(){return this._oneLinePreviewText}range(){return this._range}preview(){const r=this._oneLinePreviewText.substring(0,this._rangeInPreviewText.startColumn-1),t=p(r,26,"\u2026");let e=this.getMatchString(),n=this._oneLinePreviewText.substring(this._rangeInPreviewText.endColumn-1),i=l.MAX_PREVIEW_CHARS-t.length;return e=e.substr(0,i),i-=e.length,n=n.substr(0,i),{before:t,fullBefore:r,inside:e,after:n}}get replaceString(){const r=this.parent().parent().searchModel;if(!r.replacePattern)throw new Error("searchModel.replacePattern must be set before accessing replaceString");const t=this.fullMatchText();let e=r.replacePattern.getReplaceString(t,r.preserveCase);if(e!==null)return e;const n=t.replace(/\r\n/g,`
`);if(n!==t&&(e=r.replacePattern.getReplaceString(n,r.preserveCase),e!==null))return e;const i=this.fullMatchText(!0);if(e=r.replacePattern.getReplaceString(i,r.preserveCase),e!==null)return e;const a=i.replace(/\r\n/g,`
`);return a!==i&&(e=r.replacePattern.getReplaceString(a,r.preserveCase),e!==null)?e:r.replacePattern.pattern}fullMatchText(r=!1){let t;return r?t=this._fullPreviewLines:(t=this._fullPreviewLines.slice(this._fullPreviewRange.startLineNumber,this._fullPreviewRange.endLineNumber+1),t[t.length-1]=t[t.length-1].slice(0,this._fullPreviewRange.endColumn),t[0]=t[0].slice(this._fullPreviewRange.startColumn)),t.join(`
`)}rangeInPreview(){return{...this._fullPreviewRange,startColumn:this._fullPreviewRange.startColumn+1,endColumn:this._fullPreviewRange.endColumn+1}}fullPreviewLines(){return this._fullPreviewLines.slice(this._fullPreviewRange.startLineNumber,this._fullPreviewRange.endLineNumber+1)}getMatchString(){return this._oneLinePreviewText.substring(this._rangeInPreviewText.startColumn-1,this._rangeInPreviewText.endColumn-1)}get isReadonly(){return this._isReadonly}};c([g],l.prototype,"preview",1);let h=l;export{h as MatchImpl,I as textSearchResultToMatches};
