import{Codicon as h}from"../../../../../base/common/codicons.js";import{KeyCode as s,KeyMod as m}from"../../../../../base/common/keyCodes.js";import{localize2 as i}from"../../../../../nls.js";import{ContextKeyExpr as r}from"../../../../../platform/contextkey/common/contextkey.js";import{historyNavigationVisible as y}from"../../../../../platform/history/browser/contextScopedHistoryWidget.js";import{KeybindingWeight as p}from"../../../../../platform/keybinding/common/keybindingsRegistry.js";import{AbstractInlineChatAction as w}from"../../../inlineChat/browser/inlineChatActions.js";import{CTX_INLINE_CHAT_EMPTY as _}from"../../../inlineChat/common/inlineChat.js";import{isDetachedTerminalInstance as c}from"../../../terminal/browser/terminal.js";import{registerActiveXtermAction as d}from"../../../terminal/browser/terminalActions.js";import{TerminalContextKeys as a}from"../../../terminal/common/terminalContextKey.js";import{MENU_TERMINAL_CHAT_INPUT as A,MENU_TERMINAL_CHAT_WIDGET as k,MENU_TERMINAL_CHAT_WIDGET_STATUS as g,TerminalChatCommandId as l,TerminalChatContextKeys as e}from"./terminalChat.js";import{TerminalChatController as n}from"./terminalChatController.js";d({id:l.Start,title:i("startChat","Start in Terminal"),keybinding:{primary:m.CtrlCmd|s.KeyI,when:r.and(a.focusInAny),weight:p.ExternalExtension+1},f1:!0,category:w.category,precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.hasChatAgent),run:(C,u,t,o)=>{if(c(t))return;const f=n.activeChatController||n.get(t);o&&(o=typeof o=="string"?{query:o}:o,typeof o=="object"&&o!==null&&"query"in o&&typeof o.query=="string"&&(f?.updateInput(o.query,!1),"isPartialQuery"in o&&o.isPartialQuery||f?.acceptInput())),f?.reveal()}}),d({id:l.Close,title:i("closeChat","Close Chat"),keybinding:{primary:s.Escape,secondary:[m.Shift|s.Escape],when:r.and(e.focused,e.visible),weight:p.WorkbenchContrib},icon:h.close,menu:{id:k,group:"navigation",order:2},f1:!0,precondition:r.and(r.and(e.focused,e.visible)),run:(C,u,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.clear()}}),d({id:l.Discard,title:i("discard","Discard"),metadata:{description:i("discardDescription","Discards the terminal current chat response, hide the chat widget, and clear the chat input.")},icon:h.discard,menu:{id:g,group:"0_main",order:2,when:r.and(e.focused,e.responseContainsCodeBlock)},f1:!0,precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.focused,e.responseContainsCodeBlock),run:(C,u,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.clear()}}),d({id:l.RunCommand,title:i("runCommand","Run Chat Command"),shortTitle:i("run","Run"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate(),e.responseContainsCodeBlock,e.responseContainsMultipleCodeBlocks.negate()),icon:h.play,keybinding:{when:e.requestActive.negate(),weight:p.WorkbenchContrib,primary:m.CtrlCmd|s.Enter},menu:{id:g,group:"0_main",order:0,when:r.and(e.responseContainsCodeBlock,e.responseContainsMultipleCodeBlocks.negate(),e.requestActive.negate())},run:(C,u,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.acceptCommand(!0)}}),d({id:l.RunFirstCommand,title:i("runFirstCommand","Run First Chat Command"),shortTitle:i("runFirst","Run First"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate(),e.responseContainsMultipleCodeBlocks),icon:h.play,keybinding:{when:e.requestActive.negate(),weight:p.WorkbenchContrib,primary:m.CtrlCmd|s.Enter},menu:{id:g,group:"0_main",order:0,when:r.and(e.responseContainsMultipleCodeBlocks,e.requestActive.negate())},run:(C,u,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.acceptCommand(!0)}}),d({id:l.InsertCommand,title:i("insertCommand","Insert Chat Command"),shortTitle:i("insert","Insert"),icon:h.insert,precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate(),e.responseContainsCodeBlock,e.responseContainsMultipleCodeBlocks.negate()),keybinding:{when:e.requestActive.negate(),weight:p.WorkbenchContrib,primary:m.Alt|s.Enter,secondary:[m.CtrlCmd|s.Enter|m.Alt]},menu:{id:g,group:"0_main",order:1,when:r.and(e.responseContainsCodeBlock,e.responseContainsMultipleCodeBlocks.negate(),e.requestActive.negate())},run:(C,u,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.acceptCommand(!1)}}),d({id:l.InsertFirstCommand,title:i("insertFirstCommand","Insert First Chat Command"),shortTitle:i("insertFirst","Insert First"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate(),e.responseContainsMultipleCodeBlocks),keybinding:{when:e.requestActive.negate(),weight:p.WorkbenchContrib,primary:m.Alt|s.Enter,secondary:[m.CtrlCmd|s.Enter|m.Alt]},menu:{id:g,group:"0_main",order:1,when:r.and(e.responseContainsMultipleCodeBlocks,e.requestActive.negate())},run:(C,u,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.acceptCommand(!1)}}),d({id:l.ViewInChat,title:i("viewInChat","View in Chat"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate()),icon:h.commentDiscussion,menu:[{id:g,group:"0_main",order:1,when:r.and(e.responseContainsCodeBlock,e.requestActive.negate())},{id:k,group:"navigation",order:1,when:r.and(_.negate(),e.responseContainsCodeBlock,e.requestActive.negate())}],run:(C,u,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.viewInChat()}}),d({id:l.MakeRequest,title:i("makeChatRequest","Make Chat Request"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate(),_.negate()),icon:h.send,keybinding:{when:r.and(e.focused,e.requestActive.negate(),y.isEqualTo(!1)),weight:p.WorkbenchContrib,primary:s.Enter},menu:{id:A,group:"navigation",order:1,when:e.requestActive.negate()},run:(C,u,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.acceptInput()}}),d({id:l.Cancel,title:i("cancelChat","Cancel Chat"),precondition:r.and(e.requestActive),icon:h.stopCircle,menu:{id:A,group:"navigation",when:e.requestActive},run:(C,u,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.cancel()}}),d({id:l.PreviousFromHistory,title:i("previousFromHitory","Previous From History"),precondition:e.focused,keybinding:{when:r.and(e.focused,y.isEqualTo(!1)),weight:p.WorkbenchContrib,primary:s.UpArrow},run:(C,u,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.populateHistory(!0)}}),d({id:l.NextFromHistory,title:i("nextFromHitory","Next From History"),precondition:e.focused,keybinding:{when:r.and(e.focused,y.isEqualTo(!1)),weight:p.WorkbenchContrib,primary:s.DownArrow},run:(C,u,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.populateHistory(!1)}});
