var C=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var y=(s,t,n,d)=>{for(var e=d>1?void 0:d?W(t,n):t,h=s.length-1,f;h>=0;h--)(f=s[h])&&(e=(d?f(t,n,e):f(e))||e);return d&&e&&C(t,n,e),e},u=(s,t)=>(n,d)=>t(n,d,s);import"../../../../../base/browser/dom.js";import{KeyCode as a,KeyMod as o}from"../../../../../base/common/keyCodes.js";import{Lazy as b}from"../../../../../base/common/lazy.js";import{Disposable as w}from"../../../../../base/common/lifecycle.js";import{localize2 as l}from"../../../../../nls.js";import{ContextKeyExpr as c}from"../../../../../platform/contextkey/common/contextkey.js";import{IInstantiationService as F}from"../../../../../platform/instantiation/common/instantiation.js";import{KeybindingWeight as m}from"../../../../../platform/keybinding/common/keybindingsRegistry.js";import{findInFilesCommand as I}from"../../../search/browser/searchActionsFind.js";import{ITerminalService as v,isDetachedTerminalInstance as k}from"../../../terminal/browser/terminal.js";import{registerActiveInstanceAction as T,registerActiveXtermAction as p}from"../../../terminal/browser/terminalActions.js";import{registerTerminalContribution as S}from"../../../terminal/browser/terminalExtensions.js";import{TerminalContextKeys as i}from"../../../terminal/common/terminalContextKey.js";import{TerminalFindCommandId as g}from"../common/terminal.find.js";import"./media/terminalFind.css";import{TerminalFindWidget as x}from"./terminalFindWidget.js";let r=class extends w{static ID="terminal.find";static activeFindWidget;static get(t){return t.getContribution(r.ID)}_findWidget;_lastLayoutDimensions;get findWidget(){return this._findWidget.value}constructor(t,n,d){super(),this._findWidget=new b(()=>{const e=n.createInstance(x,t.instance);if(e.focusTracker.onDidFocus(()=>{r.activeFindWidget=this,t.instance.forceScrollbarVisibility(),k(t.instance)||d.setActiveInstance(t.instance)}),e.focusTracker.onDidBlur(()=>{r.activeFindWidget=void 0,t.instance.resetScrollbarVisibility()}),!t.instance.domElement)throw new Error("FindWidget expected terminal DOM to be initialized");return t.instance.domElement?.appendChild(e.getDomNode()),this._lastLayoutDimensions&&e.layout(this._lastLayoutDimensions.width),e})}layout(t,n){this._lastLayoutDimensions=n,this._findWidget.rawValue?.layout(n.width)}xtermReady(t){this._register(t.onDidChangeFindResults(()=>this._findWidget.rawValue?.updateResultCount()))}dispose(){r.activeFindWidget===this&&(r.activeFindWidget=void 0),super.dispose(),this._findWidget.rawValue?.dispose()}};r=y([u(1,F),u(2,v)],r),S(r.ID,r,!0),p({id:g.FindFocus,title:l("workbench.action.terminal.focusFind","Focus Find"),keybinding:{primary:o.CtrlCmd|a.KeyF,when:c.or(i.findFocus,i.focusInAny),weight:m.WorkbenchContrib},precondition:c.or(i.processSupported,i.terminalHasBeenCreated),run:(s,t,n)=>{(r.activeFindWidget||r.get(n))?.findWidget.reveal()}}),p({id:g.FindHide,title:l("workbench.action.terminal.hideFind","Hide Find"),keybinding:{primary:a.Escape,secondary:[o.Shift|a.Escape],when:c.and(i.focusInAny,i.findVisible),weight:m.WorkbenchContrib},precondition:c.or(i.processSupported,i.terminalHasBeenCreated),run:(s,t,n)=>{(r.activeFindWidget||r.get(n))?.findWidget.hide()}}),p({id:g.ToggleFindRegex,title:l("workbench.action.terminal.toggleFindRegex","Toggle Find Using Regex"),keybinding:{primary:o.Alt|a.KeyR,mac:{primary:o.CtrlCmd|o.Alt|a.KeyR},when:i.findVisible,weight:m.WorkbenchContrib},precondition:c.or(i.processSupported,i.terminalHasBeenCreated),run:(s,t,n)=>{const e=(r.activeFindWidget||r.get(n))?.findWidget.state;e?.change({isRegex:!e.isRegex},!1)}}),p({id:g.ToggleFindWholeWord,title:l("workbench.action.terminal.toggleFindWholeWord","Toggle Find Using Whole Word"),keybinding:{primary:o.Alt|a.KeyW,mac:{primary:o.CtrlCmd|o.Alt|a.KeyW},when:i.findVisible,weight:m.WorkbenchContrib},precondition:c.or(i.processSupported,i.terminalHasBeenCreated),run:(s,t,n)=>{const e=(r.activeFindWidget||r.get(n))?.findWidget.state;e?.change({wholeWord:!e.wholeWord},!1)}}),p({id:g.ToggleFindCaseSensitive,title:l("workbench.action.terminal.toggleFindCaseSensitive","Toggle Find Using Case Sensitive"),keybinding:{primary:o.Alt|a.KeyC,mac:{primary:o.CtrlCmd|o.Alt|a.KeyC},when:i.findVisible,weight:m.WorkbenchContrib},precondition:c.or(i.processSupported,i.terminalHasBeenCreated),run:(s,t,n)=>{const e=(r.activeFindWidget||r.get(n))?.findWidget.state;e?.change({matchCase:!e.matchCase},!1)}}),p({id:g.FindNext,title:l("workbench.action.terminal.findNext","Find Next"),keybinding:[{primary:a.F3,mac:{primary:o.CtrlCmd|a.KeyG,secondary:[a.F3]},when:c.or(i.focusInAny,i.findFocus),weight:m.WorkbenchContrib},{primary:o.Shift|a.Enter,when:i.findInputFocus,weight:m.WorkbenchContrib}],precondition:c.or(i.processSupported,i.terminalHasBeenCreated),run:(s,t,n)=>{const e=(r.activeFindWidget||r.get(n))?.findWidget;e&&(e.show(),e.find(!1))}}),p({id:g.FindPrevious,title:l("workbench.action.terminal.findPrevious","Find Previous"),keybinding:[{primary:o.Shift|a.F3,mac:{primary:o.CtrlCmd|o.Shift|a.KeyG,secondary:[o.Shift|a.F3]},when:c.or(i.focusInAny,i.findFocus),weight:m.WorkbenchContrib},{primary:a.Enter,when:i.findInputFocus,weight:m.WorkbenchContrib}],precondition:c.or(i.processSupported,i.terminalHasBeenCreated),run:(s,t,n)=>{const e=(r.activeFindWidget||r.get(n))?.findWidget;e&&(e.show(),e.find(!0))}}),T({id:g.SearchWorkspace,title:l("workbench.action.terminal.searchWorkspace","Search Workspace"),keybinding:[{primary:o.CtrlCmd|o.Shift|a.KeyF,when:c.and(i.processSupported,i.focus,i.textSelected),weight:m.WorkbenchContrib+50}],run:(s,t,n)=>I(n,{query:s.selection})});
