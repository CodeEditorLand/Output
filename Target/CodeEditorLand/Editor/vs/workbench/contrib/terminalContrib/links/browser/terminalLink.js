var f=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var h=(s,a,e,o)=>{for(var t=o>1?void 0:o?m(a,e):a,n=s.length-1,r;n>=0;n--)(r=s[n])&&(t=(o?r(a,e,t):r(t))||t);return o&&t&&f(a,e,t),t},u=(s,a)=>(e,o)=>a(e,o,s);import{Disposable as _,DisposableStore as g,MutableDisposable as v}from"../../../../../base/common/lifecycle.js";import*as l from"../../../../../base/browser/dom.js";import{RunOnceScheduler as y}from"../../../../../base/common/async.js";import{convertBufferRangeToViewport as b}from"./terminalLinkHelpers.js";import{isMacintosh as k}from"../../../../../base/common/platform.js";import{Emitter as C}from"../../../../../base/common/event.js";import{IConfigurationService as w}from"../../../../../platform/configuration/common/configuration.js";import"./links.js";let c=class extends _{constructor(e,o,t,n,r,d,i,p,L,D,I,M,S){super();this._xterm=e;this.range=o;this.text=t;this.uri=n;this.parsedLink=r;this.actions=d;this._viewportY=i;this._activateCallback=p;this._tooltipCallback=L;this._isHighConfidenceLink=D;this.label=I;this._type=M;this._configurationService=S;this.decorations={pointerCursor:!1,underline:this._isHighConfidenceLink}}decorations;_tooltipScheduler=this._register(new v);_hoverListeners=this._register(new v);_onInvalidated=new C;get onInvalidated(){return this._onInvalidated.event}get type(){return this._type}activate(e,o){this._activateCallback(e,o)}hover(e,o){const t=l.getWindow(e),n=t.document,r=this._hoverListeners.value=new g;r.add(l.addDisposableListener(n,"keydown",i=>{!i.repeat&&this._isModifierDown(i)&&this._enableDecorations()})),r.add(l.addDisposableListener(n,"keyup",i=>{!i.repeat&&!this._isModifierDown(i)&&this._disableDecorations()})),r.add(this._xterm.onRender(i=>{const p=this.range.start.y-this._viewportY;p>=i.start&&p<=i.end&&this._onInvalidated.fire()})),this._isHighConfidenceLink&&(this._tooltipScheduler.value=new y(()=>{this._tooltipCallback(this,b(this.range,this._viewportY),this._isHighConfidenceLink?()=>this._enableDecorations():void 0,this._isHighConfidenceLink?()=>this._disableDecorations():void 0),this._tooltipScheduler.clear()},this._configurationService.getValue("workbench.hover.delay")),this._tooltipScheduler.value.schedule());const d={x:e.pageX,y:e.pageY};r.add(l.addDisposableListener(n,l.EventType.MOUSE_MOVE,i=>{this._isModifierDown(i)?this._enableDecorations():this._disableDecorations(),(Math.abs(i.pageX-d.x)>t.devicePixelRatio*2||Math.abs(i.pageY-d.y)>t.devicePixelRatio*2)&&(d.x=i.pageX,d.y=i.pageY,this._tooltipScheduler.value?.schedule())}))}leave(){this._hoverListeners.clear(),this._tooltipScheduler.clear()}_enableDecorations(){this.decorations.pointerCursor||(this.decorations.pointerCursor=!0),this.decorations.underline||(this.decorations.underline=!0)}_disableDecorations(){this.decorations.pointerCursor&&(this.decorations.pointerCursor=!1),this.decorations.underline!==this._isHighConfidenceLink&&(this.decorations.underline=this._isHighConfidenceLink)}_isModifierDown(e){return this._configurationService.getValue("editor.multiCursorModifier")==="ctrlCmd"?!!e.altKey:k?e.metaKey:e.ctrlKey}};c=h([u(12,w)],c);export{c as TerminalLink};
