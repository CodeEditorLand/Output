var M=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var d=(s,i,e,t)=>{for(var o=t>1?void 0:t?_(i,e):i,l=s.length-1,m;l>=0;l--)(m=s[l])&&(o=(t?m(i,e,o):m(o))||o);return t&&o&&M(i,e,o),o},S=(s,i)=>(e,t)=>i(e,t,s);import{Event as y}from"../../../../../base/common/event.js";import"../../../../../base/browser/mouseEvent.js";import{MouseWheelClassifier as z}from"../../../../../base/browser/ui/scrollbar/scrollableElement.js";import{Disposable as D,MutableDisposable as W,toDisposable as Z}from"../../../../../base/common/lifecycle.js";import{isMacintosh as b}from"../../../../../base/common/platform.js";import{TerminalSettingId as r}from"../../../../../platform/terminal/common/terminal.js";import"../../../terminal/browser/terminal.js";import{registerTerminalContribution as x}from"../../../terminal/browser/terminalExtensions.js";import{IConfigurationService as c}from"../../../../../platform/configuration/common/configuration.js";import{registerTerminalAction as h}from"../../../terminal/browser/terminalActions.js";import{localize2 as p}from"../../../../../nls.js";import{isNumber as I}from"../../../../../base/common/types.js";import{defaultTerminalFontSize as V}from"../../../terminal/common/terminalConfiguration.js";import{TerminalZoomCommandId as g,TerminalZoomSettingId as C}from"../common/terminal.zoom.js";let a=class extends D{constructor(e,t){super();this._configurationService=t}static ID="terminal.mouseWheelZoom";static activeFindWidget;static get(e){return e.getContribution(a.ID)}_listener=this._register(new W);xtermOpen(e){this._register(y.runAndSubscribe(this._configurationService.onDidChangeConfiguration,t=>{(!t||t.affectsConfiguration(C.MouseWheelZoom))&&(this._configurationService.getValue(C.MouseWheelZoom)?this._setupMouseWheelZoomListener(e.raw):this._listener.clear())}))}_getConfigFontSize(){return this._configurationService.getValue(r.FontSize)}_setupMouseWheelZoomListener(e){const t=z.INSTANCE;let o=0,l=this._getConfigFontSize(),m=!1,u=0;e.attachCustomWheelEventHandler(v=>{const n=v;if(t.isPhysicalMouseWheel()){if(this._hasMouseWheelZoomModifiers(n)){const f=n.deltaY>0?-1:1;return this._configurationService.updateValue(r.FontSize,this._getConfigFontSize()+f),n.preventDefault(),n.stopPropagation(),!1}}else if(Date.now()-o>50&&(l=this._getConfigFontSize(),m=this._hasMouseWheelZoomModifiers(n),u=0),o=Date.now(),u+=n.deltaY,m){const f=Math.ceil(Math.abs(u/5)),T=u>0?-1:1,F=f*T;return this._configurationService.updateValue(r.FontSize,l+F),u+=n.deltaY,n.preventDefault(),n.stopPropagation(),!1}return!0}),this._listener.value=Z(()=>e.attachCustomWheelEventHandler(()=>!0))}_hasMouseWheelZoomModifiers(e){return b?(e.metaKey||e.ctrlKey)&&!e.shiftKey&&!e.altKey:e.ctrlKey&&!e.metaKey&&!e.shiftKey&&!e.altKey}};a=d([S(1,c)],a),x(a.ID,a,!0),h({id:g.FontZoomIn,title:p("fontZoomIn","Increase Font Size"),run:async(s,i)=>{const e=i.get(c),t=e.getValue(r.FontSize);I(t)&&await e.updateValue(r.FontSize,t+1)}}),h({id:g.FontZoomOut,title:p("fontZoomOut","Decrease Font Size"),run:async(s,i)=>{const e=i.get(c),t=e.getValue(r.FontSize);I(t)&&await e.updateValue(r.FontSize,t-1)}}),h({id:g.FontZoomReset,title:p("fontZoomReset","Reset Font Size"),run:async(s,i)=>{await i.get(c).updateValue(r.FontSize,V)}});
