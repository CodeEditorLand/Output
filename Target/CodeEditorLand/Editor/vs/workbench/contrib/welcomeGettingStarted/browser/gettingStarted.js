var ve=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var ee=(E,v,e,r)=>{for(var t=r>1?void 0:r?be(v,e):v,i=E.length-1,s;i>=0;i--)(s=E[i])&&(t=(r?s(v,e,t):s(t))||t);return r&&t&&ve(v,e,t),t},u=(E,v)=>(e,r)=>v(e,r,E);import{$ as n,addDisposableListener as R,append as te,clearNode as ie,reset as k}from"../../../../base/browser/dom.js";import{renderFormattedText as ye}from"../../../../base/browser/formattedTextRenderer.js";import{StandardKeyboardEvent as re}from"../../../../base/browser/keyboardEvent.js";import{Button as Ce}from"../../../../base/browser/ui/button/button.js";import{renderLabelWithIcons as F}from"../../../../base/browser/ui/iconLabel/iconLabels.js";import{DomScrollableElement as $}from"../../../../base/browser/ui/scrollbar/scrollableElement.js";import{Toggle as ke}from"../../../../base/browser/ui/toggle/toggle.js";import{coalesce as we,equals as se}from"../../../../base/common/arrays.js";import{Delayer as Ie,Throttler as oe}from"../../../../base/common/async.js";import"../../../../base/common/cancellation.js";import{Codicon as Ee}from"../../../../base/common/codicons.js";import{onUnexpectedError as xe}from"../../../../base/common/errors.js";import{KeyCode as q}from"../../../../base/common/keyCodes.js";import{splitRecentLabel as We}from"../../../../base/common/labels.js";import{DisposableStore as H,toDisposable as z}from"../../../../base/common/lifecycle.js";import"../../../../base/common/linkedText.js";import{parse as ne}from"../../../../base/common/marshalling.js";import{Schemas as O,matchesScheme as P}from"../../../../base/common/network.js";import{isMacintosh as De,OS as Le}from"../../../../base/common/platform.js";import{ThemeIcon as T}from"../../../../base/common/themables.js";import{assertIsDefined as M}from"../../../../base/common/types.js";import{URI as ae}from"../../../../base/common/uri.js";import{generateUuid as Te}from"../../../../base/common/uuid.js";import"./media/gettingStarted.css";import{ILanguageService as Me}from"../../../../editor/common/languages/language.js";import{MarkdownRenderer as Ae}from"../../../../editor/browser/widget/markdownRenderer/browser/markdownRenderer.js";import{localize as l}from"../../../../nls.js";import{IAccessibilityService as Re}from"../../../../platform/accessibility/common/accessibility.js";import{ICommandService as Oe}from"../../../../platform/commands/common/commands.js";import{ConfigurationTarget as Pe,IConfigurationService as Ne}from"../../../../platform/configuration/common/configuration.js";import{ContextKeyExpr as K,IContextKeyService as Ge,RawContextKey as ce}from"../../../../platform/contextkey/common/contextkey.js";import"../../../../platform/editor/common/editor.js";import{IFileService as Fe}from"../../../../platform/files/common/files.js";import{IInstantiationService as He}from"../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as Ke}from"../../../../platform/keybinding/common/keybinding.js";import{ILabelService as Ue,Verbosity as de}from"../../../../platform/label/common/label.js";import{INotificationService as qe}from"../../../../platform/notification/common/notification.js";import{Link as Be}from"../../../../platform/opener/browser/link.js";import{IOpenerService as _e}from"../../../../platform/opener/common/opener.js";import{IProductService as Ve}from"../../../../platform/product/common/productService.js";import{IQuickInputService as $e}from"../../../../platform/quickinput/common/quickInput.js";import{IStorageService as ze,StorageScope as N,StorageTarget as B,WillSaveStateReason as Je}from"../../../../platform/storage/common/storage.js";import{ITelemetryService as Ye,TelemetryLevel as Qe,firstSessionDateStorageKey as je}from"../../../../platform/telemetry/common/telemetry.js";import{getTelemetryLevel as Xe}from"../../../../platform/telemetry/common/telemetryUtils.js";import{defaultButtonStyles as Ze,defaultKeybindingLabelStyles as et,defaultToggleStyles as tt}from"../../../../platform/theme/browser/defaultStyles.js";import"../../../../platform/window/common/window.js";import{IWorkspaceContextService as it,UNKNOWN_EMPTY_WINDOW_WORKSPACE as le}from"../../../../platform/workspace/common/workspace.js";import{IWorkspacesService as rt,isRecentFolder as st,isRecentWorkspace as he}from"../../../../platform/workspaces/common/workspaces.js";import{OpenRecentAction as pe}from"../../../browser/actions/windowActions.js";import{OpenFileFolderAction as ot,OpenFolderAction as nt,OpenFolderViaWorkspaceAction as at}from"../../../browser/actions/workspaceActions.js";import{EditorPane as ct}from"../../../browser/parts/editor/editorPane.js";import{WorkbenchStateContext as dt}from"../../../common/contextkeys.js";import"../../../common/editor.js";import{IWebviewService as lt}from"../../webview/browser/webview.js";import"./gettingStartedColors.js";import{GettingStartedDetailsRenderer as ht}from"./gettingStartedDetailsRenderer.js";import{gettingStartedCheckedCodicon as J,gettingStartedUncheckedCodicon as Y}from"./gettingStartedIcons.js";import{GettingStartedInput as _}from"./gettingStartedInput.js";import{IWalkthroughsService as Q,hiddenEntriesConfigurationKey as ge,parseDescription as pt}from"./gettingStartedService.js";import{restoreWalkthroughsConfigurationKey as j}from"./startupPage.js";import{startEntries as ue}from"../common/gettingStartedContent.js";import{GroupDirection as gt,GroupsOrder as me,IEditorGroupsService as ut}from"../../../services/editor/common/editorGroupsService.js";import{IExtensionService as mt}from"../../../services/extensions/common/extensions.js";import{IHostService as St}from"../../../services/host/browser/host.js";import{IWorkbenchThemeService as ft}from"../../../services/themes/common/workbenchThemeService.js";import{GettingStartedIndexList as X}from"./gettingStartedList.js";import{AccessibilityVerbositySettingId as vt}from"../../accessibility/browser/accessibilityConfiguration.js";import{AccessibleViewAction as bt}from"../../accessibility/browser/accessibleViewActions.js";import{KeybindingLabel as yt}from"../../../../base/browser/ui/keybindingLabel/keybindingLabel.js";const Ct=250,Z="workbench.startupEditor",Se=new ce("allWalkthroughsHidden",!1),kt=new ce("inWelcome",!1),wt=ue.map((E,v)=>({command:E.content.command,description:E.description,icon:{type:"icon",icon:E.icon},id:E.id,order:v,title:E.title,when:K.deserialize(E.when)??K.true()})),fe="workbench.welcomePage.preferReducedMotion";let G=class extends ct{constructor(e,r,t,i,s,o,a,c,h,d,p,w,W,b,m,g,I,y,x,L,It,Et,xt,Wt){super(G.ID,e,a,p,w);this.commandService=r;this.productService=t;this.keybindingService=i;this.gettingStartedService=s;this.configurationService=o;this.languageService=c;this.fileService=h;this.openerService=d;this.themeService=p;this.storageService=w;this.extensionService=W;this.instantiationService=b;this.notificationService=m;this.groupsService=g;this.quickInputService=y;this.workspacesService=x;this.labelService=L;this.hostService=It;this.webviewService=Et;this.workspaceContextService=xt;this.accessibilityService=Wt;this.container=n(".gettingStartedContainer",{role:"document",tabindex:0,"aria-label":l("welcomeAriaLabel","Overview of how to get up to speed with your editor.")}),this.stepMediaComponent=n(".getting-started-media"),this.stepMediaComponent.id=Te(),this.categoriesSlideDisposables=this._register(new H),this.detailsRenderer=new ht(this.fileService,this.notificationService,this.extensionService,this.languageService),this.contextService=this._register(I.createScoped(this.container)),kt.bindTo(this.contextService).set(!0),this.gettingStartedCategories=this.gettingStartedService.getWalkthroughs(),this._register(this.dispatchListeners),this.buildSlideThrottle=new oe;const V=()=>{if(this.gettingStartedCategories=this.gettingStartedService.getWalkthroughs(),this.currentWalkthrough){const S=this.currentWalkthrough.steps.map(C=>C.id),f=this.gettingStartedCategories.find(C=>this.currentWalkthrough?.id===C.id);if(f){const C=f.steps.map(U=>U.id);se(C,S)||this.buildSlideThrottle.queue(()=>this.buildCategoriesSlide())}}else this.buildSlideThrottle.queue(()=>this.buildCategoriesSlide())};this._register(this.gettingStartedService.onDidAddWalkthrough(V)),this._register(this.gettingStartedService.onDidRemoveWalkthrough(V)),this.recentlyOpened=this.workspacesService.getRecentlyOpened(),this._register(x.onDidChangeRecentlyOpened(()=>{this.recentlyOpened=x.getRecentlyOpened(),V()})),this._register(this.gettingStartedService.onDidChangeWalkthrough(S=>{const f=this.gettingStartedCategories.find(C=>C.id===S.id);f&&(f.title=S.title,f.description=S.description,this.container.querySelectorAll(`[x-category-title-for="${S.id}"]`).forEach(C=>C.innerText=f.title),this.container.querySelectorAll(`[x-category-description-for="${S.id}"]`).forEach(C=>C.innerText=f.description))})),this._register(this.gettingStartedService.onDidProgressStep(S=>{const f=this.gettingStartedCategories.find(A=>A.id===S.category);if(!f)throw Error("Could not find category with ID: "+S.category);const C=f.steps.find(A=>A.id===S.id);if(!C)throw Error("Could not find step with ID: "+S.id);const U=this.getWalkthroughCompletionStats(f);!C.done&&U.stepsComplete===U.stepsTotal-1&&this.hideCategory(f.id),this._register(this.configurationService.onDidChangeConfiguration(A=>{A.affectsConfiguration(fe)&&this.container.classList.toggle("animatable",this.shouldAnimate())})),C.done=S.done,f.id===this.currentWalkthrough?.id&&M(this.window.document.querySelectorAll(`[data-done-step-id="${S.id}"]`)).forEach(D=>{S.done?(D.setAttribute("aria-checked","true"),D.parentElement?.setAttribute("aria-checked","true"),D.classList.remove(...T.asClassNameArray(Y)),D.classList.add("complete",...T.asClassNameArray(J))):(D.setAttribute("aria-checked","false"),D.parentElement?.setAttribute("aria-checked","false"),D.classList.remove("complete",...T.asClassNameArray(J)),D.classList.add(...T.asClassNameArray(Y)))}),this.updateCategoryProgress()})),this._register(this.storageService.onWillSaveState(S=>{if(S.reason!==Je.SHUTDOWN||this.workspaceContextService.getWorkspace().folders.length!==0||!this.editorInput||!this.currentWalkthrough||!this.editorInput.selectedCategory||!this.editorInput.selectedStep)return;const f={folder:le.id,category:this.editorInput.selectedCategory,step:this.editorInput.selectedStep};this.storageService.store(j,JSON.stringify(f),N.PROFILE,B.MACHINE)}))}static ID="gettingStartedPage";editorInput;inProgressScroll=Promise.resolve();dispatchListeners=new H;stepDisposables=new H;detailsPageDisposables=new H;mediaDisposables=new H;recentlyOpened;gettingStartedCategories;currentWalkthrough;prevWalkthrough;categoriesPageScrollbar;detailsPageScrollbar;detailsScrollbar;buildSlideThrottle=new oe;container;contextService;hasScrolledToFirstCategory=!1;recentlyOpenedList;startList;gettingStartedList;stepsSlide;categoriesSlide;stepsContent;stepMediaComponent;webview;layoutMarkdown;detailsRenderer;categoriesSlideDisposables;showFeaturedWalkthrough=!0;shouldAnimate(){return!(this.configurationService.getValue(fe)||this.accessibilityService.isMotionReduced())}getWalkthroughCompletionStats(e){const r=e.steps.filter(t=>this.contextService.contextMatchesRules(t.when));return{stepsComplete:r.filter(t=>t.done).length,stepsTotal:r.length}}async setInput(e,r,t,i){this.container.classList.remove("animatable"),this.editorInput=e,await super.setInput(e,r,t,i),await this.buildCategoriesSlide(),this.shouldAnimate()&&setTimeout(()=>this.container.classList.add("animatable"),0)}async makeCategoryVisibleWhenAvailable(e,r){this.scrollToCategory(e,r)}registerDispatchListeners(){this.dispatchListeners.clear(),this.container.querySelectorAll("[x-dispatch]").forEach(e=>{const r=e.getAttribute("x-dispatch")??"";let t,i;r.startsWith("openLink:https")?[t,i]=["openLink",r.replace("openLink:","")]:[t,i]=r.split(":"),t&&(this.dispatchListeners.add(R(e,"click",s=>{s.stopPropagation(),this.runDispatchCommand(t,i)})),this.dispatchListeners.add(R(e,"keyup",s=>{const o=new re(s);switch(s.stopPropagation(),o.keyCode){case q.Enter:case q.Space:this.runDispatchCommand(t,i);return}})))})}async runDispatchCommand(e,r){switch(this.commandService.executeCommand("workbench.action.keepEditor"),this.telemetryService.publicLog2("gettingStarted.ActionExecuted",{command:e,argument:r,walkthroughId:this.currentWalkthrough?.id}),e){case"scrollPrev":{this.scrollPrev();break}case"skip":{this.runSkip();break}case"showMoreRecents":{this.commandService.executeCommand(pe.ID);break}case"seeAllWalkthroughs":{await this.openWalkthroughSelector();break}case"openFolder":{this.contextService.contextMatchesRules(K.and(dt.isEqualTo("workspace")))?this.commandService.executeCommand(at.ID):this.commandService.executeCommand(De?"workbench.action.files.openFileFolder":"workbench.action.files.openFolder");break}case"selectCategory":{this.scrollToCategory(r),this.gettingStartedService.markWalkthroughOpened(r);break}case"selectStartEntry":{const t=ue.find(i=>i.id===r);if(t)this.runStepCommand(t.content.command);else throw Error("could not find start entry with id: "+r);break}case"hideCategory":{this.hideCategory(r);break}case"selectTask":{this.selectStep(r);break}case"toggleStepCompletion":{this.toggleStepCompletion(r);break}case"allDone":{this.markAllStepsComplete();break}case"nextSection":{const t=this.currentWalkthrough?.next;t&&(this.prevWalkthrough=this.currentWalkthrough,this.scrollToCategory(t));break}case"openLink":{this.openerService.open(r);break}default:break}}hideCategory(e){if(!this.gettingStartedCategories.find(t=>t.id===e))throw Error("Could not find category with ID "+e);this.setHiddenCategories([...this.getHiddenCategories().add(e)]),this.gettingStartedList?.rerender()}markAllStepsComplete(){if(this.currentWalkthrough)this.currentWalkthrough?.steps.forEach(e=>{e.done||this.gettingStartedService.progressStep(e.id)}),this.hideCategory(this.currentWalkthrough?.id),this.scrollPrev();else throw Error("No walkthrough opened")}toggleStepCompletion(e){M(this.currentWalkthrough?.steps.find(t=>t.id===e)).done?this.gettingStartedService.deprogressStep(e):this.gettingStartedService.progressStep(e)}async openWalkthroughSelector(){const e=await this.quickInputService.pick(this.gettingStartedCategories.filter(r=>this.contextService.contextMatchesRules(r.when)).map(r=>({id:r.id,label:r.title,detail:r.description,description:r.source})),{canPickMany:!1,matchOnDescription:!0,matchOnDetail:!0,title:l("pickWalkthroughs","Open Walkthrough...")});e&&this.runDispatchCommand("selectCategory",e.id)}getHiddenCategories(){return new Set(JSON.parse(this.storageService.get(ge,N.PROFILE,"[]")))}setHiddenCategories(e){this.storageService.store(ge,JSON.stringify(e),N.PROFILE,B.USER)}currentMediaComponent=void 0;currentMediaType=void 0;async buildMediaComponent(e,r=!1){if(!this.currentWalkthrough)throw Error("no walkthrough selected");const t=M(this.currentWalkthrough.steps.find(i=>i.id===e));if(!(!r&&this.currentMediaComponent===e)){if(this.currentMediaComponent=e,this.stepDisposables.clear(),this.stepDisposables.add({dispose:()=>{this.currentMediaComponent=void 0}}),this.currentMediaType!==t.media.type&&(this.currentMediaType=t.media.type,this.mediaDisposables.add(z(()=>{this.currentMediaType=void 0})),ie(this.stepMediaComponent),t.media.type==="svg"?(this.webview=this.mediaDisposables.add(this.webviewService.createWebviewElement({title:void 0,options:{disableServiceWorker:!0},contentOptions:{},extension:void 0})),this.webview.mountTo(this.stepMediaComponent,this.window)):t.media.type==="markdown"&&(this.webview=this.mediaDisposables.add(this.webviewService.createWebviewElement({options:{},contentOptions:{localResourceRoots:[t.media.root],allowScripts:!0},title:"",extension:void 0})),this.webview.mountTo(this.stepMediaComponent,this.window))),t.media.type==="image"){this.stepsContent.classList.add("image"),this.stepsContent.classList.remove("markdown");const i=t.media,s=n("img");ie(this.stepMediaComponent),this.stepMediaComponent.appendChild(s),s.setAttribute("alt",i.altText),this.updateMediaSourceForColorMode(s,i.path),this.stepDisposables.add(R(this.stepMediaComponent,"click",()=>{const o=t.description.map(a=>a.nodes.filter(c=>typeof c!="string").map(c=>c.href)).flat();if(o.length===1){const a=o[0];a.startsWith("http")&&(this.telemetryService.publicLog2("gettingStarted.ActionExecuted",{command:"runStepAction",argument:a,walkthroughId:this.currentWalkthrough?.id}),this.openerService.open(a))}})),this.stepDisposables.add(this.themeService.onDidColorThemeChange(()=>this.updateMediaSourceForColorMode(s,i.path)))}else if(t.media.type==="svg"){this.stepsContent.classList.add("image"),this.stepsContent.classList.remove("markdown");const i=t.media;this.webview.setHtml(await this.detailsRenderer.renderSVG(i.path));let s=!1;this.stepDisposables.add(z(()=>{s=!0})),this.stepDisposables.add(this.themeService.onDidColorThemeChange(async()=>{const o=await this.detailsRenderer.renderSVG(i.path);s||this.webview.setHtml(o)})),this.stepDisposables.add(R(this.stepMediaComponent,"click",()=>{const o=t.description.map(a=>a.nodes.filter(c=>typeof c!="string").map(c=>c.href)).flat();if(o.length===1){const a=o[0];a.startsWith("http")&&(this.telemetryService.publicLog2("gettingStarted.ActionExecuted",{command:"runStepAction",argument:a,walkthroughId:this.currentWalkthrough?.id}),this.openerService.open(a))}})),this.stepDisposables.add(this.webview.onDidClickLink(o=>{(P(o,O.https)||P(o,O.http)||P(o,O.command))&&this.openerService.open(o,{allowCommands:!0})}))}else if(t.media.type==="markdown"){this.stepsContent.classList.remove("image"),this.stepsContent.classList.add("markdown");const i=t.media,s=await this.detailsRenderer.renderMarkdown(i.path,i.base);this.webview.setHtml(s);const o=s.match(/checked-on=\"([^'][^"]*)\"/g)?.map(d=>d.slice(12,-1).replace(/&#39;/g,"'").replace(/&amp;/g,"&")),a=()=>{const d=o?.filter(p=>this.contextService.contextMatchesRules(K.deserialize(p)));d&&this.webview.postMessage({enabledContextKeys:d})};if(o){const d=we(o.map(w=>K.deserialize(w))),p=new Set(d.flatMap(w=>w.keys()));this.stepDisposables.add(this.contextService.onDidChangeContext(w=>{w.affectsSome(p)&&a()}))}let c=!1;this.stepDisposables.add(z(()=>{c=!0})),this.stepDisposables.add(this.webview.onDidClickLink(d=>{if(P(d,O.https)||P(d,O.http)||P(d,O.command)){const p=d.startsWith("command:toSide:");p&&(d=d.replace("command:toSide:","command:"),this.focusSideEditorGroup()),this.openerService.open(d,{allowCommands:!0,openToSide:p})}})),s.indexOf("<code>")>=0&&this.stepDisposables.add(this.themeService.onDidColorThemeChange(async()=>{const d=await this.detailsRenderer.renderMarkdown(i.path,i.base);c||(this.webview.setHtml(d),a())}));const h=new Ie(50);this.layoutMarkdown=()=>{h.trigger(()=>{this.webview.postMessage({layoutMeNow:!0})})},this.stepDisposables.add(h),this.stepDisposables.add({dispose:()=>this.layoutMarkdown=void 0}),a(),this.stepDisposables.add(this.webview.onMessage(async d=>{const p=d.message;if(p.startsWith("command:"))this.openerService.open(p,{allowCommands:!0});else if(p.startsWith("setTheme:")){const w=p.slice(9),W=(await this.themeService.getColorThemes()).find(b=>b.settingsId===w);W&&this.themeService.setColorTheme(W.id,Pe.USER)}}))}}}async selectStepLoose(e){if(e.startsWith(`${this.editorInput.selectedCategory}#`))this.selectStep(e);else{const r=this.editorInput.selectedCategory+"#"+e;this.selectStep(r)}}provideScreenReaderUpdate(){if(this.configurationService.getValue(vt.Walkthrough)){const e=this.keybindingService.lookupKeybinding(bt.id)?.getAriaLabel();return e?l("acessibleViewHint",`Inspect this in the accessible view ({0}).
`,e):l("acessibleViewHintNoKbOpen",`Inspect this in the accessible view via the command Open Accessible View which is currently not triggerable via keybinding.
`)}return""}async selectStep(e,r=!0){if(e){let t=this.container.querySelector(`[data-step-id="${e}"]`);if(!t){if(t=this.container.querySelector("[data-step-id]"),!t)return;e=M(t.getAttribute("data-step-id"))}t.parentElement?.querySelectorAll(".expanded").forEach(s=>{s.getAttribute("data-step-id")!==e&&(s.classList.remove("expanded"),s.setAttribute("aria-expanded","false"))}),setTimeout(()=>t.focus(),r&&this.shouldAnimate()?Ct:0),this.editorInput.selectedStep=e,t.classList.add("expanded"),t.setAttribute("aria-expanded","true"),this.buildMediaComponent(e,!0),this.gettingStartedService.progressByEvent("stepSelected:"+e);const i=this.currentWalkthrough?.steps?.find(s=>s.id===e);i&&t.setAttribute("aria-label",`${this.provideScreenReaderUpdate()} ${i.title}`)}else this.editorInput.selectedStep=void 0;this.detailsPageScrollbar?.scanDomNode(),this.detailsScrollbar?.scanDomNode()}updateMediaSourceForColorMode(e,r){const t=this.themeService.getColorTheme().type,i=r[t].toString(!0).replace(/ /g,"%20");e.srcset=i.toLowerCase().endsWith(".svg")?i:i+" 1.5x"}createEditor(e){this.detailsPageScrollbar&&this.detailsPageScrollbar.dispose(),this.categoriesPageScrollbar&&this.categoriesPageScrollbar.dispose(),this.categoriesSlide=n(".gettingStartedSlideCategories.gettingStartedSlide");const r=n("button.prev-button.button-link",{"x-dispatch":"scrollPrev"},n("span.scroll-button.codicon.codicon-chevron-left"),n("span.moreText",{},l("goBack","Go Back")));this.stepsSlide=n(".gettingStartedSlideDetails.gettingStartedSlide",{},r),this.stepsContent=n(".gettingStartedDetailsContent",{}),this.detailsPageScrollbar=this._register(new $(this.stepsContent,{className:"full-height-scrollable"})),this.categoriesPageScrollbar=this._register(new $(this.categoriesSlide,{className:"full-height-scrollable categoriesScrollbar"})),this.stepsSlide.appendChild(this.detailsPageScrollbar.getDomNode());const t=n(".gettingStarted",{},this.categoriesPageScrollbar.getDomNode(),this.stepsSlide);this.container.appendChild(t),this.categoriesPageScrollbar.scanDomNode(),this.detailsPageScrollbar.scanDomNode(),e.appendChild(this.container)}async buildCategoriesSlide(){this.categoriesSlideDisposables.clear();const e=new ke({icon:Ee.check,actionClassName:"getting-started-checkbox",isChecked:this.configurationService.getValue(Z)==="welcomePage",title:l("checkboxTitle","When checked, this page will be shown on startup."),...tt});e.domNode.id="showOnStartup";const r=n("label.caption",{for:"showOnStartup"},l("welcomePage.showOnStartup","Show welcome page on startup")),t=()=>{e.checked?(this.telemetryService.publicLog2("gettingStarted.ActionExecuted",{command:"showOnStartupChecked",argument:void 0,walkthroughId:this.currentWalkthrough?.id}),this.configurationService.updateValue(Z,"welcomePage")):(this.telemetryService.publicLog2("gettingStarted.ActionExecuted",{command:"showOnStartupUnchecked",argument:void 0,walkthroughId:this.currentWalkthrough?.id}),this.configurationService.updateValue(Z,"none"))};this.categoriesSlideDisposables.add(e),this.categoriesSlideDisposables.add(e.onChange(()=>{t()})),this.categoriesSlideDisposables.add(R(r,"click",()=>{e.checked=!e.checked,t()}));const i=n(".header",{},n("h1.product-name.caption",{},this.productService.nameLong),n("p.subtitle.description",{},l({key:"gettingStarted.editingEvolved",comment:["Shown as subtitle on the Welcome page."]},"Editing evolved"))),s=n(".categories-column.categories-column-left",{}),o=n(".categories-column.categories-column-right",{}),a=this.buildStartList(),c=this.buildRecentlyOpenedList(),h=this.buildGettingStartedWalkthroughsList(),d=n(".footer",{},n("p.showOnStartup",{},e.domNode,r)),p=()=>{h.itemCount?(this.container.classList.remove("noWalkthroughs"),k(o,h.getDomElement())):(this.container.classList.add("noWalkthroughs"),k(o)),setTimeout(()=>this.categoriesPageScrollbar?.scanDomNode(),50),w()},w=()=>{this.container.classList.contains("noWalkthroughs")?(c.setLimit(10),k(s,a.getDomElement()),k(o,c.getDomElement())):(c.setLimit(5),k(s,a.getDomElement(),c.getDomElement()))};if(h.onDidChange(p),p(),k(this.categoriesSlide,n(".gettingStartedCategoriesContainer",{},i,s,o,d)),this.categoriesPageScrollbar?.scanDomNode(),this.updateCategoryProgress(),this.registerDispatchListeners(),this.editorInput.selectedCategory){if(this.currentWalkthrough=this.gettingStartedCategories.find(b=>b.id===this.editorInput.selectedCategory),this.currentWalkthrough){this.buildCategorySlide(this.editorInput.selectedCategory,this.editorInput.selectedStep),this.setSlide("details");return}else if(this.gettingStartedCategories=this.gettingStartedService.getWalkthroughs(),this.currentWalkthrough=this.gettingStartedCategories.find(b=>b.id===this.editorInput.selectedCategory),this.currentWalkthrough){this.buildCategorySlide(this.editorInput.selectedCategory,this.editorInput.selectedStep),this.setSlide("details");return}}const W=this.gettingStartedCategories.some(b=>b.steps.find(m=>m.done));if(this.editorInput.showTelemetryNotice&&this.productService.openToWelcomeMainPage){const b=n("p.telemetry-notice");this.buildTelemetryFooter(b),d.appendChild(b)}else if(!this.productService.openToWelcomeMainPage&&!W&&!this.hasScrolledToFirstCategory&&this.showFeaturedWalkthrough){const b=this.storageService.get(je,N.APPLICATION)||new Date().toUTCString();if(((+new Date-+new Date(b))/1e3/60/60/24<1?"openToFirstCategory":"index")==="openToFirstCategory"){const I=this.gettingStartedCategories.filter(y=>!y.when||this.contextService.contextMatchesRules(y.when))[0];if(I){this.hasScrolledToFirstCategory=!0,this.currentWalkthrough=I,this.editorInput.selectedCategory=this.currentWalkthrough?.id,this.buildCategorySlide(this.editorInput.selectedCategory,void 0),this.setSlide("details",!0);return}}}this.setSlide("categories")}buildRecentlyOpenedList(){const e=t=>{let i,s;st(t)?(s={folderUri:t.folderUri},i=t.label||this.labelService.getWorkspaceLabel(t.folderUri,{verbose:de.LONG})):(i=t.label||this.labelService.getWorkspaceLabel(t.workspace,{verbose:de.LONG}),s={workspaceUri:t.workspace.configPath});const{name:o,parentPath:a}=We(i),c=n("li"),h=n("button.button-link");h.innerText=o,h.title=i,h.setAttribute("aria-label",l("welcomePage.openFolderWithPath","Open folder {0} with path {1}",o,a)),h.addEventListener("click",p=>{this.telemetryService.publicLog2("gettingStarted.ActionExecuted",{command:"openRecent",argument:void 0,walkthroughId:this.currentWalkthrough?.id}),this.hostService.openWindow([s],{forceNewWindow:p.ctrlKey||p.metaKey,remoteAuthority:t.remoteAuthority||null}),p.preventDefault(),p.stopPropagation()}),c.appendChild(h);const d=n("span");return d.classList.add("path"),d.classList.add("detail"),d.innerText=a,d.title=i,c.appendChild(d),c};this.recentlyOpenedList&&this.recentlyOpenedList.dispose();const r=this.recentlyOpenedList=new X({title:l("recent","Recent"),klass:"recently-opened",limit:5,empty:n(".empty-recent",{},l("noRecents","You have no recent folders,"),n("button.button-link",{"x-dispatch":"openFolder"},l("openFolder","open a folder")),l("toStart","to start.")),more:n(".more",{},n("button.button-link",{"x-dispatch":"showMoreRecents",title:l("show more recents","Show All Recent Folders {0}",this.getKeybindingLabel(pe.ID))},l("showAll","More..."))),renderElement:e,contextService:this.contextService});return r.onDidChange(()=>this.registerDispatchListeners()),this.recentlyOpened.then(({workspaces:t})=>{const i=t.filter(o=>!this.workspaceContextService.isCurrentWorkspace(he(o)?o.workspace:o.folderUri)).map(o=>({...o,id:he(o)?o.workspace.id:o.folderUri.toString()})),s=()=>{r.setEntries(i)};s(),r.register(this.labelService.onDidChangeFormatters(()=>s()))}).catch(xe),r}buildStartList(){const e=t=>n("li",{},n("button.button-link",{"x-dispatch":"selectStartEntry:"+t.id,title:t.description+" "+this.getKeybindingLabel(t.command)},this.iconWidgetFor(t),n("span",{},t.title)));this.startList&&this.startList.dispose();const r=this.startList=new X({title:l("start","Start"),klass:"start-container",limit:10,renderElement:e,rankElement:t=>-t.order,contextService:this.contextService});return r.setEntries(wt),r.onDidChange(()=>this.registerDispatchListeners()),r}buildGettingStartedWalkthroughsList(){const e=i=>{const s=(i.newItems||i.newEntry)&&!i.isFeatured,o=n(".new-badge",{});i.newEntry?k(o,n(".new-category",{},l("new","New"))):i.newItems&&k(o,n(".new-items",{},l({key:"newItems",comment:["Shown when a list of items has changed based on an update from a remote source"]},"Updated")));const a=n(".featured-badge",{}),c=n(".description-content",{});i.isFeatured&&this.showFeaturedWalkthrough&&(k(a,n(".featured",{},n("span.featured-icon.codicon.codicon-star-full"))),k(c,...F(i.description)));const h=n("h3.category-title.max-lines-3",{"x-category-title-for":i.id});return k(h,...F(i.title)),n("button.getting-started-category"+(i.isFeatured&&this.showFeaturedWalkthrough?".featured":""),{"x-dispatch":"selectCategory:"+i.id,title:i.description},a,n(".main-content",{},this.iconWidgetFor(i),h,s?o:n(".no-badge"),n("a.codicon.codicon-close.hide-category-button",{tabindex:0,"x-dispatch":"hideCategory:"+i.id,title:l("close","Hide"),role:"button","aria-label":l("closeAriaLabel","Hide")})),c,n(".category-progress",{"x-data-category-id":i.id},n(".progress-bar-outer",{role:"progressbar"},n(".progress-bar-inner"))))};this.gettingStartedList&&this.gettingStartedList.dispose();const r=i=>{let s=i.order;return i.isFeatured&&(s+=7),i.newEntry&&(s+=3),i.newItems&&(s+=2),i.recencyBonus&&(s+=4*i.recencyBonus),this.getHiddenCategories().has(i.id)&&(s=null),s},t=this.gettingStartedList=new X({title:l("walkthroughs","Walkthroughs"),klass:"getting-started",limit:5,footer:n("span.button-link.see-all-walkthroughs",{"x-dispatch":"seeAllWalkthroughs",tabindex:0},l("showAll","More...")),renderElement:e,rankElement:r,contextService:this.contextService});return t.onDidChange(()=>{const s=this.getHiddenCategories().size||t.itemCount<this.gettingStartedCategories.filter(o=>this.contextService.contextMatchesRules(o.when)).length;this.container.classList.toggle("someWalkthroughsHidden",!!s),this.registerDispatchListeners(),Se.bindTo(this.contextService).set(t.itemCount===0),this.updateCategoryProgress()}),t.setEntries(this.gettingStartedCategories),Se.bindTo(this.contextService).set(t.itemCount===0),t}layout(e){this.detailsScrollbar?.scanDomNode(),this.categoriesPageScrollbar?.scanDomNode(),this.detailsPageScrollbar?.scanDomNode(),this.startList?.layout(e),this.gettingStartedList?.layout(e),this.recentlyOpenedList?.layout(e),this.editorInput?.selectedStep&&this.currentMediaType&&(this.mediaDisposables.clear(),this.stepDisposables.clear(),this.buildMediaComponent(this.editorInput.selectedStep)),this.layoutMarkdown?.(),this.container.classList.toggle("height-constrained",e.height<=600),this.container.classList.toggle("width-constrained",e.width<=400),this.container.classList.toggle("width-semi-constrained",e.width<=800),this.categoriesPageScrollbar?.scanDomNode(),this.detailsPageScrollbar?.scanDomNode(),this.detailsScrollbar?.scanDomNode()}updateCategoryProgress(){this.window.document.querySelectorAll(".category-progress").forEach(e=>{const r=e.getAttribute("x-data-category-id"),t=this.gettingStartedCategories.find(a=>a.id===r);if(!t)throw Error("Could not find category with ID "+r);const i=this.getWalkthroughCompletionStats(t),s=M(e.querySelector(".progress-bar-inner"));s.setAttribute("aria-valuemin","0"),s.setAttribute("aria-valuenow",""+i.stepsComplete),s.setAttribute("aria-valuemax",""+i.stepsTotal);const o=i.stepsComplete/i.stepsTotal*100;s.style.width=`${o}%`,e.parentElement.classList.toggle("no-progress",i.stepsComplete===0),i.stepsTotal===i.stepsComplete?s.title=l("gettingStarted.allStepsComplete","All {0} steps complete!",i.stepsComplete):s.title=l("gettingStarted.someStepsComplete","{0} of {1} steps complete",i.stepsComplete,i.stepsTotal)})}async scrollToCategory(e,r){this.gettingStartedCategories.some(i=>i.id===e)||(this.gettingStartedCategories=this.gettingStartedService.getWalkthroughs());const t=this.gettingStartedCategories.find(i=>i.id===e);if(!t)throw Error("Could not find category with ID: "+e);this.inProgressScroll=this.inProgressScroll.then(async()=>{k(this.stepsContent),this.editorInput.selectedCategory=e,this.editorInput.selectedStep=r,this.currentWalkthrough=t,this.buildCategorySlide(e,r),this.setSlide("details")})}iconWidgetFor(e){const r=e.icon.type==="icon"?n(T.asCSSSelector(e.icon.icon)):n("img.category-icon",{src:e.icon.path});return r.classList.add("icon-widget"),r}focusSideEditorGroup(){const e=this.groupsService.getPart(this.group).contentDimension;if(!e||e.width<=700)return;if(this.groupsService.count===1){const t=this.groupsService.addGroup(this.groupsService.groups[0],gt.RIGHT);this.groupsService.activateGroup(t);const i=Math.floor(e.width/2),s=this.groupsService.getGroups(me.MOST_RECENTLY_ACTIVE).find(o=>o.activeEditor instanceof _);this.groupsService.setSize(M(s),{width:i,height:e.height})}const r=this.groupsService.getGroups(me.MOST_RECENTLY_ACTIVE).find(t=>!(t.activeEditor instanceof _));r&&(this.groupsService.activateGroup(r),r.focus())}runStepCommand(e){const r=e.startsWith("command:"),t=e.startsWith("command:toSide:"),i=e.replace(/command:(toSide:)?/,"command:");if(this.telemetryService.publicLog2("gettingStarted.ActionExecuted",{command:"runStepAction",argument:e,walkthroughId:this.currentWalkthrough?.id}),t&&this.focusSideEditorGroup(),r){const s=ae.parse(i);let o=[];try{o=ne(decodeURIComponent(s.query))}catch{try{o=ne(s.query)}catch{}}if(Array.isArray(o)||(o=[o]),(s.path===ot.ID.toString()||s.path===nt.ID.toString())&&this.workspaceContextService.getWorkspace().folders.length===0){const a=this.currentWalkthrough?.steps.findIndex(c=>c.id===this.editorInput.selectedStep);if(a!==void 0&&a>-1&&this.currentWalkthrough?.steps.slice(a+1).some(c=>!c.done)){const c={folder:le.id,category:this.editorInput.selectedCategory,step:this.editorInput.selectedStep};this.storageService.store(j,JSON.stringify(c),N.PROFILE,B.MACHINE)}}this.commandService.executeCommand(s.path,...o).then(a=>{const c=a?.openFolder;if(c){if(!ae.isUri(c))return;const h={folder:c.toString(),category:this.editorInput.selectedCategory,step:this.editorInput.selectedStep};this.storageService.store(j,JSON.stringify(h),N.PROFILE,B.MACHINE),this.hostService.openWindow([{folderUri:c}])}})}else this.openerService.open(i,{allowCommands:!0});!r&&(e.startsWith("https://")||e.startsWith("http://"))&&this.gettingStartedService.progressByEvent("onLink:"+e)}buildMarkdownDescription(e,r){for(;e.firstChild;)e.firstChild.remove();for(const t of r)if(t.nodes.length===1&&typeof t.nodes[0]!="string"){const i=t.nodes[0],s=te(e,n(".button-container")),o=new Ce(s,{title:i.title,supportIcons:!0,...Ze}),a=i.href.startsWith("command:"),c=i.href.replace(/command:(toSide:)?/,"command:");if(o.label=i.label,o.onDidClick(h=>{h.stopPropagation(),h.preventDefault(),this.runStepCommand(i.href)},null,this.detailsPageDisposables),a){const h=this.getKeyBinding(c);if(h){const d=n("span.shortcut-message",{},l("gettingStarted.keyboardTip","Tip: Use keyboard shortcut "));e.appendChild(d),new yt(d,Le,{...et}).set(h)}}this.detailsPageDisposables.add(o)}else{const i=te(e,n("p"));for(const s of t.nodes)if(typeof s=="string"){const o=F(s);for(const a of o)typeof a=="string"?i.appendChild(ye(a,{inline:!0,renderCodeSegments:!0})):i.appendChild(a)}else{const o=this.instantiationService.createInstance(Be,i,s,{opener:a=>this.runStepCommand(a)});this.detailsPageDisposables.add(o)}}return e}clearInput(){this.stepDisposables.clear(),super.clearInput()}buildCategorySlide(e,r){this.detailsScrollbar&&this.detailsScrollbar.dispose(),this.extensionService.whenInstalledExtensionsRegistered().then(()=>{this.extensionService.activateByEvent(`onWalkthrough:${e.replace(/[^#]+#/,"")}`)}),this.detailsPageDisposables.clear(),this.mediaDisposables.clear();const t=this.gettingStartedCategories.find(m=>m.id===e);if(!t)throw Error("could not find category with ID "+e);const i=n(".category-description.description.max-lines-3",{"x-category-description-for":t.id});this.buildMarkdownDescription(i,pt(t.description));const s=n(".getting-started-category",{},n(".category-description-container",{},n("h2.category-title.max-lines-3",{"x-category-title-for":t.id},...F(t.title)),i)),o=n(".step-list-container");this.detailsPageDisposables.add(R(o,"keydown",m=>{const g=new re(m),I=()=>t.steps.findIndex(y=>y.id===this.editorInput.selectedStep);if(g.keyCode===q.UpArrow){const y=t.steps.filter((x,L)=>L<I()&&this.contextService.contextMatchesRules(x.when));y.length&&this.selectStep(y[y.length-1].id,!1)}if(g.keyCode===q.DownArrow){const y=t.steps.find((x,L)=>L>I()&&this.contextService.contextMatchesRules(x.when));y&&this.selectStep(y.id,!1)}}));let a;const c=new Set(t.steps.flatMap(m=>m.when.keys())),h=()=>{t.steps.sort((g,I)=>g.order-I.order);const m=t.steps.filter(g=>this.contextService.contextMatchesRules(g.when));se(a,m,(g,I)=>g.id===I.id)||(a=m,k(o,...a.map(g=>{const I=n(".codicon"+(g.done?".complete"+T.asCSSSelector(J):T.asCSSSelector(Y)),{"data-done-step-id":g.id,"x-dispatch":"toggleStepCompletion:"+g.id,role:"checkbox",tabindex:"0","aria-checked":g.done?"true":"false"}),y=n(".step-description-container",{"x-step-description-for":g.id});this.buildMarkdownDescription(y,g.description);const x=n("h3.step-title.max-lines-3",{"x-step-title-for":g.id});k(x,...F(g.title));const L=n(".step-container",{},x,y);return g.media.type==="image"&&L.appendChild(n(".image-description",{"aria-label":l("imageShowing","Image showing {0}",g.media.altText)})),n("button.getting-started-step",{"x-dispatch":"selectTask:"+g.id,"data-step-id":g.id,"aria-expanded":"false","aria-checked":g.done?"true":"false",role:"button"},I,L)})))};h(),this.detailsPageDisposables.add(this.contextService.onDidChangeContext(m=>{m.affectsSome(c)&&(h(),this.registerDispatchListeners(),this.selectStep(this.editorInput.selectedStep,!1))}));const d=this.gettingStartedCategories.find(m=>m.id===t.next),p=n(".getting-started-detail-container",{role:"list"},o,n(".done-next-container",{},n("button.button-link.all-done",{"x-dispatch":"allDone"},n("span.codicon.codicon-check-all"),l("allDone","Mark Done")),...d?[n("button.button-link.next",{"x-dispatch":"nextSection"},l("nextOne","Next Section"),n("span.codicon.codicon-arrow-right"))]:[]));this.detailsScrollbar=this._register(new $(p,{className:"steps-container"}));const w=this.detailsScrollbar.getDomNode(),W=n(".getting-started-footer");this.editorInput.showTelemetryNotice&&Xe(this.configurationService)!==Qe.NONE&&this.productService.enableTelemetry&&this.buildTelemetryFooter(W),k(this.stepsContent,s,w,this.stepMediaComponent,W);const b=t.steps.find(m=>this.contextService.contextMatchesRules(m.when)&&!m.done)??t.steps[0];this.selectStep(r??b.id,!r),this.detailsScrollbar.scanDomNode(),this.detailsPageScrollbar?.scanDomNode(),this.registerDispatchListeners()}buildTelemetryFooter(e){const r=this.instantiationService.createInstance(Ae,{}),i=`[${l("privacy statement","privacy statement")}](command:workbench.action.openPrivacyStatementUrl)`,o=`[${l("optOut","opt out")}](command:settings.filterByTelemetry)`,a=l({key:"footer",comment:['fist substitution is "vs code", second is "privacy statement", third is "opt out".']},"{0} collects usage data. Read our {1} and learn how to {2}.",this.productService.nameShort,i,o);e.append(r.render({value:a,isTrusted:!0}).element),r.dispose()}getKeybindingLabel(e){e=e.replace(/^command:/,"");const r=this.keybindingService.lookupKeybinding(e)?.getLabel();return r?`(${r})`:""}getKeyBinding(e){return e=e.replace(/^command:/,""),this.keybindingService.lookupKeybinding(e)}async scrollPrev(){this.inProgressScroll=this.inProgressScroll.then(async()=>{this.prevWalkthrough&&this.prevWalkthrough!==this.currentWalkthrough?(this.currentWalkthrough=this.prevWalkthrough,this.prevWalkthrough=void 0,this.makeCategoryVisibleWhenAvailable(this.currentWalkthrough.id)):(this.currentWalkthrough=void 0,this.editorInput.selectedCategory=void 0,this.editorInput.selectedStep=void 0,this.editorInput.showTelemetryNotice=!1,this.gettingStartedCategories.length!==this.gettingStartedList?.itemCount&&this.buildCategoriesSlide(),this.selectStep(void 0),this.setSlide("categories"),this.container.focus())})}runSkip(){this.commandService.executeCommand("workbench.action.closeActiveEditor")}escape(){this.editorInput.selectedCategory?this.scrollPrev():this.runSkip()}setSlide(e,r=!1){const t=M(this.container.querySelector(".gettingStarted"));if(e==="categories")t.classList.remove("showDetails"),t.classList.add("showCategories"),this.container.querySelector(".prev-button.button-link").style.display="none",this.container.querySelector(".gettingStartedSlideDetails").querySelectorAll("button").forEach(i=>i.disabled=!0),this.container.querySelector(".gettingStartedSlideCategories").querySelectorAll("button").forEach(i=>i.disabled=!1),this.container.querySelector(".gettingStartedSlideCategories").querySelectorAll("input").forEach(i=>i.disabled=!1);else{t.classList.add("showDetails"),t.classList.remove("showCategories");const i=this.container.querySelector(".prev-button.button-link");i.style.display=this.editorInput.showWelcome||this.prevWalkthrough?"block":"none";const s=i.querySelector(".moreText");s.textContent=r?l("welcome","Welcome"):l("goBack","Go Back"),this.container.querySelector(".gettingStartedSlideDetails").querySelectorAll("button").forEach(o=>o.disabled=!1),this.container.querySelector(".gettingStartedSlideCategories").querySelectorAll("button").forEach(o=>o.disabled=!0),this.container.querySelector(".gettingStartedSlideCategories").querySelectorAll("input").forEach(o=>o.disabled=!0)}}focus(){super.focus();const e=this.container.ownerDocument.activeElement;let r=this.container.parentElement;for(;r&&r!==e;)r=r.parentElement;r&&this.container.focus()}};G=ee([u(1,Oe),u(2,Ve),u(3,Ke),u(4,Q),u(5,Ne),u(6,Ye),u(7,Me),u(8,Fe),u(9,_e),u(10,ft),u(11,ze),u(12,mt),u(13,He),u(14,qe),u(15,ut),u(16,Ge),u(17,$e),u(18,rt),u(19,Ue),u(20,St),u(21,lt),u(22,it),u(23,Re)],G);class ar{canSerialize(v){return!0}serialize(v){return JSON.stringify({selectedCategory:v.selectedCategory,selectedStep:v.selectedStep})}deserialize(v,e){return v.invokeFunction(r=>{try{const{selectedCategory:t,selectedStep:i}=JSON.parse(e);return new _({selectedCategory:t,selectedStep:i},r.get(Q))}catch{}return new _({},r.get(Q))})}}export{ar as GettingStartedInputSerializer,G as GettingStartedPage,Se as allWalkthroughsHiddenContext,kt as inWelcomeContext};
