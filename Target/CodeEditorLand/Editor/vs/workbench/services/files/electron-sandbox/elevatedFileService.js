var c=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var m=(s,e,i,r)=>{for(var t=r>1?void 0:r?f(e,i):e,a=s.length-1,n;a>=0;a--)(n=s[a])&&(t=(r?n(e,i,t):n(t))||t);return r&&t&&c(e,i,t),t},o=(s,e)=>(i,r)=>e(i,r,s);import{localize as v}from"../../../../nls.js";import"../../../../base/common/buffer.js";import{randomPath as S}from"../../../../base/common/extpath.js";import{Schemas as u}from"../../../../base/common/network.js";import{URI as d}from"../../../../base/common/uri.js";import{IFileService as p}from"../../../../platform/files/common/files.js";import{InstantiationType as I,registerSingleton as h}from"../../../../platform/instantiation/common/extensions.js";import{INativeHostService as b}from"../../../../platform/native/common/native.js";import{IWorkspaceTrustRequestService as w}from"../../../../platform/workspace/common/workspaceTrust.js";import{INativeWorkbenchEnvironmentService as W}from"../../environment/electron-sandbox/environmentService.js";import{IElevatedFileService as y}from"../common/elevatedFileService.js";import{isWindows as R}from"../../../../base/common/platform.js";import{ILabelService as T}from"../../../../platform/label/common/label.js";let l=class{constructor(e,i,r,t,a){this.nativeHostService=e;this.fileService=i;this.environmentService=r;this.workspaceTrustRequestService=t;this.labelService=a}_serviceBrand;isSupported(e){return e.scheme===u.file}async writeFileElevated(e,i,r){if(!await this.workspaceTrustRequestService.requestWorkspaceTrust({message:R?v("fileNotTrustedMessageWindows","You are about to save '{0}' as admin.",this.labelService.getUriLabel(e)):v("fileNotTrustedMessagePosix","You are about to save '{0}' as super user.",this.labelService.getUriLabel(e))}))throw new Error(v("fileNotTrusted","Workspace is not trusted."));const a=d.file(S(this.environmentService.userDataPath,"code-elevated"));try{await this.fileService.writeFile(a,i,r),await this.nativeHostService.writeElevated(a,e,r)}finally{await this.fileService.del(a)}return this.fileService.resolve(e,{resolveMetadata:!0})}};l=m([o(0,b),o(1,p),o(2,W),o(3,w),o(4,T)],l),h(y,l,I.Delayed);export{l as NativeElevatedFileService};
