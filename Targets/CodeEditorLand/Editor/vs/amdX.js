import{FileAccess as u,nodeModulesAsarPath as p,nodeModulesPath as f,Schemas as m,VSCODE_AUTHORITY as _}from"./base/common/network.js";import*as h from"./base/common/platform.js";import"./base/common/product.js";import{URI as g}from"./base/common/uri.js";import{generateUuid as P}from"./base/common/uuid.js";const y=!1;class T{constructor(e,i,t){this.id=e;this.dependencies=i;this.callback=t}}var b=(t=>(t[t.Uninitialized=1]="Uninitialized",t[t.InitializedInternal=2]="InitializedInternal",t[t.InitializedExternal=3]="InitializedExternal",t))(b||{});class d{static INSTANCE=new d;_isWebWorker=typeof self=="object"&&self.constructor&&self.constructor.name==="DedicatedWorkerGlobalScope";_isRenderer=typeof document=="object";_defineCalls=[];_state=1;_amdPolicy;constructor(){}_initialize(){if(this._state===1){if(globalThis.define){this._state=3;return}}else return;this._state=2,globalThis.define=(e,i,t)=>{typeof e!="string"&&(t=i,i=e,e=null),(typeof i!="object"||!Array.isArray(i))&&(t=i,i=null),this._defineCalls.push(new T(e,i,t))},globalThis.define.amd=!0,this._isRenderer?this._amdPolicy=globalThis._VSCODE_WEB_PACKAGE_TTP??window.trustedTypes?.createPolicy("amdLoader",{createScriptURL(e){if(e.startsWith(window.location.origin)||e.startsWith(`${m.vscodeFileResource}://${_}`))return e;throw new Error(`[trusted_script_src] Invalid script url: ${e}`)}}):this._isWebWorker&&(this._amdPolicy=globalThis._VSCODE_WEB_PACKAGE_TTP??globalThis.trustedTypes?.createPolicy("amdLoader",{createScriptURL(e){return e}}))}async load(e){if(this._initialize(),this._state===3)return new Promise(o=>{const a=P();globalThis.define(a,[e],function(s){o(s)})});const i=await(this._isWebWorker?this._workerLoadScript(e):this._isRenderer?this._rendererLoadScript(e):this._nodeJSLoadScript(e));if(!i)return;const t={},n=[],r=[];if(Array.isArray(i.dependencies))for(const o of i.dependencies)o==="exports"?n.push(t):r.push(o);if(r.length>0)throw new Error(`Cannot resolve dependencies for script ${e}. The dependencies are: ${r.join(", ")}`);return typeof i.callback=="function"?i.callback(...n)??t:i.callback}_rendererLoadScript(e){return new Promise((i,t)=>{const n=document.createElement("script");n.setAttribute("async","async"),n.setAttribute("type","text/javascript");const r=()=>{n.removeEventListener("load",o),n.removeEventListener("error",a)},o=s=>{r(),i(this._defineCalls.pop())},a=s=>{r(),t(s)};n.addEventListener("load",o),n.addEventListener("error",a),this._amdPolicy&&(e=this._amdPolicy.createScriptURL(e)),n.setAttribute("src",e),window.document.getElementsByTagName("head")[0].appendChild(n)})}async _workerLoadScript(e){return this._amdPolicy&&(e=this._amdPolicy.createScriptURL(e)),await import(e),this._defineCalls.pop()}async _nodeJSLoadScript(e){try{const i=(await import("fs")).default,t=(await import("vm")).default,n=(await import("module")).default,r=g.parse(e).fsPath,o=i.readFileSync(r).toString(),a=n.wrap(o.replace(/^#!.*/,""));return new t.Script(a).runInThisContext().apply(),this._defineCalls.pop()}catch(i){throw i}}}const c=new Map;async function L(l,e,i){i===void 0&&(i=!!(globalThis._VSCODE_PRODUCT_JSON??globalThis.vscode?.context?.configuration()?.product)?.commit);const t=e?`${l}/${e}`:l;if(c.has(t))return c.get(t);let n;if(/^\w[\w\d+.-]*:\/\//.test(t))n=t;else{const s=`${y&&i&&!h.isWeb?p:f}/${t}`;n=u.asBrowserUri(s).toString(!0)}const r=d.INSTANCE.load(n);return c.set(t,r),r}function $(l,e){const t=!!(globalThis._VSCODE_PRODUCT_JSON??globalThis.vscode?.context?.configuration()?.product)?.commit,n=y&&t&&!h.isWeb,r=`${l}/${e}`,a=`${n?p:f}/${r}`;return u.asBrowserUri(a).toString(!0)}export{y as canASAR,L as importAMDNodeModule,$ as resolveAmdNodeModulePath};
