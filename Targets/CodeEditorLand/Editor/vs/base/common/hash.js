import{VSBuffer as A}from"./buffer.js";import*as l from"./strings.js";function B(r){return g(r,0)}function g(r,e){switch(typeof r){case"object":return r===null?a(349,e):Array.isArray(r)?x(r,e):y(r,e);case"string":return C(r,e);case"boolean":return S(r,e);case"number":return a(r,e);case"undefined":return a(937,e);default:return a(617,e)}}function a(r,e){return(e<<5)-e+r|0}function S(r,e){return a(r?433:863,e)}function C(r,e){e=a(149417,e);for(let t=0,n=r.length;t<n;t++)e=a(r.charCodeAt(t),e);return e}function x(r,e){return e=a(104579,e),r.reduce((t,n)=>g(n,t),e)}function y(r,e){return e=a(181387,e),Object.keys(r).sort().reduce((t,n)=>(t=C(n,t),g(r[n],t)),e)}const d=r=>{if(typeof r=="string"&&r.length<250){const t=new m;return t.update(r),Promise.resolve(t.digest())}let e;return typeof r=="string"?e=new TextEncoder().encode(r):r instanceof A?e=r.buffer:e=r,crypto.subtle.digest("sha-1",e).then(b)};var E=(t=>(t[t.BLOCK_SIZE=64]="BLOCK_SIZE",t[t.UNICODE_REPLACEMENT=65533]="UNICODE_REPLACEMENT",t))(E||{});function c(r,e,t=32){const n=t-e,f=~((1<<n)-1);return(r<<e|(f&r)>>>n)>>>0}function b(r,e=32){return r instanceof ArrayBuffer?Array.from(new Uint8Array(r)).map(t=>t.toString(16).padStart(2,"0")).join(""):(r>>>0).toString(16).padStart(e/4,"0")}class m{static _bigBlock32=new DataView(new ArrayBuffer(320));_h0=1732584193;_h1=4023233417;_h2=2562383102;_h3=271733878;_h4=3285377520;_buff;_buffDV;_buffLen;_totalLen;_leftoverHighSurrogate;_finished;constructor(){this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(e){const t=e.length;if(t===0)return;const n=this._buff;let f=this._buffLen,u=this._leftoverHighSurrogate,s,h;for(u!==0?(s=u,h=-1,u=0):(s=e.charCodeAt(0),h=0);;){let o=s;if(l.isHighSurrogate(s))if(h+1<t){const _=e.charCodeAt(h+1);l.isLowSurrogate(_)?(h++,o=l.computeCodePoint(s,_)):o=65533}else{u=s;break}else l.isLowSurrogate(s)&&(o=65533);if(f=this._push(n,f,o),h++,h<t)s=e.charCodeAt(h);else break}this._buffLen=f,this._leftoverHighSurrogate=u}_push(e,t,n){return n<128?e[t++]=n:n<2048?(e[t++]=192|(n&1984)>>>6,e[t++]=128|(n&63)>>>0):n<65536?(e[t++]=224|(n&61440)>>>12,e[t++]=128|(n&4032)>>>6,e[t++]=128|(n&63)>>>0):(e[t++]=240|(n&1835008)>>>18,e[t++]=128|(n&258048)>>>12,e[t++]=128|(n&4032)>>>6,e[t++]=128|(n&63)>>>0),t>=64&&(this._step(),t-=64,this._totalLen+=64,e[0]=e[64],e[1]=e[65],e[2]=e[66]),t}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),b(this._h0)+b(this._h1)+b(this._h2)+b(this._h3)+b(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,this._buff.subarray(this._buffLen).fill(0),this._buffLen>56&&(this._step(),this._buff.fill(0));const e=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(e/4294967296),!1),this._buffDV.setUint32(60,e%4294967296,!1),this._step()}_step(){const e=m._bigBlock32,t=this._buffDV;for(let i=0;i<64;i+=4)e.setUint32(i,t.getUint32(i,!1),!1);for(let i=64;i<320;i+=4)e.setUint32(i,c(e.getUint32(i-12,!1)^e.getUint32(i-32,!1)^e.getUint32(i-56,!1)^e.getUint32(i-64,!1),1),!1);let n=this._h0,f=this._h1,u=this._h2,s=this._h3,h=this._h4,o,_,p;for(let i=0;i<80;i++)i<20?(o=f&u|~f&s,_=1518500249):i<40?(o=f^u^s,_=1859775393):i<60?(o=f&u|f&s|u&s,_=2400959708):(o=f^u^s,_=3395469782),p=c(n,5)+o+h+_+e.getUint32(i*4,!1)&4294967295,h=s,s=u,u=c(f,30),f=n,n=p;this._h0=this._h0+n&4294967295,this._h1=this._h1+f&4294967295,this._h2=this._h2+u&4294967295,this._h3=this._h3+s&4294967295,this._h4=this._h4+h&4294967295}}export{m as StringSHA1,g as doHash,B as hash,d as hashAsync,a as numberHash,C as stringHash};
