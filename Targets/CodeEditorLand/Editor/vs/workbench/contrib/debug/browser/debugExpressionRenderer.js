var S=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var I=(c,t,e,o)=>{for(var s=o>1?void 0:o?k(t,e):t,a=c.length-1,n;a>=0;a--)(n=c[a])&&(s=(o?n(t,e,s):n(s))||s);return o&&s&&S(t,e,s),s},d=(c,t)=>(e,o)=>t(e,o,c);import*as l from"../../../../base/browser/dom.js";import"../../../../base/browser/ui/highlightedlabel/highlightedLabel.js";import{getDefaultHoverDelegate as E}from"../../../../base/browser/ui/hover/hoverDelegateFactory.js";import{DisposableStore as H}from"../../../../base/common/lifecycle.js";import"../../../../base/common/observable.js";import{CommandsRegistry as N,ICommandService as T}from"../../../../platform/commands/common/commands.js";import{IConfigurationService as A}from"../../../../platform/configuration/common/configuration.js";import{IHoverService as w}from"../../../../platform/hover/browser/hover.js";import{IInstantiationService as R}from"../../../../platform/instantiation/common/instantiation.js";import{observableConfigValue as V}from"../../../../platform/observable/common/platformObservableUtils.js";import"../common/debug.js";import{Expression as u,ExpressionContainer as y,Variable as _}from"../common/debugModel.js";import{ReplEvaluationResult as U}from"../common/replModel.js";import"./baseDebugView.js";import{handleANSIOutput as L}from"./debugANSIHandling.js";import{COPY_EVALUATE_PATH_ID as B,COPY_VALUE_ID as $}from"./debugCommands.js";import{DebugLinkHoverBehavior as b,LinkDetector as z}from"./linkDetector.js";const P=1024,M=/^(true|false)$/i,F=/^(['"]).*\1$/;var Y=(i=>(i.Value="value",i.Unavailable="unavailable",i.Error="error",i.Changed="changed",i.Boolean="boolean",i.String="string",i.Number="number",i))(Y||{});const j=Object.keys({value:0,unavailable:0,error:0,changed:0,boolean:0,string:0,number:0});let g=class{constructor(t,e,o,s){this.commandService=t;this.hoverService=s;this.linkDetector=o.createInstance(z),this.displayType=V("debug.showVariableTypes",!1,e)}displayType;linkDetector;renderVariable(t,e,o={}){const s=this.displayType.get();if(e.available){t.type.textContent="";let n=e.name;e.value&&typeof e.name=="string"&&(e.type&&s?(n+=": ",t.type.textContent=e.type+" ="):n+=" ="),t.label.set(n,o.highlights,e.type&&!s?e.type:e.name),t.name.classList.toggle("virtual",e.presentationHint?.kind==="virtual"),t.name.classList.toggle("internal",e.presentationHint?.visibility==="internal")}else e.value&&typeof e.name=="string"&&e.name&&t.label.set(":");t.expression.classList.toggle("lazy",!!e.presentationHint?.lazy);const a=[{id:$,args:[e,[e]]}];return e.evaluateName&&a.push({id:B,args:[{variable:e}]}),this.renderValue(t.value,e,{showChanged:o.showChanged,maxValueLength:P,hover:{commands:a},colorize:!0,session:e.getSession()})}renderValue(t,e,o={}){const s=new H,a=o.session?.rememberedCapabilities?.supportsANSIStyling??o.wasANSI??!1;let n=typeof e=="string"?e:e.value;for(const h of j)t.classList.remove(h);t.classList.add("value"),n===null||(e instanceof u||e instanceof _||e instanceof U)&&!e.available?(t.classList.add("unavailable"),n!==u.DEFAULT_VALUE&&t.classList.add("error")):(typeof e!="string"&&o.showChanged&&e.valueChanged&&n!==u.DEFAULT_VALUE&&(t.classList.add("changed"),e.valueChanged=!1),o.colorize&&typeof e!="string"&&(e.type==="number"||e.type==="boolean"||e.type==="string"?t.classList.add(e.type):isNaN(+n)?M.test(n)?t.classList.add("boolean"):F.test(n)&&t.classList.add("string"):t.classList.add("number"))),o.maxValueLength&&n&&n.length>o.maxValueLength&&(n=n.substring(0,o.maxValueLength)+"..."),n||(n="");const i=o.session??(e instanceof y?e.getSession():void 0),D=o.hover===!1?{type:b.Rich,store:s}:{type:b.None};l.clearNode(t);const v=o.locationReference??(e instanceof y&&e.valueLocationReference);let p=this.linkDetector;if(v&&i&&(p=this.linkDetector.makeReferencedLinkDetector(v,i)),a?t.appendChild(L(n,p,i?i.root:void 0)):t.appendChild(p.linkify(n,!1,i?.root,!0,D)),o.hover!==!1){const{commands:h=[]}=o.hover||{};s.add(this.hoverService.setupManagedHover(E("mouse"),t,()=>{const r=l.$("div"),f=l.$("div.hover-row"),m=l.append(f,l.$("div.hover-contents")),C=l.append(m,l.$("pre.debug-var-hover-pre"));return a?C.appendChild(L(n,this.linkDetector,i?i.root:void 0)):C.textContent=n,r.appendChild(f),r},{actions:h.map(({id:r,args:f})=>{const m=N.getCommand(r)?.metadata?.description;return{label:typeof m=="string"?m:m?m.value:r,commandId:r,run:()=>this.commandService.executeCommand(r,...f)}})}))}return s}};g=I([d(0,T),d(1,A),d(2,R),d(3,w)],g);export{g as DebugExpressionRenderer};
