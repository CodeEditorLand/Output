var h=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var l=(n,r,e,i)=>{for(var o=i>1?void 0:i?b(r,e):r,s=n.length-1,a;s>=0;s--)(a=n[s])&&(o=(i?a(r,e,o):a(o))||o);return i&&o&&h(r,e,o),o},t=(n,r)=>(e,i)=>r(e,i,n);import{Disposable as m}from"../../../../../../base/common/lifecycle.js";import"../../../../../../base/common/uri.js";import*as f from"../../../../../../nls.js";import{IConfigurationService as g}from"../../../../../../platform/configuration/common/configuration.js";import{IContextKeyService as I}from"../../../../../../platform/contextkey/common/contextkey.js";import{SyncDescriptor as u}from"../../../../../../platform/instantiation/common/descriptors.js";import{Registry as S}from"../../../../../../platform/registry/common/platform.js";import"../../../../../common/contributions.js";import{Extensions as E,IViewDescriptorService as w}from"../../../../../common/views.js";import{VIEWLET_ID as V}from"../../../../debug/common/debug.js";import{NOTEBOOK_VARIABLE_VIEW_ENABLED as d}from"./notebookVariableContextKeys.js";import{NotebookVariablesView as k}from"./notebookVariablesView.js";import{getNotebookEditorFromEditorPane as C}from"../../notebookBrowser.js";import{variablesViewIcon as D}from"../../notebookIcons.js";import{NotebookSetting as p}from"../../../common/notebookCommon.js";import{INotebookExecutionStateService as y}from"../../../common/notebookExecutionStateService.js";import{INotebookKernelService as x}from"../../../common/notebookKernelService.js";import{INotebookService as K}from"../../../common/notebookService.js";import{IEditorService as N}from"../../../../../services/editor/common/editorService.js";let c=class extends m{constructor(e,i,o,s,a,R,P){super();this.configurationService=i;this.editorService=o;this.notebookExecutionStateService=s;this.notebookKernelService=a;this.notebookDocumentService=R;this.viewDescriptorService=P;this.viewEnabled=d.bindTo(e),this.listeners.push(this.editorService.onDidActiveEditorChange(()=>this.handleInitEvent())),this.listeners.push(this.notebookExecutionStateService.onDidChangeExecution(v=>this.handleInitEvent(v.notebook))),this.configListener=i.onDidChangeConfiguration(v=>this.handleConfigChange(v))}listeners=[];configListener;initialized=!1;viewEnabled;handleConfigChange(e){e.affectsConfiguration(p.notebookVariablesView)&&this.handleInitEvent()}handleInitEvent(e){(this.editorService.activeEditorPane?.getId()==="workbench.editor.repl"||this.configurationService.getValue(p.notebookVariablesView)||this.configurationService.getValue("notebook.experimental.variablesView"))&&(e||this.editorService.activeEditorPane?.getId()==="workbench.editor.notebook")&&this.hasVariableProvider(e)&&!this.initialized&&this.initializeView()&&(this.viewEnabled.set(!0),this.initialized=!0,this.listeners.forEach(o=>o.dispose()))}hasVariableProvider(e){const i=e?this.notebookDocumentService.getNotebookTextModel(e):C(this.editorService.activeEditorPane)?.getViewModel()?.notebookDocument;return i&&this.notebookKernelService.getMatchingKernel(i).selected?.hasVariableProvider}initializeView(){const e=this.viewDescriptorService.getViewContainerById(V);if(e){const i=S.as(E.ViewsRegistry),o={id:"workbench.notebook.variables",name:f.localize2("notebookVariables","Notebook Variables"),containerIcon:D,ctorDescriptor:new u(k),order:50,weight:5,canToggleVisibility:!0,canMoveView:!0,collapsed:!1,when:d};return i.registerViews([o],e),!0}return!1}dispose(){super.dispose(),this.listeners.forEach(e=>e.dispose()),this.configListener.dispose()}};c=l([t(0,I),t(1,g),t(2,N),t(3,y),t(4,x),t(5,K),t(6,w)],c);export{c as NotebookVariables};
