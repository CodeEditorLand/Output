var d=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=(s,t,e,r)=>{for(var i=r>1?void 0:r?p(t,e):t,o=s.length-1,l;o>=0;o--)(l=s[o])&&(i=(r?l(t,e,i):l(i))||i);return r&&i&&d(t,e,i),i},n=(s,t)=>(e,r)=>t(e,r,s);import{Event as y}from"../../../../../base/common/event.js";import{Disposable as b,MutableDisposable as c}from"../../../../../base/common/lifecycle.js";import{IConfigurationService as f}from"../../../../../platform/configuration/common/configuration.js";import{IContextKeyService as u}from"../../../../../platform/contextkey/common/contextkey.js";import{IInstantiationService as I}from"../../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as S}from"../../../../../platform/keybinding/common/keybinding.js";import{TerminalCapability as m}from"../../../../../platform/terminal/common/capabilities/capabilities.js";import"../../../terminal/browser/terminal.js";import{TerminalInstance as x,TerminalInstanceColorProvider as g}from"../../../terminal/browser/terminalInstance.js";import{TerminalStickyScrollSettingId as _}from"../common/terminalStickyScrollConfiguration.js";import"./media/stickyScroll.css";import{TerminalStickyScrollOverlay as C}from"./terminalStickyScrollOverlay.js";let a=class extends b{constructor(e,r,i,o,l){super();this._ctx=e;this._configurationService=r;this._contextKeyService=i;this._instantiationService=o;this._keybindingService=l;this._register(y.runAndSubscribe(this._configurationService.onDidChangeConfiguration,v=>{(!v||v.affectsConfiguration(_.Enabled))&&this._refreshState()}))}static ID="terminal.stickyScroll";static get(e){return e.getContribution(a.ID)}_xterm;_overlay=this._register(new c);_enableListeners=this._register(new c);_disableListeners=this._register(new c);xtermReady(e){this._xterm=e,this._refreshState()}xtermOpen(e){this._refreshState()}hideLock(){this._overlay.value?.lockHide()}hideUnlock(){this._overlay.value?.unlockHide()}_refreshState(){this._overlay.value?this._tryDisable():this._tryEnable(),this._overlay.value?(this._enableListeners.clear(),this._disableListeners.value||(this._disableListeners.value=this._ctx.instance.capabilities.onDidRemoveCapability(e=>{e.id===m.CommandDetection&&this._refreshState()}))):(this._disableListeners.clear(),this._enableListeners.value||(this._enableListeners.value=this._ctx.instance.capabilities.onDidAddCapability(e=>{e.id===m.CommandDetection&&this._refreshState()})))}_tryEnable(){if(this._shouldBeEnabled()){const e=x.getXtermConstructor(this._keybindingService,this._contextKeyService);this._overlay.value=this._instantiationService.createInstance(C,this._ctx.instance,this._xterm,this._instantiationService.createInstance(g,this._ctx.instance.targetRef),this._ctx.instance.capabilities.get(m.CommandDetection),e)}}_tryDisable(){this._shouldBeEnabled()||this._overlay.clear()}_shouldBeEnabled(){const e=this._ctx.instance.capabilities.get(m.CommandDetection);return!!(this._configurationService.getValue(_.Enabled)&&e&&this._xterm?.raw?.element)}};a=h([n(1,f),n(2,u),n(3,I),n(4,S)],a);export{a as TerminalStickyScrollContribution};
